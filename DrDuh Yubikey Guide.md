{"payload":{"allShortcutsEnabled":true,"fileTree":{"":{"items":[{"name":".github","path":".github","contentType":"directory"},{"name":"contrib","path":"contrib","contentType":"directory"},{"name":"media","path":"media","contentType":"directory"},{"name":"LICENSE","path":"LICENSE","contentType":"file"},{"name":"README.md","path":"README.md","contentType":"file"},{"name":"switch-to-backup-yubikey","path":"switch-to-backup-yubikey","contentType":"file"}],"totalCount":6}},"fileTreeProcessingTime":2.888927,"foldersToFetch":[],"reducedMotionEnabled":"system","repo":{"id":50806714,"defaultBranch":"master","name":"YubiKey-Guide","ownerLogin":"drduh","currentUserCanPush":false,"isFork":false,"isEmpty":false,"createdAt":"2016-01-31T17:56:49.000-08:00","ownerAvatar":"https://avatars.githubusercontent.com/u/12475110?v=4","public":true,"private":false,"isOrgOwned":false},"symbolsExpanded":false,"treeExpanded":true,"refInfo":{"name":"master","listCacheKey":"v0:1697429047.0","canEdit":true,"refType":"branch","currentOid":"c41729520faf06c352510118ec9bb042bf4a40e7"},"path":"README.md","currentUser":{"id":74991708,"login":"greymantech","userEmail":"xc@xenonclash.com"},"blob":{"rawLines":null,"stylingDirectives":null,"csv":null,"csvError":null,"dependabotInfo":{"showConfigurationBanner":false,"configFilePath":null,"networkDependabotPath":"/drduh/YubiKey-Guide/network/updates","dismissConfigurationNoticePath":"/settings/dismiss-notice/dependabot_configuration_notice","configurationNoticeDismissed":false,"repoAlertsPath":"/drduh/YubiKey-Guide/security/dependabot","repoSecurityAndAnalysisPath":"/drduh/YubiKey-Guide/settings/security_analysis","repoOwnerIsOrg":false,"currentUserCanAdminRepo":false},"displayName":"README.md","displayUrl":"https://github.com/drduh/YubiKey-Guide/blob/master/README.md?raw=true","headerInfo":{"blobSize":"127 KB","deleteInfo":{"deleteTooltip":"Fork this repository and delete the file"},"editInfo":{"editTooltip":"Fork this repository and edit the file"},"ghDesktopPath":"x-github-client://openRepo/https://github.com/drduh/YubiKey-Guide?branch=master&filepath=README.md","gitLfsPath":null,"onBranch":true,"shortPath":"f5ea43c","siteNavLoginPath":"/login?return_to=https%3A%2F%2Fgithub.com%2Fdrduh%2FYubiKey-Guide%2Fblob%2Fmaster%2FREADME.md","isCSV":false,"isRichtext":true,"toc":[{"level":1,"text":"Purchase","anchor":"purchase","htmlText":"Purchase"},{"level":1,"text":"Prepare environment","anchor":"prepare-environment","htmlText":"Prepare environment"},{"level":1,"text":"Required software","anchor":"required-software","htmlText":"Required software"},{"level":2,"text":"Debian and Ubuntu","anchor":"debian-and-ubuntu","htmlText":"Debian and Ubuntu"},{"level":2,"text":"Fedora","anchor":"fedora","htmlText":"Fedora"},{"level":2,"text":"Arch","anchor":"arch","htmlText":"Arch"},{"level":2,"text":"RHEL7","anchor":"rhel7","htmlText":"RHEL7"},{"level":2,"text":"NixOS","anchor":"nixos","htmlText":"NixOS"},{"level":2,"text":"OpenBSD","anchor":"openbsd","htmlText":"OpenBSD"},{"level":2,"text":"macOS","anchor":"macos","htmlText":"macOS"},{"level":2,"text":"Windows","anchor":"windows","htmlText":"Windows"},{"level":1,"text":"Entropy","anchor":"entropy","htmlText":"Entropy"},{"level":2,"text":"YubiKey","anchor":"yubikey","htmlText":"YubiKey"},{"level":2,"text":"OneRNG","anchor":"onerng","htmlText":"OneRNG"},{"level":1,"text":"Creating keys","anchor":"creating-keys","htmlText":"Creating keys"},{"level":2,"text":"Temporary working directory","anchor":"temporary-working-directory","htmlText":"Temporary working directory"},{"level":2,"text":"Harden configuration","anchor":"harden-configuration","htmlText":"Harden configuration"},{"level":1,"text":"Master key","anchor":"master-key","htmlText":"Master key"},{"level":1,"text":"Sign with existing key","anchor":"sign-with-existing-key","htmlText":"Sign with existing key"},{"level":1,"text":"Sub-keys","anchor":"sub-keys","htmlText":"Sub-keys"},{"level":2,"text":"Signing","anchor":"signing","htmlText":"Signing"},{"level":2,"text":"Encryption","anchor":"encryption","htmlText":"Encryption"},{"level":2,"text":"Authentication","anchor":"authentication","htmlText":"Authentication"},{"level":2,"text":"Add extra identities","anchor":"add-extra-identities","htmlText":"Add extra identities"},{"level":1,"text":"Verify","anchor":"verify","htmlText":"Verify"},{"level":1,"text":"Export secret keys","anchor":"export-secret-keys","htmlText":"Export secret keys"},{"level":1,"text":"Revocation certificate","anchor":"revocation-certificate","htmlText":"Revocation certificate"},{"level":1,"text":"Backup","anchor":"backup","htmlText":"Backup"},{"level":1,"text":"Export public keys","anchor":"export-public-keys","htmlText":"Export public keys"},{"level":1,"text":"Configure Smartcard","anchor":"configure-smartcard","htmlText":"Configure Smartcard"},{"level":2,"text":"Enable KDF","anchor":"enable-kdf","htmlText":"Enable KDF"},{"level":2,"text":"Change PIN","anchor":"change-pin","htmlText":"Change PIN"},{"level":2,"text":"Set information","anchor":"set-information","htmlText":"Set information"},{"level":1,"text":"Transfer keys","anchor":"transfer-keys","htmlText":"Transfer keys"},{"level":2,"text":"Signing","anchor":"signing-1","htmlText":"Signing"},{"level":2,"text":"Encryption","anchor":"encryption-1","htmlText":"Encryption"},{"level":2,"text":"Authentication","anchor":"authentication-1","htmlText":"Authentication"},{"level":1,"text":"Verify card","anchor":"verify-card","htmlText":"Verify card"},{"level":1,"text":"Multiple YubiKeys","anchor":"multiple-yubikeys","htmlText":"Multiple YubiKeys"},{"level":2,"text":"Switching between two or more Yubikeys","anchor":"switching-between-two-or-more-yubikeys","htmlText":"Switching between two or more Yubikeys"},{"level":1,"text":"Multiple Hosts","anchor":"multiple-hosts","htmlText":"Multiple Hosts"},{"level":1,"text":"Cleanup","anchor":"cleanup","htmlText":"Cleanup"},{"level":1,"text":"Using keys","anchor":"using-keys","htmlText":"Using keys"},{"level":1,"text":"Rotating keys","anchor":"rotating-keys","htmlText":"Rotating keys"},{"level":2,"text":"Setup environment","anchor":"setup-environment","htmlText":"Setup environment"},{"level":2,"text":"Renewing sub-keys","anchor":"renewing-sub-keys","htmlText":"Renewing sub-keys"},{"level":2,"text":"Rotating keys","anchor":"rotating-keys-1","htmlText":"Rotating keys"},{"level":1,"text":"Adding notations","anchor":"adding-notations","htmlText":"Adding notations"},{"level":1,"text":"SSH","anchor":"ssh","htmlText":"SSH"},{"level":2,"text":"Create configuration","anchor":"create-configuration","htmlText":"Create configuration"},{"level":2,"text":"Replace agents","anchor":"replace-agents","htmlText":"Replace agents"},{"level":2,"text":"Copy public key","anchor":"copy-public-key","htmlText":"Copy public key"},{"level":2,"text":"(Optional) Save public key for identity file configuration","anchor":"optional-save-public-key-for-identity-file-configuration","htmlText":"(Optional) Save public key for identity file configuration"},{"level":2,"text":"Connect with public key authentication","anchor":"connect-with-public-key-authentication","htmlText":"Connect with public key authentication"},{"level":2,"text":"Import SSH keys","anchor":"import-ssh-keys","htmlText":"Import SSH keys"},{"level":2,"text":"Remote Machines (SSH Agent Forwarding)","anchor":"remote-machines-ssh-agent-forwarding","htmlText":"Remote Machines (SSH Agent Forwarding)"},{"level":3,"text":"Use ssh-agent","anchor":"use-ssh-agent","htmlText":"Use ssh-agent"},{"level":3,"text":"Use S.gpg-agent.ssh","anchor":"use-sgpg-agentssh","htmlText":"Use S.gpg-agent.ssh"},{"level":3,"text":"Chained SSH Agent Forwarding","anchor":"chained-ssh-agent-forwarding","htmlText":"Chained SSH Agent Forwarding"},{"level":2,"text":"GitHub","anchor":"github","htmlText":"GitHub"},{"level":2,"text":"OpenBSD","anchor":"openbsd-1","htmlText":"OpenBSD"},{"level":2,"text":"Windows","anchor":"windows-1","htmlText":"Windows"},{"level":3,"text":"WSL","anchor":"wsl","htmlText":"WSL"},{"level":4,"text":"Use ssh-agent or use S.weasel-pageant","anchor":"use-ssh-agent-or-use-sweasel-pageant","htmlText":"Use ssh-agent or use S.weasel-pageant"},{"level":4,"text":"Prerequisites","anchor":"prerequisites","htmlText":"Prerequisites"},{"level":4,"text":"WSL configuration","anchor":"wsl-configuration","htmlText":"WSL configuration"},{"level":4,"text":"Remote host configuration","anchor":"remote-host-configuration","htmlText":"Remote host configuration"},{"level":2,"text":"macOS","anchor":"macos-1","htmlText":"macOS"},{"level":1,"text":"Remote Machines (GPG Agent Forwarding)","anchor":"remote-machines-gpg-agent-forwarding","htmlText":"Remote Machines (GPG Agent Forwarding)"},{"level":2,"text":"Steps for older distributions","anchor":"steps-for-older-distributions","htmlText":"Steps for older distributions"},{"level":2,"text":"Chained GPG Agent Forwarding","anchor":"chained-gpg-agent-forwarding","htmlText":"Chained GPG Agent Forwarding"},{"level":1,"text":"Using Multiple Keys","anchor":"using-multiple-keys","htmlText":"Using Multiple Keys"},{"level":1,"text":"Adding an identity","anchor":"adding-an-identity","htmlText":"Adding an identity"},{"level":2,"text":"Add an identity to your master key","anchor":"add-an-identity-to-your-master-key","htmlText":"Add an identity to your master key"},{"level":2,"text":"Updating your YubiKey","anchor":"updating-your-yubikey","htmlText":"Updating your YubiKey"},{"level":1,"text":"Require touch","anchor":"require-touch","htmlText":"Require touch"},{"level":1,"text":"Email","anchor":"email","htmlText":"Email"},{"level":2,"text":"Mailvelope","anchor":"mailvelope","htmlText":"Mailvelope"},{"level":2,"text":"Mutt","anchor":"mutt","htmlText":"Mutt"},{"level":1,"text":"Reset","anchor":"reset","htmlText":"Reset"},{"level":2,"text":"Recovery after reset","anchor":"recovery-after-reset","htmlText":"Recovery after reset"},{"level":1,"text":"Notes","anchor":"notes","htmlText":"Notes"},{"level":1,"text":"Troubleshooting","anchor":"troubleshooting","htmlText":"Troubleshooting"},{"level":1,"text":"Alternatives","anchor":"alternatives","htmlText":"Alternatives"},{"level":2,"text":"Create keys with batch","anchor":"create-keys-with-batch","htmlText":"Create keys with batch"},{"level":1,"text":"Links","anchor":"links","htmlText":"Links"}],"lineInfo":{"truncatedLoc":"3309","truncatedSloc":"2396"},"mode":"file"},"image":false,"isCodeownersFile":null,"isPlain":false,"isValidLegacyIssueTemplate":false,"issueTemplateHelpUrl":"https://docs.github.com/articles/about-issue-and-pull-request-templates","issueTemplate":null,"discussionTemplate":null,"language":"Markdown","languageID":222,"large":false,"loggedIn":true,"newDiscussionPath":"/drduh/YubiKey-Guide/discussions/new","newIssuePath":"/drduh/YubiKey-Guide/issues/new","planSupportInfo":{"repoIsFork":null,"repoOwnedByCurrentUser":null,"requestFullPath":"/drduh/YubiKey-Guide/blob/master/README.md","showFreeOrgGatedFeatureMessage":null,"showPlanSupportBanner":null,"upgradeDataAttributes":null,"upgradePath":null},"publishBannersInfo":{"dismissActionNoticePath":"/settings/dismiss-notice/publish_action_from_dockerfile","dismissStackNoticePath":"/settings/dismiss-notice/publish_stack_from_file","releasePath":"/drduh/YubiKey-Guide/releases/new?marketplace=true","showPublishActionBanner":false,"showPublishStackBanner":false},"rawBlobUrl":"https://github.com/drduh/YubiKey-Guide/raw/master/README.md","renderImageOrRaw":false,"richText":"<article class=\"markdown-body entry-content container-lg\" itemprop=\"text\"><p dir=\"auto\">This is a guide to using <a href=\"https://www.yubico.com/products/yubikey-hardware/\" rel=\"nofollow\">YubiKey</a> as a <a href=\"https://security.stackexchange.com/questions/38924/how-does-storing-gpg-ssh-private-keys-on-smart-cards-compare-to-plain-usb-drives\" rel=\"nofollow\">SmartCard</a> for storing GPG encryption, signing and authentication keys, which can also be used for SSH. Many of the principles in this document are applicable to other smart card devices.</p>\n<p dir=\"auto\">Keys stored on YubiKey are <a href=\"http://web.archive.org/web/20201125172759/https://support.yubico.com/hc/en-us/articles/360016614880-Can-I-Duplicate-or-Back-Up-a-YubiKey-\" rel=\"nofollow\">non-exportable</a> (as opposed to file-based keys that are stored on disk) and are convenient for everyday use. Instead of having to remember and enter passphrases to unlock SSH/GPG keys, YubiKey needs only a physical touch after being unlocked with a PIN. All signing and encryption operations happen on the card, rather than in OS memory.</p>\n<p dir=\"auto\"><strong>Security Note</strong>: If you followed this guide before Jan 2021, your GPG <em>PIN</em> and <em>Admin PIN</em> may be set to their default values (<code>123456</code> and <code>12345678</code> respectively). This would allow an attacker to use your Yubikey or reset your PIN. Please see the <a href=\"#change-pin\">Change PIN</a> section for details on how to change your PINs.</p>\n<p dir=\"auto\">If you have a comment or suggestion, please open an <a href=\"https://github.com/drduh/YubiKey-Guide/issues\">Issue</a> on GitHub.</p>\n<p dir=\"auto\"><strong>Tip</strong> <a href=\"https://github.com/drduh/Purse\">drduh/Purse</a> is a password manager which uses GPG and YubiKey to securely store and read credentials.</p>\n<ul dir=\"auto\">\n<li><a href=\"#purchase\">Purchase</a></li>\n<li><a href=\"#prepare-environment\">Prepare environment</a></li>\n<li><a href=\"#required-software\">Required software</a>\n<ul dir=\"auto\">\n<li><a href=\"#debian-and-ubuntu\">Debian and Ubuntu</a></li>\n<li><a href=\"#fedora\">Fedora</a></li>\n<li><a href=\"#arch\">Arch</a></li>\n<li><a href=\"#rhel7\">RHEL7</a></li>\n<li><a href=\"#nixos\">NixOS</a></li>\n<li><a href=\"#openbsd\">OpenBSD</a></li>\n<li><a href=\"#macos\">macOS</a></li>\n<li><a href=\"#windows\">Windows</a></li>\n</ul>\n</li>\n<li><a href=\"#entropy\">Entropy</a>\n<ul dir=\"auto\">\n<li><a href=\"#yubikey\">YubiKey</a></li>\n<li><a href=\"#onerng\">OneRNG</a></li>\n</ul>\n</li>\n<li><a href=\"#creating-keys\">Creating keys</a>\n<ul dir=\"auto\">\n<li><a href=\"#temporary-working-directory\">Temporary working directory</a></li>\n<li><a href=\"#harden-configuration\">Harden configuration</a></li>\n</ul>\n</li>\n<li><a href=\"#master-key\">Master key</a></li>\n<li><a href=\"#sign-with-existing-key\">Sign with existing key</a></li>\n<li><a href=\"#sub-keys\">Sub-keys</a>\n<ul dir=\"auto\">\n<li><a href=\"#signing\">Signing</a></li>\n<li><a href=\"#encryption\">Encryption</a></li>\n<li><a href=\"#authentication\">Authentication</a></li>\n<li><a href=\"#add-extra-identities\">Add extra identities</a></li>\n</ul>\n</li>\n<li><a href=\"#verify\">Verify</a></li>\n<li><a href=\"#export-secret-keys\">Export secret keys</a></li>\n<li><a href=\"#revocation-certificate\">Revocation certificate</a></li>\n<li><a href=\"#backup\">Backup</a></li>\n<li><a href=\"#export-public-keys\">Export public keys</a></li>\n<li><a href=\"#configure-smartcard\">Configure Smartcard</a>\n<ul dir=\"auto\">\n<li><a href=\"#enable-kdf\">Enable KDF</a></li>\n<li><a href=\"#change-pin\">Change PIN</a></li>\n<li><a href=\"#set-information\">Set information</a></li>\n</ul>\n</li>\n<li><a href=\"#transfer-keys\">Transfer keys</a>\n<ul dir=\"auto\">\n<li><a href=\"#signing\">Signing</a></li>\n<li><a href=\"#encryption\">Encryption</a></li>\n<li><a href=\"#authentication\">Authentication</a></li>\n</ul>\n</li>\n<li><a href=\"#verify-card\">Verify card</a></li>\n<li><a href=\"#multiple-yubikeys\">Multiple YubiKeys</a>\n<ul dir=\"auto\">\n<li><a href=\"#switching-between-two-or-more-yubikeys\">Switching between two or more Yubikeys</a></li>\n</ul>\n</li>\n<li><a href=\"#multiple-hosts\">Multiple Hosts</a></li>\n<li><a href=\"#cleanup\">Cleanup</a></li>\n<li><a href=\"#using-keys\">Using keys</a></li>\n<li><a href=\"#rotating-keys\">Rotating keys</a>\n<ul dir=\"auto\">\n<li><a href=\"#setup-environment\">Setup environment</a></li>\n<li><a href=\"#renewing-sub-keys\">Renewing sub-keys</a></li>\n<li><a href=\"#rotating-keys-1\">Rotating keys</a></li>\n</ul>\n</li>\n<li><a href=\"#adding-notations\">Adding notations</a></li>\n<li><a href=\"#ssh\">SSH</a>\n<ul dir=\"auto\">\n<li><a href=\"#create-configuration\">Create configuration</a></li>\n<li><a href=\"#replace-agents\">Replace agents</a></li>\n<li><a href=\"#copy-public-key\">Copy public key</a></li>\n<li><a href=\"#optional-save-public-key-for-identity-file-configuration\">(Optional) Save public key for identity file configuration</a></li>\n<li><a href=\"#connect-with-public-key-authentication\">Connect with public key authentication</a></li>\n<li><a href=\"#import-ssh-keys\">Import SSH keys</a></li>\n<li><a href=\"#remote-machines-ssh-agent-forwarding\">Remote Machines (SSH Agent Forwarding)</a>\n<ul dir=\"auto\">\n<li><a href=\"#use-ssh-agent\">Use ssh-agent</a></li>\n<li><a href=\"#use-sgpg-agentssh\">Use S.gpg-agent.ssh</a></li>\n<li><a href=\"#chained-ssh-agent-forwarding\">Chained SSH Agent Forwarding</a></li>\n</ul>\n</li>\n<li><a href=\"#github\">GitHub</a></li>\n<li><a href=\"#openbsd\">OpenBSD</a></li>\n<li><a href=\"#windows\">Windows</a>\n<ul dir=\"auto\">\n<li><a href=\"#wsl\">WSL</a>\n<ul dir=\"auto\">\n<li><a href=\"#use-ssh-agent-or-use-sweasel-pageant\">Use ssh-agent or use S.weasel-pageant</a></li>\n<li><a href=\"#prerequisites\">Prerequisites</a></li>\n<li><a href=\"#wsl-configuration\">WSL configuration</a></li>\n<li><a href=\"#remote-host-configuration\">Remote host configuration</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#macos\">macOS</a></li>\n</ul>\n</li>\n<li><a href=\"#remote-machines-gpg-agent-forwarding\">Remote Machines (GPG Agent Forwarding)</a>\n<ul dir=\"auto\">\n<li><a href=\"#steps-for-older-distributions\">Steps for older distributions</a></li>\n<li><a href=\"#chained-gpg-agent-forwarding\">Chained GPG Agent Forwarding</a></li>\n</ul>\n</li>\n<li><a href=\"#using-multiple-keys\">Using Multiple Keys</a></li>\n<li><a href=\"#adding-an-identity\">Adding an identity</a>\n<ul dir=\"auto\">\n<li><a href=\"#add-an-identity-to-your-master-key\">Add an identity to your master key</a></li>\n<li><a href=\"#updating-your-yubikey\">Updating your YubiKey</a></li>\n</ul>\n</li>\n<li><a href=\"#require-touch\">Require touch</a></li>\n<li><a href=\"#email\">Email</a>\n<ul dir=\"auto\">\n<li><a href=\"#mailvelope-on-macos\">Mailvelope on macOS</a></li>\n<li><a href=\"#mutt\">Mutt</a></li>\n</ul>\n</li>\n<li><a href=\"#reset\">Reset</a></li>\n<li><a href=\"#recovery-after-reset\">Recovery after reset</a></li>\n<li><a href=\"#notes\">Notes</a></li>\n<li><a href=\"#troubleshooting\">Troubleshooting</a></li>\n<li><a href=\"#alternatives\">Alternatives</a>\n<ul dir=\"auto\">\n<li><a href=\"#create-keys-with-batch\">Create keys with batch</a></li>\n</ul>\n</li>\n<li><a href=\"#links\">Links</a></li>\n</ul>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-purchase\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#purchase\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Purchase</h1>\n<p dir=\"auto\">All YubiKeys except the blue \"security key\" model and the \"Bio Series - FIDO Edition\" are compatible with this guide. NEO models are limited to 2048-bit RSA keys. Compare YubiKeys <a href=\"https://www.yubico.com/products/yubikey-hardware/compare-products-series/\" rel=\"nofollow\">here</a>. A list of the YubiKeys compatible with OpenPGP is available <a href=\"https://support.yubico.com/hc/en-us/articles/360013790259-Using-Your-YubiKey-with-OpenPGP\" rel=\"nofollow\">here</a>. In May 2021, Yubico also released a press release and blog post about supporting resident ssh keys on their Yubikeys including blue \"security key 5 NFC\" with OpenSSH 8.2 or later, see <a href=\"https://www.yubico.com/blog/github-now-supports-ssh-security-keys/\" rel=\"nofollow\">here</a> for details.</p>\n<p dir=\"auto\">To verify a YubiKey is genuine, open a <a href=\"https://support.yubico.com/support/solutions/articles/15000009591-how-to-confirm-your-yubico-device-is-genuine-with-u2f\" rel=\"nofollow\">browser with U2F support</a> to <a href=\"https://www.yubico.com/genuine/\" rel=\"nofollow\">https://www.yubico.com/genuine/</a>. Insert a Yubico device, and select <em>Verify Device</em> to begin the process. Touch the YubiKey when prompted, and if asked, allow it to see the make and model of the device. If you see <em>Verification complete</em>, the device is authentic.</p>\n<p dir=\"auto\">This website verifies YubiKey device attestation certificates signed by a set of Yubico certificate authorities, and helps mitigate <a href=\"https://media.defcon.org/DEF%20CON%2025/DEF%20CON%2025%20presentations/DEF%20CON%2025%20-%20r00killah-and-securelyfitz-Secure-Tokin-and-Doobiekeys.pdf\" rel=\"nofollow\">supply chain attacks</a>.</p>\n<p dir=\"auto\">You will also need several small storage devices (microSD cards work well) for storing encrypted backups of your keys.</p>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-prepare-environment\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#prepare-environment\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Prepare environment</h1>\n<p dir=\"auto\">To create cryptographic keys, a secure environment that can be reasonably assured to be free of adversarial control is recommended. Here is a general ranking of environments most to least likely to be compromised:</p>\n<ol dir=\"auto\">\n<li>Daily-use operating system</li>\n<li>Virtual machine on daily-use host OS (using <a href=\"https://virt-manager.org/\" rel=\"nofollow\">virt-manager</a>, VirtualBox, or VMware)</li>\n<li>Separate hardened <a href=\"https://www.debian.org/\" rel=\"nofollow\">Debian</a> or <a href=\"https://www.openbsd.org/\" rel=\"nofollow\">OpenBSD</a> installation which can be dual booted</li>\n<li>Live image, such as <a href=\"https://www.debian.org/CD/live/\" rel=\"nofollow\">Debian Live</a> or <a href=\"https://tails.boum.org/index.en.html\" rel=\"nofollow\">Tails</a></li>\n<li>Secure hardware/firmware (<a href=\"https://www.coreboot.org/\" rel=\"nofollow\">Coreboot</a>, <a href=\"https://github.com/corna/me_cleaner\">Intel ME removed</a>)</li>\n<li>Dedicated air-gapped system with no networking capabilities</li>\n</ol>\n<p dir=\"auto\">This guide recommends using a bootable \"live\" Debian Linux image to provide such an environment, however, depending on your threat model, you may want to take fewer or more steps to secure it.</p>\n<p dir=\"auto\">To use Debian Live, download the latest image:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ curl -LfO https://cdimage.debian.org/debian-cd/current-live/amd64/iso-hybrid/SHA512SUMS\n\n$ curl -LfO https://cdimage.debian.org/debian-cd/current-live/amd64/iso-hybrid/SHA512SUMS.sign\n\n$ curl -LfO https://cdimage.debian.org/debian-cd/current-live/amd64/iso-hybrid/$(awk '/xfce.iso/ {print $2}' SHA512SUMS)\"><pre>$ <span class=\"pl-s1\">curl -LfO https://cdimage.debian.org/debian-cd/current-live/amd64/iso-hybrid/SHA512SUMS</span>\n\n$ <span class=\"pl-s1\">curl -LfO https://cdimage.debian.org/debian-cd/current-live/amd64/iso-hybrid/SHA512SUMS.sign</span>\n\n$ <span class=\"pl-s1\">curl -LfO https://cdimage.debian.org/debian-cd/current-live/amd64/iso-hybrid/<span class=\"pl-s\"><span class=\"pl-pds\">$(</span>awk <span class=\"pl-s\"><span class=\"pl-pds\">'</span>/xfce.iso/ {print $2}<span class=\"pl-pds\">'</span></span> SHA512SUMS<span class=\"pl-pds\">)</span></span></span></pre></div>\n<p dir=\"auto\">Verify the signature of the hashes file with GPG:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --verify SHA512SUMS.sign SHA512SUMS\ngpg: Signature made Sat 07 Oct 2023 01:24:57 PM PDT\ngpg:                using RSA key DF9B9C49EAA9298432589D76DA87E80D6294BE9B\ngpg: Can't check signature: No public key\n\n$ gpg --keyserver hkps://keyring.debian.org --recv DF9B9C49EAA9298432589D76DA87E80D6294BE9B\ngpg: key 0xDA87E80D6294BE9B: public key &quot;Debian CD signing key &lt;debian-cd@lists.debian.org&gt;&quot; imported\ngpg: Total number processed: 1\ngpg:               imported: 1\n\n$ gpg --verify SHA512SUMS.sign SHA512SUMS\ngpg: Signature made Sat 07 Oct 2023 01:24:57 PM PDT\ngpg:                using RSA key DF9B9C49EAA9298432589D76DA87E80D6294BE9B\ngpg: Good signature from &quot;Debian CD signing key &lt;debian-cd@lists.debian.org&gt;&quot; [unknown]\ngpg: WARNING: This key is not certified with a trusted signature!\ngpg:          There is no indication that the signature belongs to the owner.\nPrimary key fingerprint: DF9B 9C49 EAA9 2984 3258  9D76 DA87 E80D 6294 BE9B\"><pre>$ <span class=\"pl-s1\">gpg --verify SHA512SUMS.sign SHA512SUMS</span>\n<span class=\"pl-c1\">gpg: Signature made Sat 07 Oct 2023 01:24:57 PM PDT</span>\n<span class=\"pl-c1\">gpg:                using RSA key DF9B9C49EAA9298432589D76DA87E80D6294BE9B</span>\n<span class=\"pl-c1\">gpg: Can't check signature: No public key</span>\n\n$ <span class=\"pl-s1\">gpg --keyserver hkps://keyring.debian.org --recv DF9B9C49EAA9298432589D76DA87E80D6294BE9B</span>\n<span class=\"pl-c1\">gpg: key 0xDA87E80D6294BE9B: public key \"Debian CD signing key &lt;debian-cd@lists.debian.org&gt;\" imported</span>\n<span class=\"pl-c1\">gpg: Total number processed: 1</span>\n<span class=\"pl-c1\">gpg:               imported: 1</span>\n\n$ <span class=\"pl-s1\">gpg --verify SHA512SUMS.sign SHA512SUMS</span>\n<span class=\"pl-c1\">gpg: Signature made Sat 07 Oct 2023 01:24:57 PM PDT</span>\n<span class=\"pl-c1\">gpg:                using RSA key DF9B9C49EAA9298432589D76DA87E80D6294BE9B</span>\n<span class=\"pl-c1\">gpg: Good signature from \"Debian CD signing key &lt;debian-cd@lists.debian.org&gt;\" [unknown]</span>\n<span class=\"pl-c1\">gpg: WARNING: This key is not certified with a trusted signature!</span>\n<span class=\"pl-c1\">gpg:          There is no indication that the signature belongs to the owner.</span>\n<span class=\"pl-c1\">Primary key fingerprint: DF9B 9C49 EAA9 2984 3258  9D76 DA87 E80D 6294 BE9B</span></pre></div>\n<p dir=\"auto\">If the public key cannot be received, try changing the DNS resolver and/or use a different keyserver:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --keyserver hkps://keyserver.ubuntu.com:443 --recv DF9B9C49EAA9298432589D76DA87E80D6294BE9B\"><pre>$ <span class=\"pl-s1\">gpg --keyserver hkps://keyserver.ubuntu.com:443 --recv DF9B9C49EAA9298432589D76DA87E80D6294BE9B</span></pre></div>\n<p dir=\"auto\">Ensure the SHA512 hash of the live image matches the one in the signed file - if there following command produces output, it is correct:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ grep $(sha512sum debian-live-*-amd64-xfce.iso) SHA512SUMS\nSHA512SUMS:3c74715380c804798d892f55ebe4d2f79ae266be93df2468a066c192cfe1af6ddae3139e1937d5cbfa2fccb6fe291920148401de30f504c0876be2f141811ff1  debian-live-12.2.0-amd64-xfce.iso\"><pre>$ <span class=\"pl-s1\">grep <span class=\"pl-s\"><span class=\"pl-pds\">$(</span>sha512sum debian-live-<span class=\"pl-k\">*</span>-amd64-xfce.iso<span class=\"pl-pds\">)</span></span> SHA512SUMS</span>\n<span class=\"pl-c1\">SHA512SUMS:3c74715380c804798d892f55ebe4d2f79ae266be93df2468a066c192cfe1af6ddae3139e1937d5cbfa2fccb6fe291920148401de30f504c0876be2f141811ff1  debian-live-12.2.0-amd64-xfce.iso</span></pre></div>\n<p dir=\"auto\">See <a href=\"https://www.debian.org/CD/verify\" rel=\"nofollow\">Verifying authenticity of Debian CDs</a> for more information.</p>\n<p dir=\"auto\">Mount a storage device and copy the image to it:</p>\n<p dir=\"auto\"><strong>Linux</strong></p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ sudo dmesg | tail\nusb-storage 3-2:1.0: USB Mass Storage device detected\nscsi host2: usb-storage 3-2:1.0\nscsi 2:0:0:0: Direct-Access     TS-RDF5  SD  Transcend    TS3A PQ: 0 ANSI: 6\nsd 2:0:0:0: Attached scsi generic sg1 type 0\nsd 2:0:0:0: [sdb] 31116288 512-byte logical blocks: (15.9 GB/14.8 GiB)\nsd 2:0:0:0: [sdb] Write Protect is off\nsd 2:0:0:0: [sdb] Mode Sense: 23 00 00 00\nsd 2:0:0:0: [sdb] Write cache: disabled, read cache: enabled, doesn't support DPO or FUA\nsdb: sdb1 sdb2\nsd 2:0:0:0: [sdb] Attached SCSI removable disk\n\n$ sudo dd if=debian-live-*-amd64-xfce.iso of=/dev/sdb bs=4M status=progress ; sync\n465+1 records in\n465+1 records out\n1951432704 bytes (2.0 GB, 1.8 GiB) copied, 42.8543 s, 45.5 MB/s\"><pre>$ <span class=\"pl-s1\">sudo dmesg <span class=\"pl-k\">|</span> tail</span>\n<span class=\"pl-c1\">usb-storage 3-2:1.0: USB Mass Storage device detected</span>\n<span class=\"pl-c1\">scsi host2: usb-storage 3-2:1.0</span>\n<span class=\"pl-c1\">scsi 2:0:0:0: Direct-Access     TS-RDF5  SD  Transcend    TS3A PQ: 0 ANSI: 6</span>\n<span class=\"pl-c1\">sd 2:0:0:0: Attached scsi generic sg1 type 0</span>\n<span class=\"pl-c1\">sd 2:0:0:0: [sdb] 31116288 512-byte logical blocks: (15.9 GB/14.8 GiB)</span>\n<span class=\"pl-c1\">sd 2:0:0:0: [sdb] Write Protect is off</span>\n<span class=\"pl-c1\">sd 2:0:0:0: [sdb] Mode Sense: 23 00 00 00</span>\n<span class=\"pl-c1\">sd 2:0:0:0: [sdb] Write cache: disabled, read cache: enabled, doesn't support DPO or FUA</span>\n<span class=\"pl-c1\">sdb: sdb1 sdb2</span>\n<span class=\"pl-c1\">sd 2:0:0:0: [sdb] Attached SCSI removable disk</span>\n\n$ <span class=\"pl-s1\">sudo dd if=debian-live-<span class=\"pl-k\">*</span>-amd64-xfce.iso of=/dev/sdb bs=4M status=progress <span class=\"pl-k\">;</span> sync</span>\n<span class=\"pl-c1\">465+1 records in</span>\n<span class=\"pl-c1\">465+1 records out</span>\n<span class=\"pl-c1\">1951432704 bytes (2.0 GB, 1.8 GiB) copied, 42.8543 s, 45.5 MB/s</span></pre></div>\n<p dir=\"auto\"><strong>OpenBSD</strong></p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ dmesg | tail -n2\nsd2 at scsibus4 targ 1 lun 0: &lt;TS-RDF5, SD Transcend, TS3A&gt; SCSI4 0/direct removable serial.0000000000000\nsd2: 15193MB, 512 bytes/sector, 31116288 sectors\n\n$ doas dd if=debian-live-*-amd64-xfce.iso of=/dev/rsd2c bs=4m\n465+1 records in\n465+1 records out\n1951432704 bytes transferred in 139.125 secs (14026448 bytes/sec)\"><pre>$ <span class=\"pl-s1\">dmesg <span class=\"pl-k\">|</span> tail -n2</span>\n<span class=\"pl-c1\">sd2 at scsibus4 targ 1 lun 0: &lt;TS-RDF5, SD Transcend, TS3A&gt; SCSI4 0/direct removable serial.0000000000000</span>\n<span class=\"pl-c1\">sd2: 15193MB, 512 bytes/sector, 31116288 sectors</span>\n\n$ <span class=\"pl-s1\">doas dd if=debian-live-<span class=\"pl-k\">*</span>-amd64-xfce.iso of=/dev/rsd2c bs=4m</span>\n<span class=\"pl-c1\">465+1 records in</span>\n<span class=\"pl-c1\">465+1 records out</span>\n<span class=\"pl-c1\">1951432704 bytes transferred in 139.125 secs (14026448 bytes/sec)</span></pre></div>\n<p dir=\"auto\">Shut down the computer and disconnect internal hard drives and all unnecessary peripheral devices. If being run within a VM, this part can be skipped as no such devices should be attached to the VM since the image will still be run as a \"live image\".</p>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-required-software\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#required-software\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Required software</h1>\n<p dir=\"auto\">Boot the live image and configure networking.</p>\n<p dir=\"auto\"><strong>Note</strong> If the screen locks, unlock with <code>user</code>/<code>live</code>.</p>\n<p dir=\"auto\">Open the terminal and install required software packages.</p>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-debian-and-ubuntu\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#debian-and-ubuntu\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Debian and Ubuntu</h2>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ sudo apt update\n\n$ sudo apt -y upgrade\n\n$ sudo apt -y install wget gnupg2 gnupg-agent dirmngr cryptsetup scdaemon pcscd secure-delete hopenpgp-tools yubikey-personalization\"><pre>$ <span class=\"pl-s1\">sudo apt update</span>\n\n$ <span class=\"pl-s1\">sudo apt -y upgrade</span>\n\n$ <span class=\"pl-s1\">sudo apt -y install wget gnupg2 gnupg-agent dirmngr cryptsetup scdaemon pcscd secure-delete hopenpgp-tools yubikey-personalization</span></pre></div>\n<p dir=\"auto\"><strong>Note</strong>\nAs of 2023 June, the <code>hopenpgp-tools</code> is not part of the latest Debian 12 stable package repositories.</p>\n<p dir=\"auto\">To install it, go to <a href=\"https://packages.debian.org/sid/hopenpgp-tools\" rel=\"nofollow\">https://packages.debian.org/sid/hopenpgp-tools</a> to select your architecture and then an ftp server.</p>\n<p dir=\"auto\">Edit <code>/etc/apt/sources.list</code> and add the ftp server:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"deb http://ftp.debian.org/debian sid main\"><pre class=\"notranslate\"><code>deb http://ftp.debian.org/debian sid main\n</code></pre></div>\n<p dir=\"auto\">and then add this to <code>/etc/apt/preferences</code> (or a fragment, e.g. <code>/etc/apt/preferences.d/00-sid</code>) so that APT still prioritizes packages from the stable repository over sid.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Package: *\nPin: release n=sid\nPin-Priority: 10\"><pre class=\"notranslate\"><code>Package: *\nPin: release n=sid\nPin-Priority: 10\n</code></pre></div>\n<p dir=\"auto\"><strong>Note</strong> Live Ubuntu images <a href=\"https://github.com/drduh/YubiKey-Guide/issues/116\" data-hovercard-type=\"issue\" data-hovercard-url=\"/drduh/YubiKey-Guide/issues/116/hovercard\">may require modification</a> to <code>/etc/apt/sources.list</code> and may need additional packages:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ sudo apt -y install libssl-dev swig libpcsclite-dev\"><pre>$ <span class=\"pl-s1\">sudo apt -y install libssl-dev swig libpcsclite-dev</span></pre></div>\n<p dir=\"auto\"><strong>Optional</strong> Install the <code>ykman</code> utility, which will allow you to enable touch policies (requires admin PIN):</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ sudo apt -y install python3-pip python3-pyscard\n\n$ pip3 install PyOpenSSL\n\n$ pip3 install yubikey-manager\n\n$ sudo service pcscd start\n\n$ ~/.local/bin/ykman openpgp info\"><pre>$ <span class=\"pl-s1\">sudo apt -y install python3-pip python3-pyscard</span>\n\n$ <span class=\"pl-s1\">pip3 install PyOpenSSL</span>\n\n$ <span class=\"pl-s1\">pip3 install yubikey-manager</span>\n\n$ <span class=\"pl-s1\">sudo service pcscd start</span>\n\n$ <span class=\"pl-s1\"><span class=\"pl-k\">~</span>/.local/bin/ykman openpgp info</span></pre></div>\n<p dir=\"auto\"><strong>Note</strong> Debian 12 doesn't recommend installing non-Debian packaged Python applications globally. But fortunately, it isn't even necessary as <code>yubikey-manager</code> is available in the stable main repository:\n<code>$ sudo apt install yubikey-manager</code>.</p>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-fedora\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#fedora\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Fedora</h2>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ sudo dnf install wget\n\n$ wget https://github.com/rpmsphere/noarch/raw/master/r/rpmsphere-release-38-1.noarch.rpm\n\n$ sudo rpm -Uvh rpmsphere-release*rpm\n\n$ sudo dnf install gnupg2 dirmngr cryptsetup gnupg2-smime pcsc-tools opensc pcsc-lite secure-delete pgp-tools yubikey-personalization-gui\"><pre>$ <span class=\"pl-s1\">sudo dnf install wget</span>\n\n$ <span class=\"pl-s1\">wget https://github.com/rpmsphere/noarch/raw/master/r/rpmsphere-release-38-1.noarch.rpm</span>\n\n$ <span class=\"pl-s1\">sudo rpm -Uvh rpmsphere-release<span class=\"pl-k\">*</span>rpm</span>\n\n$ <span class=\"pl-s1\">sudo dnf install gnupg2 dirmngr cryptsetup gnupg2-smime pcsc-tools opensc pcsc-lite secure-delete pgp-tools yubikey-personalization-gui</span></pre></div>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-arch\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#arch\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Arch</h2>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ sudo pacman -Syu gnupg pcsclite ccid hopenpgp-tools yubikey-personalization\"><pre>$ <span class=\"pl-s1\">sudo pacman -Syu gnupg pcsclite ccid hopenpgp-tools yubikey-personalization</span></pre></div>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-rhel7\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#rhel7\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>RHEL7</h2>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ sudo yum install -y gnupg2 pinentry-curses pcsc-lite pcsc-lite-libs gnupg2-smime\"><pre>$ <span class=\"pl-s1\">sudo yum install -y gnupg2 pinentry-curses pcsc-lite pcsc-lite-libs gnupg2-smime</span></pre></div>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-nixos\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#nixos\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>NixOS</h2>\n<p dir=\"auto\">Generate an air-gapped NixOS LiveCD image with the given config:</p>\n<div class=\"highlight highlight-source-nix notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"# yubikey-installer.nix\nlet\n  configuration = { config, lib, pkgs, ... }:\n    with pkgs;\n    let\n      src = fetchGit &quot;https://github.com/drduh/YubiKey-Guide&quot;;\n\n      guide = &quot;${src}/README.md&quot;;\n\n      contrib = &quot;${src}/contrib&quot;;\n\n      drduhConfig = fetchGit &quot;https://github.com/drduh/config&quot;;\n\n      gpg-conf = &quot;${drduhConfig}/gpg.conf&quot;;\n\n      xserverCfg = config.services.xserver;\n\n      pinentryFlavour = if xserverCfg.desktopManager.lxqt.enable || xserverCfg.desktopManager.plasma5.enable then\n        &quot;qt&quot;\n      else if xserverCfg.desktopManager.xfce.enable then\n        &quot;gtk2&quot;\n      else if xserverCfg.enable || config.programs.sway.enable then\n        &quot;gnome3&quot;\n      else\n        &quot;curses&quot;;\n\n      # Instead of hard-coding the pinentry program, chose the appropriate one\n      # based on the environment of the image the user has chosen to build.\n      gpg-agent-conf = runCommand &quot;gpg-agent.conf&quot; {} ''\n        sed '/pinentry-program/d' ${drduhConfig}/gpg-agent.conf &gt; $out\n        echo &quot;pinentry-program ${pinentry.${pinentryFlavour}}/bin/pinentry&quot; &gt;&gt; $out\n      '';\n\n      view-yubikey-guide = writeShellScriptBin &quot;view-yubikey-guide&quot; ''\n        viewer=&quot;$(type -P xdg-open || true)&quot;\n        if [ -z &quot;$viewer&quot; ]; then\n          viewer=&quot;${glow}/bin/glow -p&quot;\n        fi\n        exec $viewer &quot;${guide}&quot;\n      '';\n\n      shortcut = makeDesktopItem {\n        name = &quot;yubikey-guide&quot;;\n        icon = &quot;${yubikey-manager-qt}/share/ykman-gui/icons/ykman.png&quot;;\n        desktopName = &quot;drduh's YubiKey Guide&quot;;\n        genericName = &quot;Guide to using YubiKey for GPG and SSH&quot;;\n        comment = &quot;Open the guide in a reader program&quot;;\n        categories = [ &quot;Documentation&quot; ];\n        exec = &quot;${view-yubikey-guide}/bin/view-yubikey-guide&quot;;\n      };\n\n      yubikey-guide = symlinkJoin {\n        name = &quot;yubikey-guide&quot;;\n        paths = [ view-yubikey-guide shortcut ];\n      };\n\n    in {\n      nixpkgs.overlays = [\n        # hopenpgp-tools in nixpkgs 23.05 is out-of-date and has a broken build\n        (final: prev: {\n          haskellPackages = prev.haskellPackages.override {\n            overrides = hsFinal: hsPrev:\n              let\n                optparse-applicative =\n                  final.haskell.lib.overrideCabal hsPrev.optparse-applicative\n                  (oldAttrs: {\n                    version = &quot;0.18.1.0&quot;;\n                    sha256 =\n                      &quot;sha256-Y4EatP0m6Cm4hoNkMlqIvjrMeYGfW7UAWy3TuWHsxJE=&quot;;\n                    libraryHaskellDepends =\n                      (oldAttrs.libraryHaskellDepends or [ ])\n                      ++ (with hsFinal; [\n                        text\n                        prettyprinter\n                        prettyprinter-ansi-terminal\n                      ]);\n                  });\n                hopenpgp-tools =\n                  (final.haskell.lib.overrideCabal hsPrev.hopenpgp-tools\n                    (oldAttrs: {\n                      version = &quot;0.23.8&quot;;\n                      sha256 =\n                        &quot;sha256-FYvlVE0o/LOYk3a2rucAqm7tg5D/uNQRRrCu/wlDNAE=&quot;;\n                      broken = false;\n                    })).override { inherit optparse-applicative; };\n              in { inherit hopenpgp-tools; };\n          };\n        })\n      ];\n\n      isoImage.isoBaseName = lib.mkForce &quot;nixos-yubikey&quot;;\n      # Uncomment this to disable compression and speed up image creation time\n      #isoImage.squashfsCompression = &quot;gzip -Xcompression-level 1&quot;;\n\n      # Always copytoram so that, if the image is booted from, e.g., a\n      # USB stick, nothing is mistakenly written to persistent storage.\n      boot.kernelParams = [ &quot;copytoram&quot; ];\n      # Secure defaults\n      boot.cleanTmpDir = true;\n      boot.kernel.sysctl = { &quot;kernel.unprivileged_bpf_disabled&quot; = 1; };\n\n      services.pcscd.enable = true;\n      services.udev.packages = [ yubikey-personalization ];\n\n      programs = {\n        ssh.startAgent = false;\n        gnupg.agent = {\n          enable = true;\n          enableSSHSupport = true;\n        };\n      };\n\n      environment.systemPackages = [\n        # Tools for backing up keys\n        paperkey\n        pgpdump\n        parted\n        cryptsetup\n\n        # Yubico's official tools\n        yubikey-manager\n        yubikey-manager-qt\n        yubikey-personalization\n        yubikey-personalization-gui\n        yubico-piv-tool\n        yubioath-flutter\n\n        # Testing\n        ent\n        (haskell.lib.justStaticExecutables haskellPackages.hopenpgp-tools)\n\n        # Password generation tools\n        diceware\n        pwgen\n\n        # Miscellaneous tools that might be useful beyond the scope of the guide\n        cfssl\n        pcsctools\n\n        # This guide itself (run `view-yubikey-guide` on the terminal to open it\n        # in a non-graphical environment).\n        yubikey-guide\n      ];\n\n      # Disable networking so the system is air-gapped\n      # Comment all of these lines out if you'll need internet access\n      boot.initrd.network.enable = false;\n      networking.dhcpcd.enable = false;\n      networking.dhcpcd.allowInterfaces = [];\n      networking.interfaces = {};\n      networking.firewall.enable = true;\n      networking.useDHCP = false;\n      networking.useNetworkd = false;\n      networking.wireless.enable = false;\n      networking.networkmanager.enable = lib.mkForce false;\n\n      # Unset history so it's never stored\n      # Set GNUPGHOME to an ephemeral location and configure GPG with the\n      # guide's recommended settings.\n      environment.interactiveShellInit = ''\n        unset HISTFILE\n        export GNUPGHOME=&quot;/run/user/$(id -u)/gnupg&quot;\n        if [ ! -d &quot;$GNUPGHOME&quot; ]; then\n          echo &quot;Creating \\$GNUPGHOMEâ€¦&quot;\n          install --verbose -m=0700 --directory=&quot;$GNUPGHOME&quot;\n        fi\n        [ ! -f &quot;$GNUPGHOME/gpg.conf&quot; ] &amp;&amp; cp --verbose ${gpg-conf} &quot;$GNUPGHOME/gpg.conf&quot;\n        [ ! -f &quot;$GNUPGHOME/gpg-agent.conf&quot; ] &amp;&amp; cp --verbose ${gpg-agent-conf} &quot;$GNUPGHOME/gpg-agent.conf&quot;\n        echo &quot;\\$GNUPGHOME is \\&quot;$GNUPGHOME\\&quot;&quot;\n      '';\n\n      # Copy the contents of contrib to the home directory, add a shortcut to\n      # the guide on the desktop, and link to the whole repo in the documents\n      # folder.\n      system.activationScripts.yubikeyGuide = let\n        homeDir = &quot;/home/nixos/&quot;;\n        desktopDir = homeDir + &quot;Desktop/&quot;;\n        documentsDir = homeDir + &quot;Documents/&quot;;\n      in ''\n        mkdir -p ${desktopDir} ${documentsDir}\n        chown nixos ${homeDir} ${desktopDir} ${documentsDir}\n\n        cp -R ${contrib}/* ${homeDir}\n        ln -sf ${yubikey-guide}/share/applications/yubikey-guide.desktop ${desktopDir}\n        ln -sfT ${src} ${documentsDir}/YubiKey-Guide\n      '';\n    };\n\n  nixos = import &lt;nixpkgs/nixos/release.nix&gt; {\n    inherit configuration;\n    supportedSystems = [ &quot;x86_64-linux&quot; ];\n  };\n\n  # Choose the one you like:\n  #nixos-yubikey = nixos.iso_minimal; # No graphical environment\n  #nixos-yubikey = nixos.iso_gnome;\n  nixos-yubikey = nixos.iso_plasma5;\n\nin {\n  inherit nixos-yubikey;\n}\"><pre><span class=\"pl-c\"># yubikey-installer.nix</span>\n<span class=\"pl-k\">let</span>\n  <span class=\"pl-c1\"><span class=\"pl-c1\">configuration</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-kos\">{</span> <span class=\"pl-s1\">config</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">lib</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">pkgs</span><span class=\"pl-kos\">,</span> ... <span class=\"pl-kos\">}</span>:\n    <span class=\"pl-k\">with</span> <span class=\"pl-s1\">pkgs</span><span class=\"pl-kos\">;</span>\n    <span class=\"pl-k\">let</span>\n      <span class=\"pl-c1\"><span class=\"pl-c1\">src</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-en\"><span class=\"pl-en\">fetchGit</span></span> <span class=\"pl-s\">\"https://github.com/drduh/YubiKey-Guide\"</span><span class=\"pl-kos\">;</span>\n\n      <span class=\"pl-c1\"><span class=\"pl-c1\">guide</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-s\">\"<span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">src</span><span class=\"pl-kos\">}</span></span>/README.md\"</span><span class=\"pl-kos\">;</span>\n\n      <span class=\"pl-c1\"><span class=\"pl-c1\">contrib</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-s\">\"<span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">src</span><span class=\"pl-kos\">}</span></span>/contrib\"</span><span class=\"pl-kos\">;</span>\n\n      <span class=\"pl-c1\"><span class=\"pl-c1\">drduhConfig</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-en\"><span class=\"pl-en\">fetchGit</span></span> <span class=\"pl-s\">\"https://github.com/drduh/config\"</span><span class=\"pl-kos\">;</span>\n\n      <span class=\"pl-c1\"><span class=\"pl-c1\">gpg-conf</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-s\">\"<span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">drduhConfig</span><span class=\"pl-kos\">}</span></span>/gpg.conf\"</span><span class=\"pl-kos\">;</span>\n\n      <span class=\"pl-c1\"><span class=\"pl-c1\">xserverCfg</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-s1\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\"><span class=\"pl-c1\">services</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">xserver</span></span><span class=\"pl-kos\">;</span>\n\n      <span class=\"pl-c1\"><span class=\"pl-c1\">pinentryFlavour</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-k\">if</span> <span class=\"pl-s1\">xserverCfg</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\"><span class=\"pl-c1\">desktopManager</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">lxqt</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">enable</span></span> <span class=\"pl-c1\">||</span> <span class=\"pl-s1\">xserverCfg</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\"><span class=\"pl-c1\">desktopManager</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">plasma5</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">enable</span></span> <span class=\"pl-k\">then</span>\n        <span class=\"pl-s\">\"qt\"</span>\n      <span class=\"pl-k\">else</span> <span class=\"pl-k\">if</span> <span class=\"pl-s1\">xserverCfg</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\"><span class=\"pl-c1\">desktopManager</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">xfce</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">enable</span></span> <span class=\"pl-k\">then</span>\n        <span class=\"pl-s\">\"gtk2\"</span>\n      <span class=\"pl-k\">else</span> <span class=\"pl-k\">if</span> <span class=\"pl-s1\">xserverCfg</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\"><span class=\"pl-c1\">enable</span></span> <span class=\"pl-c1\">||</span> <span class=\"pl-s1\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\"><span class=\"pl-c1\">programs</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">sway</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">enable</span></span> <span class=\"pl-k\">then</span>\n        <span class=\"pl-s\">\"gnome3\"</span>\n      <span class=\"pl-k\">else</span>\n        <span class=\"pl-s\">\"curses\"</span><span class=\"pl-kos\">;</span>\n\n      <span class=\"pl-c\"># Instead of hard-coding the pinentry program, chose the appropriate one</span>\n      <span class=\"pl-c\"># based on the environment of the image the user has chosen to build.</span>\n      <span class=\"pl-c1\"><span class=\"pl-c1\">gpg-agent-conf</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-en\"><span class=\"pl-s1\">runCommand</span></span> <span class=\"pl-s\">\"gpg-agent.conf\"</span> <span class=\"pl-kos\">{</span><span class=\"pl-kos\">}</span> <span class=\"pl-s\">''</span>\n<span class=\"pl-s\">        sed '/pinentry-program/d' <span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">drduhConfig</span><span class=\"pl-kos\">}</span></span>/gpg-agent.conf &gt; $out</span>\n<span class=\"pl-s\">        echo \"pinentry-program <span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">pinentry</span><span class=\"pl-kos\">.</span><span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">pinentryFlavour</span><span class=\"pl-kos\">}</span></span><span class=\"pl-kos\">}</span></span>/bin/pinentry\" &gt;&gt; $out</span>\n<span class=\"pl-s\">      ''</span><span class=\"pl-kos\">;</span>\n\n      <span class=\"pl-c1\"><span class=\"pl-c1\">view-yubikey-guide</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-en\"><span class=\"pl-s1\">writeShellScriptBin</span></span> <span class=\"pl-s\">\"view-yubikey-guide\"</span> <span class=\"pl-s\">''</span>\n<span class=\"pl-s\">        viewer=\"$(type -P xdg-open || true)\"</span>\n<span class=\"pl-s\">        if [ -z \"$viewer\" ]; then</span>\n<span class=\"pl-s\">          viewer=\"<span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">glow</span><span class=\"pl-kos\">}</span></span>/bin/glow -p\"</span>\n<span class=\"pl-s\">        fi</span>\n<span class=\"pl-s\">        exec $viewer \"<span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">guide</span><span class=\"pl-kos\">}</span></span>\"</span>\n<span class=\"pl-s\">      ''</span><span class=\"pl-kos\">;</span>\n\n      <span class=\"pl-c1\"><span class=\"pl-c1\">shortcut</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-en\"><span class=\"pl-s1\">makeDesktopItem</span></span> <span class=\"pl-kos\">{</span>\n        <span class=\"pl-c1\"><span class=\"pl-c1\">name</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-s\">\"yubikey-guide\"</span><span class=\"pl-kos\">;</span>\n        <span class=\"pl-c1\"><span class=\"pl-c1\">icon</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-s\">\"<span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">yubikey-manager-qt</span><span class=\"pl-kos\">}</span></span>/share/ykman-gui/icons/ykman.png\"</span><span class=\"pl-kos\">;</span>\n        <span class=\"pl-c1\"><span class=\"pl-c1\">desktopName</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-s\">\"drduh's YubiKey Guide\"</span><span class=\"pl-kos\">;</span>\n        <span class=\"pl-c1\"><span class=\"pl-c1\">genericName</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-s\">\"Guide to using YubiKey for GPG and SSH\"</span><span class=\"pl-kos\">;</span>\n        <span class=\"pl-c1\"><span class=\"pl-c1\">comment</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-s\">\"Open the guide in a reader program\"</span><span class=\"pl-kos\">;</span>\n        <span class=\"pl-c1\"><span class=\"pl-c1\">categories</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-kos\">[</span> <span class=\"pl-s\">\"Documentation\"</span> <span class=\"pl-kos\">]</span><span class=\"pl-kos\">;</span>\n        <span class=\"pl-c1\"><span class=\"pl-c1\">exec</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-s\">\"<span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">view-yubikey-guide</span><span class=\"pl-kos\">}</span></span>/bin/view-yubikey-guide\"</span><span class=\"pl-kos\">;</span>\n      <span class=\"pl-kos\">}</span><span class=\"pl-kos\">;</span>\n\n      <span class=\"pl-c1\"><span class=\"pl-c1\">yubikey-guide</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-en\"><span class=\"pl-s1\">symlinkJoin</span></span> <span class=\"pl-kos\">{</span>\n        <span class=\"pl-c1\"><span class=\"pl-c1\">name</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-s\">\"yubikey-guide\"</span><span class=\"pl-kos\">;</span>\n        <span class=\"pl-c1\"><span class=\"pl-c1\">paths</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-kos\">[</span> <span class=\"pl-s1\">view-yubikey-guide</span> <span class=\"pl-s1\">shortcut</span> <span class=\"pl-kos\">]</span><span class=\"pl-kos\">;</span>\n      <span class=\"pl-kos\">}</span><span class=\"pl-kos\">;</span>\n\n    <span class=\"pl-k\">in</span> <span class=\"pl-kos\">{</span>\n      <span class=\"pl-c1\"><span class=\"pl-c1\">nixpkgs</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">overlays</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-kos\">[</span>\n        <span class=\"pl-c\"># hopenpgp-tools in nixpkgs 23.05 is out-of-date and has a broken build</span>\n        <span class=\"pl-kos\">(</span><span class=\"pl-s1\">final</span>: <span class=\"pl-s1\">prev</span>: <span class=\"pl-kos\">{</span>\n          <span class=\"pl-c1\"><span class=\"pl-c1\">haskellPackages</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-s1\">prev</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\"><span class=\"pl-c1\">haskellPackages</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">override</span></span> <span class=\"pl-kos\">{</span>\n            <span class=\"pl-c1\"><span class=\"pl-c1\">overrides</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-s1\">hsFinal</span>: <span class=\"pl-s1\">hsPrev</span>:\n              <span class=\"pl-k\">let</span>\n                <span class=\"pl-c1\"><span class=\"pl-c1\">optparse-applicative</span></span> <span class=\"pl-kos\">=</span>\n                  <span class=\"pl-s1\">final</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\"><span class=\"pl-c1\">haskell</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">lib</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">overrideCabal</span></span> <span class=\"pl-s1\">hsPrev</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\"><span class=\"pl-c1\">optparse-applicative</span></span>\n                  <span class=\"pl-kos\">(</span><span class=\"pl-s1\">oldAttrs</span>: <span class=\"pl-kos\">{</span>\n                    <span class=\"pl-c1\"><span class=\"pl-c1\">version</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-s\">\"0.18.1.0\"</span><span class=\"pl-kos\">;</span>\n                    <span class=\"pl-c1\"><span class=\"pl-c1\">sha256</span></span> <span class=\"pl-kos\">=</span>\n                      <span class=\"pl-s\">\"sha256-Y4EatP0m6Cm4hoNkMlqIvjrMeYGfW7UAWy3TuWHsxJE=\"</span><span class=\"pl-kos\">;</span>\n                    <span class=\"pl-c1\"><span class=\"pl-c1\">libraryHaskellDepends</span></span> <span class=\"pl-kos\">=</span>\n                      <span class=\"pl-kos\">(</span><span class=\"pl-s1\">oldAttrs</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\"><span class=\"pl-c1\">libraryHaskellDepends</span></span> <span class=\"pl-k\">or</span> <span class=\"pl-kos\">[</span> <span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span>\n                      <span class=\"pl-c1\">++</span> <span class=\"pl-kos\">(</span><span class=\"pl-k\">with</span> <span class=\"pl-s1\">hsFinal</span><span class=\"pl-kos\">;</span> <span class=\"pl-kos\">[</span>\n                        <span class=\"pl-s1\">text</span>\n                        <span class=\"pl-s1\">prettyprinter</span>\n                        <span class=\"pl-s1\">prettyprinter-ansi-terminal</span>\n                      <span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n                  <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n                <span class=\"pl-c1\"><span class=\"pl-c1\">hopenpgp-tools</span></span> <span class=\"pl-kos\">=</span>\n                  <span class=\"pl-kos\">(</span><span class=\"pl-s1\">final</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\"><span class=\"pl-c1\">haskell</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">lib</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">overrideCabal</span></span> <span class=\"pl-s1\">hsPrev</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\"><span class=\"pl-c1\">hopenpgp-tools</span></span>\n                    <span class=\"pl-kos\">(</span><span class=\"pl-s1\">oldAttrs</span>: <span class=\"pl-kos\">{</span>\n                      <span class=\"pl-c1\"><span class=\"pl-c1\">version</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-s\">\"0.23.8\"</span><span class=\"pl-kos\">;</span>\n                      <span class=\"pl-c1\"><span class=\"pl-c1\">sha256</span></span> <span class=\"pl-kos\">=</span>\n                        <span class=\"pl-s\">\"sha256-FYvlVE0o/LOYk3a2rucAqm7tg5D/uNQRRrCu/wlDNAE=\"</span><span class=\"pl-kos\">;</span>\n                      <span class=\"pl-c1\"><span class=\"pl-c1\">broken</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-smi\">false</span><span class=\"pl-kos\">;</span>\n                    <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\"><span class=\"pl-en\">override</span></span> <span class=\"pl-kos\">{</span> <span class=\"pl-k\">inherit</span> <span class=\"pl-c1\">optparse-applicative</span><span class=\"pl-kos\">;</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">;</span>\n              <span class=\"pl-k\">in</span> <span class=\"pl-kos\">{</span> <span class=\"pl-k\">inherit</span> <span class=\"pl-c1\">hopenpgp-tools</span><span class=\"pl-kos\">;</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">;</span>\n          <span class=\"pl-kos\">}</span><span class=\"pl-kos\">;</span>\n        <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span>\n      <span class=\"pl-kos\">]</span><span class=\"pl-kos\">;</span>\n\n      <span class=\"pl-c1\"><span class=\"pl-c1\">isoImage</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">isoBaseName</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-s1\">lib</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\"><span class=\"pl-en\">mkForce</span></span> <span class=\"pl-s\">\"nixos-yubikey\"</span><span class=\"pl-kos\">;</span>\n      <span class=\"pl-c\"># Uncomment this to disable compression and speed up image creation time</span>\n      <span class=\"pl-c\">#isoImage.squashfsCompression = \"gzip -Xcompression-level 1\";</span>\n\n      <span class=\"pl-c\"># Always copytoram so that, if the image is booted from, e.g., a</span>\n      <span class=\"pl-c\"># USB stick, nothing is mistakenly written to persistent storage.</span>\n      <span class=\"pl-c1\"><span class=\"pl-c1\">boot</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">kernelParams</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-kos\">[</span> <span class=\"pl-s\">\"copytoram\"</span> <span class=\"pl-kos\">]</span><span class=\"pl-kos\">;</span>\n      <span class=\"pl-c\"># Secure defaults</span>\n      <span class=\"pl-c1\"><span class=\"pl-c1\">boot</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">cleanTmpDir</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-smi\">true</span><span class=\"pl-kos\">;</span>\n      <span class=\"pl-c1\"><span class=\"pl-c1\">boot</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">kernel</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">sysctl</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-kos\">{</span> <span class=\"pl-s\">\"kernel.unprivileged_bpf_disabled\"</span> <span class=\"pl-kos\">=</span> <span class=\"pl-c1\">1</span><span class=\"pl-kos\">;</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">;</span>\n\n      <span class=\"pl-c1\"><span class=\"pl-c1\">services</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">pcscd</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">enable</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-smi\">true</span><span class=\"pl-kos\">;</span>\n      <span class=\"pl-c1\"><span class=\"pl-c1\">services</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">udev</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">packages</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-kos\">[</span> <span class=\"pl-s1\">yubikey-personalization</span> <span class=\"pl-kos\">]</span><span class=\"pl-kos\">;</span>\n\n      <span class=\"pl-c1\"><span class=\"pl-c1\">programs</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-kos\">{</span>\n        <span class=\"pl-c1\"><span class=\"pl-c1\">ssh</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">startAgent</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-smi\">false</span><span class=\"pl-kos\">;</span>\n        <span class=\"pl-c1\"><span class=\"pl-c1\">gnupg</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">agent</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-kos\">{</span>\n          <span class=\"pl-c1\"><span class=\"pl-c1\">enable</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-smi\">true</span><span class=\"pl-kos\">;</span>\n          <span class=\"pl-c1\"><span class=\"pl-c1\">enableSSHSupport</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-smi\">true</span><span class=\"pl-kos\">;</span>\n        <span class=\"pl-kos\">}</span><span class=\"pl-kos\">;</span>\n      <span class=\"pl-kos\">}</span><span class=\"pl-kos\">;</span>\n\n      <span class=\"pl-c1\"><span class=\"pl-c1\">environment</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">systemPackages</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-kos\">[</span>\n        <span class=\"pl-c\"># Tools for backing up keys</span>\n        <span class=\"pl-s1\">paperkey</span>\n        <span class=\"pl-s1\">pgpdump</span>\n        <span class=\"pl-s1\">parted</span>\n        <span class=\"pl-s1\">cryptsetup</span>\n\n        <span class=\"pl-c\"># Yubico's official tools</span>\n        <span class=\"pl-s1\">yubikey-manager</span>\n        <span class=\"pl-s1\">yubikey-manager-qt</span>\n        <span class=\"pl-s1\">yubikey-personalization</span>\n        <span class=\"pl-s1\">yubikey-personalization-gui</span>\n        <span class=\"pl-s1\">yubico-piv-tool</span>\n        <span class=\"pl-s1\">yubioath-flutter</span>\n\n        <span class=\"pl-c\"># Testing</span>\n        <span class=\"pl-s1\">ent</span>\n        <span class=\"pl-kos\">(</span><span class=\"pl-s1\">haskell</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\"><span class=\"pl-c1\">lib</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">justStaticExecutables</span></span> <span class=\"pl-s1\">haskellPackages</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\"><span class=\"pl-c1\">hopenpgp-tools</span></span><span class=\"pl-kos\">)</span>\n\n        <span class=\"pl-c\"># Password generation tools</span>\n        <span class=\"pl-s1\">diceware</span>\n        <span class=\"pl-s1\">pwgen</span>\n\n        <span class=\"pl-c\"># Miscellaneous tools that might be useful beyond the scope of the guide</span>\n        <span class=\"pl-s1\">cfssl</span>\n        <span class=\"pl-s1\">pcsctools</span>\n\n        <span class=\"pl-c\"># This guide itself (run `view-yubikey-guide` on the terminal to open it</span>\n        <span class=\"pl-c\"># in a non-graphical environment).</span>\n        <span class=\"pl-s1\">yubikey-guide</span>\n      <span class=\"pl-kos\">]</span><span class=\"pl-kos\">;</span>\n\n      <span class=\"pl-c\"># Disable networking so the system is air-gapped</span>\n      <span class=\"pl-c\"># Comment all of these lines out if you'll need internet access</span>\n      <span class=\"pl-c1\"><span class=\"pl-c1\">boot</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">initrd</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">network</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">enable</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-smi\">false</span><span class=\"pl-kos\">;</span>\n      <span class=\"pl-c1\"><span class=\"pl-c1\">networking</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">dhcpcd</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">enable</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-smi\">false</span><span class=\"pl-kos\">;</span>\n      <span class=\"pl-c1\"><span class=\"pl-c1\">networking</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">dhcpcd</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">allowInterfaces</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-kos\">[</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">;</span>\n      <span class=\"pl-c1\"><span class=\"pl-c1\">networking</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">interfaces</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-kos\">{</span><span class=\"pl-kos\">}</span><span class=\"pl-kos\">;</span>\n      <span class=\"pl-c1\"><span class=\"pl-c1\">networking</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">firewall</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">enable</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-smi\">true</span><span class=\"pl-kos\">;</span>\n      <span class=\"pl-c1\"><span class=\"pl-c1\">networking</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">useDHCP</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-smi\">false</span><span class=\"pl-kos\">;</span>\n      <span class=\"pl-c1\"><span class=\"pl-c1\">networking</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">useNetworkd</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-smi\">false</span><span class=\"pl-kos\">;</span>\n      <span class=\"pl-c1\"><span class=\"pl-c1\">networking</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">wireless</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">enable</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-smi\">false</span><span class=\"pl-kos\">;</span>\n      <span class=\"pl-c1\"><span class=\"pl-c1\">networking</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">networkmanager</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">enable</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-s1\">lib</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\"><span class=\"pl-en\">mkForce</span></span> <span class=\"pl-smi\">false</span><span class=\"pl-kos\">;</span>\n\n      <span class=\"pl-c\"># Unset history so it's never stored</span>\n      <span class=\"pl-c\"># Set GNUPGHOME to an ephemeral location and configure GPG with the</span>\n      <span class=\"pl-c\"># guide's recommended settings.</span>\n      <span class=\"pl-c1\"><span class=\"pl-c1\">environment</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">interactiveShellInit</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-s\">''</span>\n<span class=\"pl-s\">        unset HISTFILE</span>\n<span class=\"pl-s\">        export GNUPGHOME=\"/run/user/$(id -u)/gnupg\"</span>\n<span class=\"pl-s\">        if [ ! -d \"$GNUPGHOME\" ]; then</span>\n<span class=\"pl-s\">          echo \"Creating \\$GNUPGHOMEâ€¦\"</span>\n<span class=\"pl-s\">          install --verbose -m=0700 --directory=\"$GNUPGHOME\"</span>\n<span class=\"pl-s\">        fi</span>\n<span class=\"pl-s\">        [ ! -f \"$GNUPGHOME/gpg.conf\" ] &amp;&amp; cp --verbose <span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">gpg-conf</span><span class=\"pl-kos\">}</span></span> \"$GNUPGHOME/gpg.conf\"</span>\n<span class=\"pl-s\">        [ ! -f \"$GNUPGHOME/gpg-agent.conf\" ] &amp;&amp; cp --verbose <span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">gpg-agent-conf</span><span class=\"pl-kos\">}</span></span> \"$GNUPGHOME/gpg-agent.conf\"</span>\n<span class=\"pl-s\">        echo \"\\$GNUPGHOME is \\\"$GNUPGHOME\\\"\"</span>\n<span class=\"pl-s\">      ''</span><span class=\"pl-kos\">;</span>\n\n      <span class=\"pl-c\"># Copy the contents of contrib to the home directory, add a shortcut to</span>\n      <span class=\"pl-c\"># the guide on the desktop, and link to the whole repo in the documents</span>\n      <span class=\"pl-c\"># folder.</span>\n      <span class=\"pl-c1\"><span class=\"pl-c1\">system</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">activationScripts</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">yubikeyGuide</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-k\">let</span>\n        <span class=\"pl-c1\"><span class=\"pl-c1\">homeDir</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-s\">\"/home/nixos/\"</span><span class=\"pl-kos\">;</span>\n        <span class=\"pl-c1\"><span class=\"pl-c1\">desktopDir</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-s1\">homeDir</span> <span class=\"pl-c1\">+</span> <span class=\"pl-s\">\"Desktop/\"</span><span class=\"pl-kos\">;</span>\n        <span class=\"pl-c1\"><span class=\"pl-c1\">documentsDir</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-s1\">homeDir</span> <span class=\"pl-c1\">+</span> <span class=\"pl-s\">\"Documents/\"</span><span class=\"pl-kos\">;</span>\n      <span class=\"pl-k\">in</span> <span class=\"pl-s\">''</span>\n<span class=\"pl-s\">        mkdir -p <span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">desktopDir</span><span class=\"pl-kos\">}</span></span> <span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">documentsDir</span><span class=\"pl-kos\">}</span></span></span>\n<span class=\"pl-s\">        chown nixos <span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">homeDir</span><span class=\"pl-kos\">}</span></span> <span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">desktopDir</span><span class=\"pl-kos\">}</span></span> <span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">documentsDir</span><span class=\"pl-kos\">}</span></span></span>\n<span class=\"pl-s\"></span>\n<span class=\"pl-s\">        cp -R <span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">contrib</span><span class=\"pl-kos\">}</span></span>/* <span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">homeDir</span><span class=\"pl-kos\">}</span></span></span>\n<span class=\"pl-s\">        ln -sf <span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">yubikey-guide</span><span class=\"pl-kos\">}</span></span>/share/applications/yubikey-guide.desktop <span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">desktopDir</span><span class=\"pl-kos\">}</span></span></span>\n<span class=\"pl-s\">        ln -sfT <span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">src</span><span class=\"pl-kos\">}</span></span> <span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">documentsDir</span><span class=\"pl-kos\">}</span></span>/YubiKey-Guide</span>\n<span class=\"pl-s\">      ''</span><span class=\"pl-kos\">;</span>\n    <span class=\"pl-kos\">}</span><span class=\"pl-kos\">;</span>\n\n  <span class=\"pl-c1\"><span class=\"pl-c1\">nixos</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-en\"><span class=\"pl-en\">import</span></span> <span class=\"pl-pds\">&lt;nixpkgs/nixos/release.nix&gt;</span> <span class=\"pl-kos\">{</span>\n    <span class=\"pl-k\">inherit</span> <span class=\"pl-c1\">configuration</span><span class=\"pl-kos\">;</span>\n    <span class=\"pl-c1\"><span class=\"pl-c1\">supportedSystems</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-kos\">[</span> <span class=\"pl-s\">\"x86_64-linux\"</span> <span class=\"pl-kos\">]</span><span class=\"pl-kos\">;</span>\n  <span class=\"pl-kos\">}</span><span class=\"pl-kos\">;</span>\n\n  <span class=\"pl-c\"># Choose the one you like:</span>\n  <span class=\"pl-c\">#nixos-yubikey = nixos.iso_minimal; # No graphical environment</span>\n  <span class=\"pl-c\">#nixos-yubikey = nixos.iso_gnome;</span>\n  <span class=\"pl-c1\"><span class=\"pl-c1\">nixos-yubikey</span></span> <span class=\"pl-kos\">=</span> <span class=\"pl-s1\">nixos</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\"><span class=\"pl-c1\">iso_plasma5</span></span><span class=\"pl-kos\">;</span>\n\n<span class=\"pl-k\">in</span> <span class=\"pl-kos\">{</span>\n  <span class=\"pl-k\">inherit</span> <span class=\"pl-c1\">nixos-yubikey</span><span class=\"pl-kos\">;</span>\n<span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\">Build the installer and copy it to a USB drive.</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ nix-build yubikey-installer.nix --out-link installer --attr nixos-yubikey\n\n$ sudo cp -v installer/iso/*.iso /dev/sdb; sync\n'installer/iso/nixos-yubikey-22.05beta-248980.gfedcba-x86_64-linux.iso' -&gt; '/dev/sdb'\"><pre>$ <span class=\"pl-s1\">nix-build yubikey-installer.nix --out-link installer --attr nixos-yubikey</span>\n\n$ <span class=\"pl-s1\">sudo cp -v installer/iso/<span class=\"pl-k\">*</span>.iso /dev/sdb<span class=\"pl-k\">;</span> sync</span>\n<span class=\"pl-c1\">'installer/iso/nixos-yubikey-22.05beta-248980.gfedcba-x86_64-linux.iso' -&gt; '/dev/sdb'</span></pre></div>\n<p dir=\"auto\">With this image, you won't need to manually create a <a href=\"#temporary-working-directory\">temporary working directory</a> or <a href=\"#harden-configuration\">harden the configuration</a>, as it was done when creating the image.</p>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-openbsd\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#openbsd\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>OpenBSD</h2>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ doas pkg_add gnupg pcsc-tools\"><pre>$ <span class=\"pl-s1\">doas pkg_add gnupg pcsc-tools</span></pre></div>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-macos\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#macos\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>macOS</h2>\n<p dir=\"auto\">Download and install <a href=\"https://brew.sh/\" rel=\"nofollow\">Homebrew</a> and the following packages:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ brew install gnupg yubikey-personalization hopenpgp-tools ykman pinentry-mac wget\"><pre>$ <span class=\"pl-s1\">brew install gnupg yubikey-personalization hopenpgp-tools ykman pinentry-mac wget</span></pre></div>\n<p dir=\"auto\"><strong>Note</strong> An additional Python package dependency may need to be installed to use <a href=\"https://support.yubico.com/support/solutions/articles/15000012643-yubikey-manager-cli-ykman-user-guide\" rel=\"nofollow\"><code>ykman</code></a> - <code>pip install yubikey-manager</code></p>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-windows\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#windows\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Windows</h2>\n<p dir=\"auto\">Download and install <a href=\"https://www.gpg4win.org/\" rel=\"nofollow\">Gpg4Win</a> and <a href=\"https://putty.org\" rel=\"nofollow\">PuTTY</a>.</p>\n<p dir=\"auto\">You may also need more recent versions of <a href=\"https://developers.yubico.com/yubikey-personalization/Releases/\" rel=\"nofollow\">yubikey-personalization</a> and <a href=\"https://developers.yubico.com/yubico-c/Releases/\" rel=\"nofollow\">yubico-c</a>.</p>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-entropy\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#entropy\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Entropy</h1>\n<p dir=\"auto\">Generating cryptographic keys requires high-quality <a href=\"https://www.random.org/randomness/\" rel=\"nofollow\">randomness</a>, measured as entropy.</p>\n<p dir=\"auto\">Most operating systems use software-based pseudorandom number generators or CPU-based hardware random number generators (HRNG).</p>\n<p dir=\"auto\">Optionally, you can use a separate hardware device like <a href=\"https://onerng.info/onerng/\" rel=\"nofollow\">OneRNG</a> to <a href=\"https://lwn.net/Articles/648550/\" rel=\"nofollow\">increase the speed</a> of entropy generation and possibly also the quality.</p>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-yubikey\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#yubikey\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>YubiKey</h2>\n<p dir=\"auto\">YubiKey firmware version 5.2.3 introduced \"Enhancements to OpenPGP 3.4 Support\" - which can optionally gather additional entropy from YubiKey via the SmartCard interface.</p>\n<p dir=\"auto\">To seed the kernel's PRNG with additional 512 bytes retrieved from the YubiKey:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ echo &quot;SCD RANDOM 512&quot; | gpg-connect-agent | sudo tee /dev/random | hexdump -C\"><pre>$ <span class=\"pl-s1\"><span class=\"pl-c1\">echo</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>SCD RANDOM 512<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">|</span> gpg-connect-agent <span class=\"pl-k\">|</span> sudo tee /dev/random <span class=\"pl-k\">|</span> hexdump -C</span></pre></div>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-onerng\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#onerng\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>OneRNG</h2>\n<p dir=\"auto\">Install <a href=\"https://wiki.archlinux.org/index.php/Rng-tools\" rel=\"nofollow\">rng-tools</a> software:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ sudo apt -y install at rng-tools python3-gnupg openssl\n\n$ wget https://github.com/OneRNG/onerng.github.io/raw/master/sw/onerng_3.7-1_all.deb\n\n$ sha256sum onerng_3.7-1_all.deb\nb7cda2fe07dce219a95dfeabeb5ee0f662f64ba1474f6b9dddacc3e8734d8f57  onerng_3.7-1_all.deb\n\n$ sudo dpkg -i onerng_3.7-1_all.deb\n\n$ echo &quot;HRNGDEVICE=/dev/ttyACM0&quot; | sudo tee /etc/default/rng-tools\"><pre>$ <span class=\"pl-s1\">sudo apt -y install at rng-tools python3-gnupg openssl</span>\n\n$ <span class=\"pl-s1\">wget https://github.com/OneRNG/onerng.github.io/raw/master/sw/onerng_3.7-1_all.deb</span>\n\n$ <span class=\"pl-s1\">sha256sum onerng_3.7-1_all.deb</span>\n<span class=\"pl-c1\">b7cda2fe07dce219a95dfeabeb5ee0f662f64ba1474f6b9dddacc3e8734d8f57  onerng_3.7-1_all.deb</span>\n\n$ <span class=\"pl-s1\">sudo dpkg -i onerng_3.7-1_all.deb</span>\n\n$ <span class=\"pl-s1\"><span class=\"pl-c1\">echo</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>HRNGDEVICE=/dev/ttyACM0<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">|</span> sudo tee /etc/default/rng-tools</span></pre></div>\n<p dir=\"auto\">Plug in the device and restart rng-tools:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ sudo atd\n\n$ sudo service rng-tools restart\"><pre>$ <span class=\"pl-s1\">sudo atd</span>\n\n$ <span class=\"pl-s1\">sudo service rng-tools restart</span></pre></div>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-creating-keys\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#creating-keys\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Creating keys</h1>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-temporary-working-directory\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#temporary-working-directory\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Temporary working directory</h2>\n<p dir=\"auto\">Create a temporary directory which will be cleared on <a href=\"https://en.wikipedia.org/wiki/Tmpfs\" rel=\"nofollow\">reboot</a> and set it as the GnuPG directory:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ export GNUPGHOME=$(mktemp -d -t gnupg_$(date +%Y%m%d%H%M)_XXX)\"><pre>$ <span class=\"pl-s1\"><span class=\"pl-k\">export</span> GNUPGHOME=<span class=\"pl-s\"><span class=\"pl-pds\">$(</span>mktemp -d -t gnupg_<span class=\"pl-s\"><span class=\"pl-pds\">$(</span>date +%Y%m%d%H%M<span class=\"pl-pds\">)</span></span>_XXX<span class=\"pl-pds\">)</span></span></span></pre></div>\n<p dir=\"auto\">Otherwise, to preserve the working environment, set the GnuPG directory to your home folder:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ export GNUPGHOME=~/gnupg-workspace\"><pre>$ <span class=\"pl-s1\"><span class=\"pl-k\">export</span> GNUPGHOME=<span class=\"pl-k\">~</span>/gnupg-workspace</span></pre></div>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-harden-configuration\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#harden-configuration\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Harden configuration</h2>\n<p dir=\"auto\">Create a hardened configuration in the temporary working directory with the following options:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ wget -O $GNUPGHOME/gpg.conf https://raw.githubusercontent.com/drduh/config/master/gpg.conf\n\n$ grep -ve &quot;^#&quot; $GNUPGHOME/gpg.conf\npersonal-cipher-preferences AES256 AES192 AES\npersonal-digest-preferences SHA512 SHA384 SHA256\npersonal-compress-preferences ZLIB BZIP2 ZIP Uncompressed\ndefault-preference-list SHA512 SHA384 SHA256 AES256 AES192 AES ZLIB BZIP2 ZIP Uncompressed\ncert-digest-algo SHA512\ns2k-digest-algo SHA512\ns2k-cipher-algo AES256\ncharset utf-8\nfixed-list-mode\nno-comments\nno-emit-version\nno-greeting\nkeyid-format 0xlong\nlist-options show-uid-validity\nverify-options show-uid-validity\nwith-fingerprint\nrequire-cross-certification\nno-symkey-cache\nuse-agent\nthrow-keyids\"><pre>$ <span class=\"pl-s1\">wget -O <span class=\"pl-smi\">$GNUPGHOME</span>/gpg.conf https://raw.githubusercontent.com/drduh/config/master/gpg.conf</span>\n\n$ <span class=\"pl-s1\">grep -ve <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>^#<span class=\"pl-pds\">\"</span></span> <span class=\"pl-smi\">$GNUPGHOME</span>/gpg.conf</span>\n<span class=\"pl-c1\">personal-cipher-preferences AES256 AES192 AES</span>\n<span class=\"pl-c1\">personal-digest-preferences SHA512 SHA384 SHA256</span>\n<span class=\"pl-c1\">personal-compress-preferences ZLIB BZIP2 ZIP Uncompressed</span>\n<span class=\"pl-c1\">default-preference-list SHA512 SHA384 SHA256 AES256 AES192 AES ZLIB BZIP2 ZIP Uncompressed</span>\n<span class=\"pl-c1\">cert-digest-algo SHA512</span>\n<span class=\"pl-c1\">s2k-digest-algo SHA512</span>\n<span class=\"pl-c1\">s2k-cipher-algo AES256</span>\n<span class=\"pl-c1\">charset utf-8</span>\n<span class=\"pl-c1\">fixed-list-mode</span>\n<span class=\"pl-c1\">no-comments</span>\n<span class=\"pl-c1\">no-emit-version</span>\n<span class=\"pl-c1\">no-greeting</span>\n<span class=\"pl-c1\">keyid-format 0xlong</span>\n<span class=\"pl-c1\">list-options show-uid-validity</span>\n<span class=\"pl-c1\">verify-options show-uid-validity</span>\n<span class=\"pl-c1\">with-fingerprint</span>\n<span class=\"pl-c1\">require-cross-certification</span>\n<span class=\"pl-c1\">no-symkey-cache</span>\n<span class=\"pl-c1\">use-agent</span>\n<span class=\"pl-c1\">throw-keyids</span></pre></div>\n<p dir=\"auto\"><strong>Tip</strong> Networking can be disabled for the remainder of the setup.</p>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-master-key\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#master-key\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Master key</h1>\n<p dir=\"auto\">The first key to generate is the master key. It will be used for certification only: to issue sub-keys that are used for encryption, signing and authentication.</p>\n<p dir=\"auto\"><strong>Important</strong> The master key should be kept offline at all times and only accessed to revoke or issue new sub-keys. Keys can also be generated on the YubiKey itself to ensure no other copies exist.</p>\n<p dir=\"auto\">You'll be prompted to enter and verify a passphrase - keep it handy as you'll need it multiple times later.</p>\n<p dir=\"auto\">Generate a strong passphrase which could be written down in a secure place or memorized:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --gen-random --armor 0 24\nydOmByxmDe63u7gqx2XI9eDgpvJwibNH\"><pre>$ <span class=\"pl-s1\">gpg --gen-random --armor 0 24</span>\n<span class=\"pl-c1\">ydOmByxmDe63u7gqx2XI9eDgpvJwibNH</span></pre></div>\n<p dir=\"auto\">Use upper case letters for improved readability if passwords are written down by hand:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ LC_ALL=C tr -dc '[:upper:]' &lt; /dev/urandom | fold -w 20 | head -n1\nBSSYMUGGTJQVWZZWOPJG\"><pre>$ <span class=\"pl-s1\">LC_ALL=C tr -dc <span class=\"pl-s\"><span class=\"pl-pds\">'</span>[:upper:]<span class=\"pl-pds\">'</span></span> <span class=\"pl-k\">&lt;</span> /dev/urandom <span class=\"pl-k\">|</span> fold -w 20 <span class=\"pl-k\">|</span> head -n1</span>\n<span class=\"pl-c1\">BSSYMUGGTJQVWZZWOPJG</span></pre></div>\n<p dir=\"auto\"><strong>Important</strong> Save this credential in a permanent, secure place as it will be needed to issue new sub-keys after expiration, and to provision additional YubiKeys, as well as to your Debian Live environment clipboard, as you'll need it several times throughout to generate keys.</p>\n<p dir=\"auto\"><strong>Tip</strong> On Linux or OpenBSD, select the password using the mouse or by double-clicking on it to copy to clipboard. Paste using the middle mouse button or <code>Shift</code>-<code>Insert</code>.</p>\n<p dir=\"auto\">Generate a new key with GPG, selecting <code>(8) RSA (set your own capabilities)</code>, <code>Certify</code> capability only and <code>4096</code> bit key size.</p>\n<p dir=\"auto\">Do <strong>not</strong> set the master (certify) key to expire - see <a href=\"#notes\">Note #3</a>.</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --expert --full-generate-key\nPlease select what kind of key you want:\n   (1) RSA and RSA (default)\n   (2) DSA and Elgamal\n   (3) DSA (sign only)\n   (4) RSA (sign only)\n   (7) DSA (set your own capabilities)\n   (8) RSA (set your own capabilities)\n   (9) ECC and ECC\n  (10) ECC (sign only)\n  (11) ECC (set your own capabilities)\n  (13) Existing key\n  (14) Existing key from card\nYour selection? 8\n\nPossible actions for a RSA key: Sign Certify Encrypt Authenticate\nCurrent allowed actions: Sign Certify Encrypt\n\n   (S) Toggle the sign capability\n   (E) Toggle the encrypt capability\n   (A) Toggle the authenticate capability\n   (Q) Finished\n\nYour selection? E\n\nPossible actions for a RSA key: Sign Certify Encrypt Authenticate\nCurrent allowed actions: Sign Certify\n\n   (S) Toggle the sign capability\n   (E) Toggle the encrypt capability\n   (A) Toggle the authenticate capability\n   (Q) Finished\n\nYour selection? S\n\nPossible actions for a RSA key: Sign Certify Encrypt Authenticate\nCurrent allowed actions: Certify\n\n   (S) Toggle the sign capability\n   (E) Toggle the encrypt capability\n   (A) Toggle the authenticate capability\n   (Q) Finished\n\nYour selection? Q\nRSA keys may be between 1024 and 4096 bits long.\nWhat keysize do you want? (2048) 4096\nRequested keysize is 4096 bits\nPlease specify how long the key should be valid.\n         0 = key does not expire\n      &lt;n&gt;  = key expires in n days\n      &lt;n&gt;w = key expires in n weeks\n      &lt;n&gt;m = key expires in n months\n      &lt;n&gt;y = key expires in n years\nKey is valid for? (0) 0\nKey does not expire at all\nIs this correct? (y/N) y\"><pre>$ <span class=\"pl-s1\">gpg --expert --full-generate-key</span>\n<span class=\"pl-c1\">Please select what kind of key you want:</span>\n<span class=\"pl-c1\">   (1) RSA and RSA (default)</span>\n<span class=\"pl-c1\">   (2) DSA and Elgamal</span>\n<span class=\"pl-c1\">   (3) DSA (sign only)</span>\n<span class=\"pl-c1\">   (4) RSA (sign only)</span>\n<span class=\"pl-c1\">   (7) DSA (set your own capabilities)</span>\n<span class=\"pl-c1\">   (8) RSA (set your own capabilities)</span>\n<span class=\"pl-c1\">   (9) ECC and ECC</span>\n<span class=\"pl-c1\">  (10) ECC (sign only)</span>\n<span class=\"pl-c1\">  (11) ECC (set your own capabilities)</span>\n<span class=\"pl-c1\">  (13) Existing key</span>\n<span class=\"pl-c1\">  (14) Existing key from card</span>\n<span class=\"pl-c1\">Your selection? 8</span>\n\n<span class=\"pl-c1\">Possible actions for a RSA key: Sign Certify Encrypt Authenticate</span>\n<span class=\"pl-c1\">Current allowed actions: Sign Certify Encrypt</span>\n\n<span class=\"pl-c1\">   (S) Toggle the sign capability</span>\n<span class=\"pl-c1\">   (E) Toggle the encrypt capability</span>\n<span class=\"pl-c1\">   (A) Toggle the authenticate capability</span>\n<span class=\"pl-c1\">   (Q) Finished</span>\n\n<span class=\"pl-c1\">Your selection? E</span>\n\n<span class=\"pl-c1\">Possible actions for a RSA key: Sign Certify Encrypt Authenticate</span>\n<span class=\"pl-c1\">Current allowed actions: Sign Certify</span>\n\n<span class=\"pl-c1\">   (S) Toggle the sign capability</span>\n<span class=\"pl-c1\">   (E) Toggle the encrypt capability</span>\n<span class=\"pl-c1\">   (A) Toggle the authenticate capability</span>\n<span class=\"pl-c1\">   (Q) Finished</span>\n\n<span class=\"pl-c1\">Your selection? S</span>\n\n<span class=\"pl-c1\">Possible actions for a RSA key: Sign Certify Encrypt Authenticate</span>\n<span class=\"pl-c1\">Current allowed actions: Certify</span>\n\n<span class=\"pl-c1\">   (S) Toggle the sign capability</span>\n<span class=\"pl-c1\">   (E) Toggle the encrypt capability</span>\n<span class=\"pl-c1\">   (A) Toggle the authenticate capability</span>\n<span class=\"pl-c1\">   (Q) Finished</span>\n\n<span class=\"pl-c1\">Your selection? Q</span>\n<span class=\"pl-c1\">RSA keys may be between 1024 and 4096 bits long.</span>\n<span class=\"pl-c1\">What keysize do you want? (2048) 4096</span>\n<span class=\"pl-c1\">Requested keysize is 4096 bits</span>\n<span class=\"pl-c1\">Please specify how long the key should be valid.</span>\n<span class=\"pl-c1\">         0 = key does not expire</span>\n<span class=\"pl-c1\">      &lt;n&gt;  = key expires in n days</span>\n<span class=\"pl-c1\">      &lt;n&gt;w = key expires in n weeks</span>\n<span class=\"pl-c1\">      &lt;n&gt;m = key expires in n months</span>\n<span class=\"pl-c1\">      &lt;n&gt;y = key expires in n years</span>\n<span class=\"pl-c1\">Key is valid for? (0) 0</span>\n<span class=\"pl-c1\">Key does not expire at all</span>\n<span class=\"pl-c1\">Is this correct? (y/N) y</span></pre></div>\n<p dir=\"auto\">Input any name and email address (it doesn't have to be valid):</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"GnuPG needs to construct a user ID to identify your key.\n\nReal name: Dr Duh\nEmail address: doc@duh.to\nComment: [Optional - leave blank]\nYou selected this USER-ID:\n    &quot;Dr Duh &lt;doc@duh.to&gt;&quot;\n\nChange (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit? o\n\nWe need to generate a lot of random bytes. It is a good idea to perform\nsome other action (type on the keyboard, move the mouse, utilize the\ndisks) during the prime generation; this gives the random number\ngenerator a better chance to gain enough entropy.\n\ngpg: /tmp.FLZC0xcM/trustdb.gpg: trustdb created\ngpg: key 0xFF3E7D88647EBCDB marked as ultimately trusted\ngpg: directory '/tmp.FLZC0xcM/openpgp-revocs.d' created\ngpg: revocation certificate stored as '/tmp.FLZC0xcM/openpgp-revocs.d/011CE16BD45B27A55BA8776DFF3E7D88647EBCDB.rev'\npublic and secret key created and signed.\n\npub   rsa4096/0xFF3E7D88647EBCDB 2017-10-09 [C]\n      Key fingerprint = 011C E16B D45B 27A5 5BA8  776D FF3E 7D88 647E BCDB\nuid                              Dr Duh &lt;doc@duh.to&gt;\"><pre><span class=\"pl-c1\">GnuPG needs to construct a user ID to identify your key.</span>\n\n<span class=\"pl-c1\">Real name: Dr Duh</span>\n<span class=\"pl-c1\">Email address: doc@duh.to</span>\n<span class=\"pl-c1\">Comment: [Optional - leave blank]</span>\n<span class=\"pl-c1\">You selected this USER-ID:</span>\n<span class=\"pl-c1\">    \"Dr Duh &lt;doc@duh.to&gt;\"</span>\n\n<span class=\"pl-c1\">Change (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit? o</span>\n\n<span class=\"pl-c1\">We need to generate a lot of random bytes. It is a good idea to perform</span>\n<span class=\"pl-c1\">some other action (type on the keyboard, move the mouse, utilize the</span>\n<span class=\"pl-c1\">disks) during the prime generation; this gives the random number</span>\n<span class=\"pl-c1\">generator a better chance to gain enough entropy.</span>\n\n<span class=\"pl-c1\">gpg: /tmp.FLZC0xcM/trustdb.gpg: trustdb created</span>\n<span class=\"pl-c1\">gpg: key 0xFF3E7D88647EBCDB marked as ultimately trusted</span>\n<span class=\"pl-c1\">gpg: directory '/tmp.FLZC0xcM/openpgp-revocs.d' created</span>\n<span class=\"pl-c1\">gpg: revocation certificate stored as '/tmp.FLZC0xcM/openpgp-revocs.d/011CE16BD45B27A55BA8776DFF3E7D88647EBCDB.rev'</span>\n<span class=\"pl-c1\">public and secret key created and signed.</span>\n\n<span class=\"pl-c1\">pub   rsa4096/0xFF3E7D88647EBCDB 2017-10-09 [C]</span>\n<span class=\"pl-c1\">      Key fingerprint = 011C E16B D45B 27A5 5BA8  776D FF3E 7D88 647E BCDB</span>\n<span class=\"pl-c1\">uid                              Dr Duh &lt;doc@duh.to&gt;</span></pre></div>\n<p dir=\"auto\">Export the key ID as a <a href=\"https://stackoverflow.com/questions/1158091/defining-a-variable-with-or-without-export/1158231#1158231\" rel=\"nofollow\">variable</a> (<code>KEYID</code>) for use later:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ export KEYID=0xFF3E7D88647EBCDB\"><pre>$ <span class=\"pl-s1\"><span class=\"pl-k\">export</span> KEYID=0xFF3E7D88647EBCDB</span></pre></div>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-sign-with-existing-key\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#sign-with-existing-key\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Sign with existing key</h1>\n<p dir=\"auto\">(Optional) If you already have a PGP key, you may want to sign the new key with the old one to prove that the new key is controlled by you.</p>\n<p dir=\"auto\">Export your existing key to move it to the working keyring:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --export-secret-keys --armor --output /tmp/new.sec\"><pre>$ <span class=\"pl-s1\">gpg --export-secret-keys --armor --output /tmp/new.sec</span></pre></div>\n<p dir=\"auto\">Then sign the new key:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg  --default-key $OLDKEY --sign-key $KEYID\"><pre>$ <span class=\"pl-s1\">gpg  --default-key <span class=\"pl-smi\">$OLDKEY</span> --sign-key <span class=\"pl-smi\">$KEYID</span></span></pre></div>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-sub-keys\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#sub-keys\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Sub-keys</h1>\n<p dir=\"auto\">Edit the master key to add sub-keys:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --expert --edit-key $KEYID\n\nSecret key is available.\n\nsec  rsa4096/0xEA5DE91459B80592\n    created: 2017-10-09  expires: never       usage: C\n    trust: ultimate      validity: ultimate\n[ultimate] (1). Dr Duh &lt;doc@duh.to&gt;\"><pre>$ <span class=\"pl-s1\">gpg --expert --edit-key <span class=\"pl-smi\">$KEYID</span></span>\n\n<span class=\"pl-c1\">Secret key is available.</span>\n\n<span class=\"pl-c1\">sec  rsa4096/0xEA5DE91459B80592</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: never       usage: C</span>\n<span class=\"pl-c1\">    trust: ultimate      validity: ultimate</span>\n<span class=\"pl-c1\">[ultimate] (1). Dr Duh &lt;doc@duh.to&gt;</span></pre></div>\n<p dir=\"auto\">Use 4096-bit RSA keys.</p>\n<p dir=\"auto\">Use a 1 year expiration for sub-keys - they can be renewed using the offline master key. See <a href=\"#rotating-keys\">rotating keys</a>.</p>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-signing\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#signing\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Signing</h2>\n<p dir=\"auto\">Create a <a href=\"https://stackoverflow.com/questions/5421107/can-rsa-be-both-used-as-encryption-and-signature/5432623#5432623\" rel=\"nofollow\">signing key</a> by selecting <code>addkey</code> then <code>(4) RSA (sign only)</code>:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"gpg&gt; addkey\nKey is protected.\n\nYou need a passphrase to unlock the secret key for\nuser: &quot;Dr Duh &lt;doc@duh.to&gt;&quot;\n4096-bit RSA key, ID 0xFF3E7D88647EBCDB, created 2016-05-24\n\nPlease select what kind of key you want:\n   (3) DSA (sign only)\n   (4) RSA (sign only)\n   (5) Elgamal (encrypt only)\n   (6) RSA (encrypt only)\n   (7) DSA (set your own capabilities)\n   (8) RSA (set your own capabilities)\nYour selection? 4\nRSA keys may be between 1024 and 4096 bits long.\nWhat keysize do you want? (2048) 4096\nRequested keysize is 4096 bits\nPlease specify how long the key should be valid.\n         0 = key does not expire\n      &lt;n&gt;  = key expires in n days\n      &lt;n&gt;w = key expires in n weeks\n      &lt;n&gt;m = key expires in n months\n      &lt;n&gt;y = key expires in n years\nKey is valid for? (0) 1y\nKey expires at Mon 10 Sep 2018 00:00:00 PM UTC\nIs this correct? (y/N) y\nReally create? (y/N) y\nWe need to generate a lot of random bytes. It is a good idea to perform\nsome other action (type on the keyboard, move the mouse, utilize the\ndisks) during the prime generation; this gives the random number\ngenerator a better chance to gain enough entropy.\n\nsec  rsa4096/0xFF3E7D88647EBCDB\n    created: 2017-10-09  expires: never       usage: C\n    trust: ultimate      validity: ultimate\nssb  rsa4096/0xBECFA3C1AE191D15\n    created: 2017-10-09  expires: 2018-10-09       usage: S\n[ultimate] (1). Dr Duh &lt;doc@duh.to&gt;\"><pre><span class=\"pl-c1\">gpg&gt; addkey</span>\n<span class=\"pl-c1\">Key is protected.</span>\n\n<span class=\"pl-c1\">You need a passphrase to unlock the secret key for</span>\n<span class=\"pl-c1\">user: \"Dr Duh &lt;doc@duh.to&gt;\"</span>\n<span class=\"pl-c1\">4096-bit RSA key, ID 0xFF3E7D88647EBCDB, created 2016-05-24</span>\n\n<span class=\"pl-c1\">Please select what kind of key you want:</span>\n<span class=\"pl-c1\">   (3) DSA (sign only)</span>\n<span class=\"pl-c1\">   (4) RSA (sign only)</span>\n<span class=\"pl-c1\">   (5) Elgamal (encrypt only)</span>\n<span class=\"pl-c1\">   (6) RSA (encrypt only)</span>\n<span class=\"pl-c1\">   (7) DSA (set your own capabilities)</span>\n<span class=\"pl-c1\">   (8) RSA (set your own capabilities)</span>\n<span class=\"pl-c1\">Your selection? 4</span>\n<span class=\"pl-c1\">RSA keys may be between 1024 and 4096 bits long.</span>\n<span class=\"pl-c1\">What keysize do you want? (2048) 4096</span>\n<span class=\"pl-c1\">Requested keysize is 4096 bits</span>\n<span class=\"pl-c1\">Please specify how long the key should be valid.</span>\n<span class=\"pl-c1\">         0 = key does not expire</span>\n<span class=\"pl-c1\">      &lt;n&gt;  = key expires in n days</span>\n<span class=\"pl-c1\">      &lt;n&gt;w = key expires in n weeks</span>\n<span class=\"pl-c1\">      &lt;n&gt;m = key expires in n months</span>\n<span class=\"pl-c1\">      &lt;n&gt;y = key expires in n years</span>\n<span class=\"pl-c1\">Key is valid for? (0) 1y</span>\n<span class=\"pl-c1\">Key expires at Mon 10 Sep 2018 00:00:00 PM UTC</span>\n<span class=\"pl-c1\">Is this correct? (y/N) y</span>\n<span class=\"pl-c1\">Really create? (y/N) y</span>\n<span class=\"pl-c1\">We need to generate a lot of random bytes. It is a good idea to perform</span>\n<span class=\"pl-c1\">some other action (type on the keyboard, move the mouse, utilize the</span>\n<span class=\"pl-c1\">disks) during the prime generation; this gives the random number</span>\n<span class=\"pl-c1\">generator a better chance to gain enough entropy.</span>\n\n<span class=\"pl-c1\">sec  rsa4096/0xFF3E7D88647EBCDB</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: never       usage: C</span>\n<span class=\"pl-c1\">    trust: ultimate      validity: ultimate</span>\n<span class=\"pl-c1\">ssb  rsa4096/0xBECFA3C1AE191D15</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: 2018-10-09       usage: S</span>\n<span class=\"pl-c1\">[ultimate] (1). Dr Duh &lt;doc@duh.to&gt;</span></pre></div>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-encryption\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#encryption\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Encryption</h2>\n<p dir=\"auto\">Next, create an <a href=\"https://www.cs.cornell.edu/courses/cs5430/2015sp/notes/rsa_sign_vs_dec.php\" rel=\"nofollow\">encryption key</a> by selecting <code>(6) RSA (encrypt only)</code>:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"gpg&gt; addkey\nPlease select what kind of key you want:\n   (3) DSA (sign only)\n   (4) RSA (sign only)\n   (5) Elgamal (encrypt only)\n   (6) RSA (encrypt only)\n   (7) DSA (set your own capabilities)\n   (8) RSA (set your own capabilities)\n  (10) ECC (sign only)\n  (11) ECC (set your own capabilities)\n  (12) ECC (encrypt only)\n  (13) Existing key\nYour selection? 6\nRSA keys may be between 1024 and 4096 bits long.\nWhat keysize do you want? (2048) 4096\nRequested keysize is 4096 bits\nPlease specify how long the key should be valid.\n         0 = key does not expire\n      &lt;n&gt;  = key expires in n days\n      &lt;n&gt;w = key expires in n weeks\n      &lt;n&gt;m = key expires in n months\n      &lt;n&gt;y = key expires in n years\nKey is valid for? (0) 1y\nKey expires at Mon 10 Sep 2018 00:00:00 PM UTC\nIs this correct? (y/N) y\nReally create? (y/N) y\nWe need to generate a lot of random bytes. It is a good idea to perform\nsome other action (type on the keyboard, move the mouse, utilize the\ndisks) during the prime generation; this gives the random number\ngenerator a better chance to gain enough entropy.\n\nsec  rsa4096/0xFF3E7D88647EBCDB\n    created: 2017-10-09  expires: never       usage: C\n    trust: ultimate      validity: ultimate\nssb  rsa4096/0xBECFA3C1AE191D15\n    created: 2017-10-09  expires: 2018-10-09       usage: S\nssb  rsa4096/0x5912A795E90DD2CF\n    created: 2017-10-09  expires: 2018-10-09       usage: E\n[ultimate] (1). Dr Duh &lt;doc@duh.to&gt;\"><pre><span class=\"pl-c1\">gpg&gt; addkey</span>\n<span class=\"pl-c1\">Please select what kind of key you want:</span>\n<span class=\"pl-c1\">   (3) DSA (sign only)</span>\n<span class=\"pl-c1\">   (4) RSA (sign only)</span>\n<span class=\"pl-c1\">   (5) Elgamal (encrypt only)</span>\n<span class=\"pl-c1\">   (6) RSA (encrypt only)</span>\n<span class=\"pl-c1\">   (7) DSA (set your own capabilities)</span>\n<span class=\"pl-c1\">   (8) RSA (set your own capabilities)</span>\n<span class=\"pl-c1\">  (10) ECC (sign only)</span>\n<span class=\"pl-c1\">  (11) ECC (set your own capabilities)</span>\n<span class=\"pl-c1\">  (12) ECC (encrypt only)</span>\n<span class=\"pl-c1\">  (13) Existing key</span>\n<span class=\"pl-c1\">Your selection? 6</span>\n<span class=\"pl-c1\">RSA keys may be between 1024 and 4096 bits long.</span>\n<span class=\"pl-c1\">What keysize do you want? (2048) 4096</span>\n<span class=\"pl-c1\">Requested keysize is 4096 bits</span>\n<span class=\"pl-c1\">Please specify how long the key should be valid.</span>\n<span class=\"pl-c1\">         0 = key does not expire</span>\n<span class=\"pl-c1\">      &lt;n&gt;  = key expires in n days</span>\n<span class=\"pl-c1\">      &lt;n&gt;w = key expires in n weeks</span>\n<span class=\"pl-c1\">      &lt;n&gt;m = key expires in n months</span>\n<span class=\"pl-c1\">      &lt;n&gt;y = key expires in n years</span>\n<span class=\"pl-c1\">Key is valid for? (0) 1y</span>\n<span class=\"pl-c1\">Key expires at Mon 10 Sep 2018 00:00:00 PM UTC</span>\n<span class=\"pl-c1\">Is this correct? (y/N) y</span>\n<span class=\"pl-c1\">Really create? (y/N) y</span>\n<span class=\"pl-c1\">We need to generate a lot of random bytes. It is a good idea to perform</span>\n<span class=\"pl-c1\">some other action (type on the keyboard, move the mouse, utilize the</span>\n<span class=\"pl-c1\">disks) during the prime generation; this gives the random number</span>\n<span class=\"pl-c1\">generator a better chance to gain enough entropy.</span>\n\n<span class=\"pl-c1\">sec  rsa4096/0xFF3E7D88647EBCDB</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: never       usage: C</span>\n<span class=\"pl-c1\">    trust: ultimate      validity: ultimate</span>\n<span class=\"pl-c1\">ssb  rsa4096/0xBECFA3C1AE191D15</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: 2018-10-09       usage: S</span>\n<span class=\"pl-c1\">ssb  rsa4096/0x5912A795E90DD2CF</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: 2018-10-09       usage: E</span>\n<span class=\"pl-c1\">[ultimate] (1). Dr Duh &lt;doc@duh.to&gt;</span></pre></div>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-authentication\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#authentication\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Authentication</h2>\n<p dir=\"auto\">Finally, create an <a href=\"https://superuser.com/questions/390265/what-is-a-gpg-with-authenticate-capability-used-for\" rel=\"nofollow\">authentication key</a>.</p>\n<p dir=\"auto\">GPG doesn't provide an authenticate-only key type, so select <code>(8) RSA (set your own capabilities)</code> and toggle the required capabilities until the only allowed action is <code>Authenticate</code>:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"gpg&gt; addkey\nPlease select what kind of key you want:\n   (3) DSA (sign only)\n   (4) RSA (sign only)\n   (5) Elgamal (encrypt only)\n   (6) RSA (encrypt only)\n   (7) DSA (set your own capabilities)\n   (8) RSA (set your own capabilities)\n  (10) ECC (sign only)\n  (11) ECC (set your own capabilities)\n  (12) ECC (encrypt only)\n  (13) Existing key\nYour selection? 8\n\nPossible actions for a RSA key: Sign Encrypt Authenticate\nCurrent allowed actions: Sign Encrypt\n\n   (S) Toggle the sign capability\n   (E) Toggle the encrypt capability\n   (A) Toggle the authenticate capability\n   (Q) Finished\n\nYour selection? S\n\nPossible actions for a RSA key: Sign Encrypt Authenticate\nCurrent allowed actions: Encrypt\n\n   (S) Toggle the sign capability\n   (E) Toggle the encrypt capability\n   (A) Toggle the authenticate capability\n   (Q) Finished\n\nYour selection? E\n\nPossible actions for a RSA key: Sign Encrypt Authenticate\nCurrent allowed actions:\n\n   (S) Toggle the sign capability\n   (E) Toggle the encrypt capability\n   (A) Toggle the authenticate capability\n   (Q) Finished\n\nYour selection? A\n\nPossible actions for a RSA key: Sign Encrypt Authenticate\nCurrent allowed actions: Authenticate\n\n   (S) Toggle the sign capability\n   (E) Toggle the encrypt capability\n   (A) Toggle the authenticate capability\n   (Q) Finished\n\nYour selection? Q\nRSA keys may be between 1024 and 4096 bits long.\nWhat keysize do you want? (2048) 4096\nRequested keysize is 4096 bits\nPlease specify how long the key should be valid.\n         0 = key does not expire\n      &lt;n&gt;  = key expires in n days\n      &lt;n&gt;w = key expires in n weeks\n      &lt;n&gt;m = key expires in n months\n      &lt;n&gt;y = key expires in n years\nKey is valid for? (0) 1y\nKey expires at Mon 10 Sep 2018 00:00:00 PM UTC\nIs this correct? (y/N) y\nReally create? (y/N) y\nWe need to generate a lot of random bytes. It is a good idea to perform\nsome other action (type on the keyboard, move the mouse, utilize the\ndisks) during the prime generation; this gives the random number\ngenerator a better chance to gain enough entropy.\n\nsec  rsa4096/0xFF3E7D88647EBCDB\n    created: 2017-10-09  expires: never       usage: C\n    trust: ultimate      validity: ultimate\nssb  rsa4096/0xBECFA3C1AE191D15\n    created: 2017-10-09  expires: 2018-10-09       usage: S\nssb  rsa4096/0x5912A795E90DD2CF\n    created: 2017-10-09  expires: 2018-10-09       usage: E\nssb  rsa4096/0x3F29127E79649A3D\n    created: 2017-10-09  expires: 2018-10-09       usage: A\n[ultimate] (1). Dr Duh &lt;doc@duh.to&gt;\"><pre><span class=\"pl-c1\">gpg&gt; addkey</span>\n<span class=\"pl-c1\">Please select what kind of key you want:</span>\n<span class=\"pl-c1\">   (3) DSA (sign only)</span>\n<span class=\"pl-c1\">   (4) RSA (sign only)</span>\n<span class=\"pl-c1\">   (5) Elgamal (encrypt only)</span>\n<span class=\"pl-c1\">   (6) RSA (encrypt only)</span>\n<span class=\"pl-c1\">   (7) DSA (set your own capabilities)</span>\n<span class=\"pl-c1\">   (8) RSA (set your own capabilities)</span>\n<span class=\"pl-c1\">  (10) ECC (sign only)</span>\n<span class=\"pl-c1\">  (11) ECC (set your own capabilities)</span>\n<span class=\"pl-c1\">  (12) ECC (encrypt only)</span>\n<span class=\"pl-c1\">  (13) Existing key</span>\n<span class=\"pl-c1\">Your selection? 8</span>\n\n<span class=\"pl-c1\">Possible actions for a RSA key: Sign Encrypt Authenticate</span>\n<span class=\"pl-c1\">Current allowed actions: Sign Encrypt</span>\n\n<span class=\"pl-c1\">   (S) Toggle the sign capability</span>\n<span class=\"pl-c1\">   (E) Toggle the encrypt capability</span>\n<span class=\"pl-c1\">   (A) Toggle the authenticate capability</span>\n<span class=\"pl-c1\">   (Q) Finished</span>\n\n<span class=\"pl-c1\">Your selection? S</span>\n\n<span class=\"pl-c1\">Possible actions for a RSA key: Sign Encrypt Authenticate</span>\n<span class=\"pl-c1\">Current allowed actions: Encrypt</span>\n\n<span class=\"pl-c1\">   (S) Toggle the sign capability</span>\n<span class=\"pl-c1\">   (E) Toggle the encrypt capability</span>\n<span class=\"pl-c1\">   (A) Toggle the authenticate capability</span>\n<span class=\"pl-c1\">   (Q) Finished</span>\n\n<span class=\"pl-c1\">Your selection? E</span>\n\n<span class=\"pl-c1\">Possible actions for a RSA key: Sign Encrypt Authenticate</span>\n<span class=\"pl-c1\">Current allowed actions:</span>\n\n<span class=\"pl-c1\">   (S) Toggle the sign capability</span>\n<span class=\"pl-c1\">   (E) Toggle the encrypt capability</span>\n<span class=\"pl-c1\">   (A) Toggle the authenticate capability</span>\n<span class=\"pl-c1\">   (Q) Finished</span>\n\n<span class=\"pl-c1\">Your selection? A</span>\n\n<span class=\"pl-c1\">Possible actions for a RSA key: Sign Encrypt Authenticate</span>\n<span class=\"pl-c1\">Current allowed actions: Authenticate</span>\n\n<span class=\"pl-c1\">   (S) Toggle the sign capability</span>\n<span class=\"pl-c1\">   (E) Toggle the encrypt capability</span>\n<span class=\"pl-c1\">   (A) Toggle the authenticate capability</span>\n<span class=\"pl-c1\">   (Q) Finished</span>\n\n<span class=\"pl-c1\">Your selection? Q</span>\n<span class=\"pl-c1\">RSA keys may be between 1024 and 4096 bits long.</span>\n<span class=\"pl-c1\">What keysize do you want? (2048) 4096</span>\n<span class=\"pl-c1\">Requested keysize is 4096 bits</span>\n<span class=\"pl-c1\">Please specify how long the key should be valid.</span>\n<span class=\"pl-c1\">         0 = key does not expire</span>\n<span class=\"pl-c1\">      &lt;n&gt;  = key expires in n days</span>\n<span class=\"pl-c1\">      &lt;n&gt;w = key expires in n weeks</span>\n<span class=\"pl-c1\">      &lt;n&gt;m = key expires in n months</span>\n<span class=\"pl-c1\">      &lt;n&gt;y = key expires in n years</span>\n<span class=\"pl-c1\">Key is valid for? (0) 1y</span>\n<span class=\"pl-c1\">Key expires at Mon 10 Sep 2018 00:00:00 PM UTC</span>\n<span class=\"pl-c1\">Is this correct? (y/N) y</span>\n<span class=\"pl-c1\">Really create? (y/N) y</span>\n<span class=\"pl-c1\">We need to generate a lot of random bytes. It is a good idea to perform</span>\n<span class=\"pl-c1\">some other action (type on the keyboard, move the mouse, utilize the</span>\n<span class=\"pl-c1\">disks) during the prime generation; this gives the random number</span>\n<span class=\"pl-c1\">generator a better chance to gain enough entropy.</span>\n\n<span class=\"pl-c1\">sec  rsa4096/0xFF3E7D88647EBCDB</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: never       usage: C</span>\n<span class=\"pl-c1\">    trust: ultimate      validity: ultimate</span>\n<span class=\"pl-c1\">ssb  rsa4096/0xBECFA3C1AE191D15</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: 2018-10-09       usage: S</span>\n<span class=\"pl-c1\">ssb  rsa4096/0x5912A795E90DD2CF</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: 2018-10-09       usage: E</span>\n<span class=\"pl-c1\">ssb  rsa4096/0x3F29127E79649A3D</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: 2018-10-09       usage: A</span>\n<span class=\"pl-c1\">[ultimate] (1). Dr Duh &lt;doc@duh.to&gt;</span></pre></div>\n<p dir=\"auto\">Finish by saving the keys.</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"gpg&gt; save\"><pre><span class=\"pl-c1\">gpg&gt; save</span></pre></div>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-add-extra-identities\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#add-extra-identities\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Add extra identities</h2>\n<p dir=\"auto\">(Optional) To add additional email addresses or identities, use <code>adduid</code>.</p>\n<p dir=\"auto\">First open the keyring:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --expert --edit-key $KEYID\"><pre>$ <span class=\"pl-s1\">gpg --expert --edit-key <span class=\"pl-smi\">$KEYID</span></span></pre></div>\n<p dir=\"auto\">Then add the new identity:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"gpg&gt; adduid\nReal name: Dr Duh\nEmail address: DrDuh@other.org\nComment:\nYou selected this USER-ID:\n    &quot;Dr Duh &lt;DrDuh@other.org&gt;&quot;\n\nsec  rsa4096/0xFF3E7D88647EBCDB\n    created: 2017-10-09  expires: never       usage: C\n    trust: ultimate      validity: ultimate\nssb  rsa4096/0xBECFA3C1AE191D15\n    created: 2017-10-09  expires: never       usage: S\nssb  rsa4096/0x5912A795E90DD2CF\n    created: 2017-10-09  expires: never       usage: E\nssb  rsa4096/0x3F29127E79649A3D\n    created: 2017-10-09  expires: never       usage: A\n[ultimate] (1). Dr Duh &lt;doc@duh.to&gt;\n[ unknown] (2). Dr Duh &lt;DrDuh@other.org&gt;\n\ngpg&gt; trust\nsec  rsa4096/0xFF3E7D88647EBCDB\n    created: 2017-10-09  expires: never       usage: C\n    trust: ultimate      validity: ultimate\nssb  rsa4096/0xBECFA3C1AE191D15\n    created: 2017-10-09  expires: never       usage: S\nssb  rsa4096/0x5912A795E90DD2CF\n    created: 2017-10-09  expires: never       usage: E\nssb  rsa4096/0x3F29127E79649A3D\n    created: 2017-10-09  expires: never       usage: A\n[ultimate] (1). Dr Duh &lt;doc@duh.to&gt;\n[ unknown] (2). Dr Duh &lt;DrDuh@other.org&gt;\n\nPlease decide how far you trust this user to correctly verify other users' keys\n(by looking at passports, checking fingerprints from different sources, etc.)\n\n  1 = I don't know or won't say\n  2 = I do NOT trust\n  3 = I trust marginally\n  4 = I trust fully\n  5 = I trust ultimately\n  m = back to the main menu\n\nYour decision? 5\nDo you really want to set this key to ultimate trust? (y/N) y\n\nsec  rsa4096/0xFF3E7D88647EBCDB\n    created: 2017-10-09  expires: never       usage: C\n    trust: ultimate      validity: ultimate\nssb  rsa4096/0xBECFA3C1AE191D15\n    created: 2017-10-09  expires: never       usage: S\nssb  rsa4096/0x5912A795E90DD2CF\n    created: 2017-10-09  expires: never       usage: E\nssb  rsa4096/0x3F29127E79649A3D\n    created: 2017-10-09  expires: never       usage: A\n[ultimate] (1). Dr Duh &lt;doc@duh.to&gt;\n[ unknown] (2). Dr Duh &lt;DrDuh@other.org&gt;\n\ngpg&gt; uid 1\n\nsec  rsa4096/0xFF3E7D88647EBCDB\ncreated: 2017-10-09  expires: never       usage: C\n    trust: ultimate      validity: ultimate\nssb  rsa4096/0xBECFA3C1AE191D15\n    created: 2017-10-09  expires: never       usage: S\nssb  rsa4096/0x5912A795E90DD2CF\n    created: 2017-10-09  expires: never       usage: E\nssb  rsa4096/0x3F29127E79649A3D\n    created: 2017-10-09  expires: never       usage: A\n[ultimate] (1)* Dr Duh &lt;doc@duh.to&gt;\n[ unknown] (2). Dr Duh &lt;DrDuh@other.org&gt;\n\ngpg&gt; primary\n\nsec  rsa4096/0xFF3E7D88647EBCDB\ncreated: 2017-10-09  expires: never       usage: C\n    trust: ultimate      validity: ultimate\nssb  rsa4096/0xBECFA3C1AE191D15\n    created: 2017-10-09  expires: never       usage: S\nssb  rsa4096/0x5912A795E90DD2CF\n    created: 2017-10-09  expires: never       usage: E\nssb  rsa4096/0x3F29127E79649A3D\n    created: 2017-10-09  expires: never       usage: A\n[ultimate] (1)* Dr Duh &lt;doc@duh.to&gt;\n[ unknown] (2)  Dr Duh &lt;DrDuh@other.org&gt;\n\ngpg&gt; save\"><pre><span class=\"pl-c1\">gpg&gt; adduid</span>\n<span class=\"pl-c1\">Real name: Dr Duh</span>\n<span class=\"pl-c1\">Email address: DrDuh@other.org</span>\n<span class=\"pl-c1\">Comment:</span>\n<span class=\"pl-c1\">You selected this USER-ID:</span>\n<span class=\"pl-c1\">    \"Dr Duh &lt;DrDuh@other.org&gt;\"</span>\n\n<span class=\"pl-c1\">sec  rsa4096/0xFF3E7D88647EBCDB</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: never       usage: C</span>\n<span class=\"pl-c1\">    trust: ultimate      validity: ultimate</span>\n<span class=\"pl-c1\">ssb  rsa4096/0xBECFA3C1AE191D15</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: never       usage: S</span>\n<span class=\"pl-c1\">ssb  rsa4096/0x5912A795E90DD2CF</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: never       usage: E</span>\n<span class=\"pl-c1\">ssb  rsa4096/0x3F29127E79649A3D</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: never       usage: A</span>\n<span class=\"pl-c1\">[ultimate] (1). Dr Duh &lt;doc@duh.to&gt;</span>\n<span class=\"pl-c1\">[ unknown] (2). Dr Duh &lt;DrDuh@other.org&gt;</span>\n\n<span class=\"pl-c1\">gpg&gt; trust</span>\n<span class=\"pl-c1\">sec  rsa4096/0xFF3E7D88647EBCDB</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: never       usage: C</span>\n<span class=\"pl-c1\">    trust: ultimate      validity: ultimate</span>\n<span class=\"pl-c1\">ssb  rsa4096/0xBECFA3C1AE191D15</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: never       usage: S</span>\n<span class=\"pl-c1\">ssb  rsa4096/0x5912A795E90DD2CF</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: never       usage: E</span>\n<span class=\"pl-c1\">ssb  rsa4096/0x3F29127E79649A3D</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: never       usage: A</span>\n<span class=\"pl-c1\">[ultimate] (1). Dr Duh &lt;doc@duh.to&gt;</span>\n<span class=\"pl-c1\">[ unknown] (2). Dr Duh &lt;DrDuh@other.org&gt;</span>\n\n<span class=\"pl-c1\">Please decide how far you trust this user to correctly verify other users' keys</span>\n<span class=\"pl-c1\">(by looking at passports, checking fingerprints from different sources, etc.)</span>\n\n<span class=\"pl-c1\">  1 = I don't know or won't say</span>\n<span class=\"pl-c1\">  2 = I do NOT trust</span>\n<span class=\"pl-c1\">  3 = I trust marginally</span>\n<span class=\"pl-c1\">  4 = I trust fully</span>\n<span class=\"pl-c1\">  5 = I trust ultimately</span>\n<span class=\"pl-c1\">  m = back to the main menu</span>\n\n<span class=\"pl-c1\">Your decision? 5</span>\n<span class=\"pl-c1\">Do you really want to set this key to ultimate trust? (y/N) y</span>\n\n<span class=\"pl-c1\">sec  rsa4096/0xFF3E7D88647EBCDB</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: never       usage: C</span>\n<span class=\"pl-c1\">    trust: ultimate      validity: ultimate</span>\n<span class=\"pl-c1\">ssb  rsa4096/0xBECFA3C1AE191D15</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: never       usage: S</span>\n<span class=\"pl-c1\">ssb  rsa4096/0x5912A795E90DD2CF</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: never       usage: E</span>\n<span class=\"pl-c1\">ssb  rsa4096/0x3F29127E79649A3D</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: never       usage: A</span>\n<span class=\"pl-c1\">[ultimate] (1). Dr Duh &lt;doc@duh.to&gt;</span>\n<span class=\"pl-c1\">[ unknown] (2). Dr Duh &lt;DrDuh@other.org&gt;</span>\n\n<span class=\"pl-c1\">gpg&gt; uid 1</span>\n\n<span class=\"pl-c1\">sec  rsa4096/0xFF3E7D88647EBCDB</span>\n<span class=\"pl-c1\">created: 2017-10-09  expires: never       usage: C</span>\n<span class=\"pl-c1\">    trust: ultimate      validity: ultimate</span>\n<span class=\"pl-c1\">ssb  rsa4096/0xBECFA3C1AE191D15</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: never       usage: S</span>\n<span class=\"pl-c1\">ssb  rsa4096/0x5912A795E90DD2CF</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: never       usage: E</span>\n<span class=\"pl-c1\">ssb  rsa4096/0x3F29127E79649A3D</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: never       usage: A</span>\n<span class=\"pl-c1\">[ultimate] (1)* Dr Duh &lt;doc@duh.to&gt;</span>\n<span class=\"pl-c1\">[ unknown] (2). Dr Duh &lt;DrDuh@other.org&gt;</span>\n\n<span class=\"pl-c1\">gpg&gt; primary</span>\n\n<span class=\"pl-c1\">sec  rsa4096/0xFF3E7D88647EBCDB</span>\n<span class=\"pl-c1\">created: 2017-10-09  expires: never       usage: C</span>\n<span class=\"pl-c1\">    trust: ultimate      validity: ultimate</span>\n<span class=\"pl-c1\">ssb  rsa4096/0xBECFA3C1AE191D15</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: never       usage: S</span>\n<span class=\"pl-c1\">ssb  rsa4096/0x5912A795E90DD2CF</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: never       usage: E</span>\n<span class=\"pl-c1\">ssb  rsa4096/0x3F29127E79649A3D</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: never       usage: A</span>\n<span class=\"pl-c1\">[ultimate] (1)* Dr Duh &lt;doc@duh.to&gt;</span>\n<span class=\"pl-c1\">[ unknown] (2)  Dr Duh &lt;DrDuh@other.org&gt;</span>\n\n<span class=\"pl-c1\">gpg&gt; save</span></pre></div>\n<p dir=\"auto\">By default, the last identity added will be the primary user ID - use <code>primary</code> to change that.</p>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-verify\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#verify\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Verify</h1>\n<p dir=\"auto\">List the generated secret keys and verify the output:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg -K\n/tmp.FLZC0xcM/pubring.kbx\n-------------------------------------------------------------------------\nsec   rsa4096/0xFF3E7D88647EBCDB 2017-10-09 [C]\n      Key fingerprint = 011C E16B D45B 27A5 5BA8  776D FF3E 7D88 647E BCDB\nuid                            Dr Duh &lt;doc@duh.to&gt;\nssb   rsa4096/0xBECFA3C1AE191D15 2017-10-09 [S] [expires: 2018-10-09]\nssb   rsa4096/0x5912A795E90DD2CF 2017-10-09 [E] [expires: 2018-10-09]\nssb   rsa4096/0x3F29127E79649A3D 2017-10-09 [A] [expires: 2018-10-09]\"><pre>$ <span class=\"pl-s1\">gpg -K</span>\n<span class=\"pl-c1\">/tmp.FLZC0xcM/pubring.kbx</span>\n<span class=\"pl-c1\">-------------------------------------------------------------------------</span>\n<span class=\"pl-c1\">sec   rsa4096/0xFF3E7D88647EBCDB 2017-10-09 [C]</span>\n<span class=\"pl-c1\">      Key fingerprint = 011C E16B D45B 27A5 5BA8  776D FF3E 7D88 647E BCDB</span>\n<span class=\"pl-c1\">uid                            Dr Duh &lt;doc@duh.to&gt;</span>\n<span class=\"pl-c1\">ssb   rsa4096/0xBECFA3C1AE191D15 2017-10-09 [S] [expires: 2018-10-09]</span>\n<span class=\"pl-c1\">ssb   rsa4096/0x5912A795E90DD2CF 2017-10-09 [E] [expires: 2018-10-09]</span>\n<span class=\"pl-c1\">ssb   rsa4096/0x3F29127E79649A3D 2017-10-09 [A] [expires: 2018-10-09]</span></pre></div>\n<p dir=\"auto\">Add any additional identities or email addresses you wish to associate using the <code>adduid</code> command.</p>\n<p dir=\"auto\"><strong>Tip</strong> Verify with a OpenPGP <a href=\"https://riseup.net/en/security/message-security/openpgp/best-practices#openpgp-key-checks\" rel=\"nofollow\">key best practice checker</a>:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --export $KEYID | hokey lint\"><pre>$ <span class=\"pl-s1\">gpg --export <span class=\"pl-smi\">$KEYID</span> <span class=\"pl-k\">|</span> hokey lint</span></pre></div>\n<p dir=\"auto\">The output will display any problems with your key in red text. If everything is green, your key passes each of the tests. If it is red, your key has failed one of the tests.</p>\n<blockquote>\n<p dir=\"auto\">hokey may warn (orange text) about cross certification for the authentication key. GPG's <a href=\"https://gnupg.org/faq/subkey-cross-certify.html\" rel=\"nofollow\">Signing Subkey Cross-Certification</a> documentation has more detail on cross certification, and gpg v2.2.1 notes \"subkey  does not sign and so does not need to be cross-certified\". hokey may also indicate a problem (red text) with <code>Key expiration times: []</code> on the primary key (see <a href=\"#notes\">Note #3</a> about not setting an expiry for the primary key).</p>\n</blockquote>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-export-secret-keys\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#export-secret-keys\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Export secret keys</h1>\n<p dir=\"auto\">The master key and sub-keys will be encrypted with your passphrase when exported.</p>\n<p dir=\"auto\">Save a copy of your keys:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --armor --export-secret-keys $KEYID &gt; $GNUPGHOME/mastersub.key\n\n$ gpg --armor --export-secret-subkeys $KEYID &gt; $GNUPGHOME/sub.key\"><pre>$ <span class=\"pl-s1\">gpg --armor --export-secret-keys <span class=\"pl-smi\">$KEYID</span> <span class=\"pl-k\">&gt;</span> <span class=\"pl-smi\">$GNUPGHOME</span>/mastersub.key</span>\n\n$ <span class=\"pl-s1\">gpg --armor --export-secret-subkeys <span class=\"pl-smi\">$KEYID</span> <span class=\"pl-k\">&gt;</span> <span class=\"pl-smi\">$GNUPGHOME</span>/sub.key</span></pre></div>\n<p dir=\"auto\">On Windows, note that using any extension other than <code>.gpg</code> or attempting IO redirection to a file will garble the secret key, making it impossible to import it again at a later date:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg -o \\path\\to\\dir\\mastersub.gpg --armor --export-secret-keys $KEYID\n\n$ gpg -o \\path\\to\\dir\\sub.gpg --armor --export-secret-subkeys $KEYID\"><pre>$ <span class=\"pl-s1\">gpg -o <span class=\"pl-cce\">\\p</span>ath<span class=\"pl-cce\">\\t</span>o<span class=\"pl-cce\">\\d</span>ir<span class=\"pl-cce\">\\m</span>astersub.gpg --armor --export-secret-keys <span class=\"pl-smi\">$KEYID</span></span>\n\n$ <span class=\"pl-s1\">gpg -o <span class=\"pl-cce\">\\p</span>ath<span class=\"pl-cce\">\\t</span>o<span class=\"pl-cce\">\\d</span>ir<span class=\"pl-cce\">\\s</span>ub.gpg --armor --export-secret-subkeys <span class=\"pl-smi\">$KEYID</span></span></pre></div>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-revocation-certificate\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#revocation-certificate\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Revocation certificate</h1>\n<p dir=\"auto\">Although we will backup and store the master key in a safe place, it is best practice to never rule out the possibility of losing it or having the backup fail. Without the master key, it will be impossible to renew or rotate subkeys or generate a revocation certificate, the PGP identity will be useless.</p>\n<p dir=\"auto\">Even worse, we cannot advertise this fact in any way to those that are using our keys. It is reasonable to assume this <em>will</em> occur at some point and the only remaining way to deprecate orphaned keys is a revocation certificate.</p>\n<p dir=\"auto\">To create the revocation certificate:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --output $GNUPGHOME/revoke.asc --gen-revoke $KEYID\"><pre>$ <span class=\"pl-s1\">gpg --output <span class=\"pl-smi\">$GNUPGHOME</span>/revoke.asc --gen-revoke <span class=\"pl-smi\">$KEYID</span></span></pre></div>\n<p dir=\"auto\">The <code>revoke.asc</code> certificate file should be stored (or printed) in a (secondary) place that allows retrieval in case the main backup fails.</p>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-backup\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#backup\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Backup</h1>\n<p dir=\"auto\">Once keys are moved to YubiKey, they cannot be moved again! Create an <strong>encrypted</strong> backup of the keyring on removable media so you can keep it offline in a safe place.</p>\n<p dir=\"auto\"><strong>Tip</strong> The ext2 filesystem (without encryption) can be mounted on both Linux and OpenBSD. Consider using a FAT32/NTFS filesystem for MacOS/Windows compatibility instead.</p>\n<p dir=\"auto\">As an additional backup measure, consider using a <a href=\"https://www.jabberwocky.com/software/paperkey/\" rel=\"nofollow\">paper copy</a> of the keys. The <a href=\"https://www.kernel.org/doc/html/latest/process/maintainer-pgp-guide.html#back-up-your-master-key-for-disaster-recovery\" rel=\"nofollow\">Linux Kernel Maintainer PGP Guide</a> points out that such printouts <em>are still password-protected</em>. It recommends to <em>write the password on the paper</em>, since it will be unlikely that you remember the original key password that was used when the paper backup was created. Obviously, you need a really good place to keep such a printout.</p>\n<p dir=\"auto\">It is strongly recommended to keep even encrypted OpenPGP private key material offline to deter <a href=\"https://www.kopenpgp.com/\" rel=\"nofollow\">key overwriting attacks</a>, for example.</p>\n<p dir=\"auto\"><strong>Linux</strong></p>\n<p dir=\"auto\">Attach another external storage device and check its label:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ sudo dmesg | tail\nmmc0: new high speed SDHC card at address a001\nmmcblk0: mmc0:a001 SS16G 14.8 GiB\n\n$ sudo fdisk -l /dev/mmcblk0\nDisk /dev/mmcblk0: 14.9 GiB, 15931539456 bytes, 31116288 sectors\nUnits: sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\"><pre>$ <span class=\"pl-s1\">sudo dmesg <span class=\"pl-k\">|</span> tail</span>\n<span class=\"pl-c1\">mmc0: new high speed SDHC card at address a001</span>\n<span class=\"pl-c1\">mmcblk0: mmc0:a001 SS16G 14.8 GiB</span>\n\n$ <span class=\"pl-s1\">sudo fdisk -l /dev/mmcblk0</span>\n<span class=\"pl-c1\">Disk /dev/mmcblk0: 14.9 GiB, 15931539456 bytes, 31116288 sectors</span>\n<span class=\"pl-c1\">Units: sectors of 1 * 512 = 512 bytes</span>\n<span class=\"pl-c1\">Sector size (logical/physical): 512 bytes / 512 bytes</span>\n<span class=\"pl-c1\">I/O size (minimum/optimal): 512 bytes / 512 bytes</span></pre></div>\n<p dir=\"auto\">Write it with random data to prepare for encryption:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ sudo dd if=/dev/urandom of=/dev/mmcblk0 bs=4M status=progress\"><pre>$ <span class=\"pl-s1\">sudo dd if=/dev/urandom of=/dev/mmcblk0 bs=4M status=progress</span></pre></div>\n<p dir=\"auto\">Erase and create a new partition table:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ sudo fdisk /dev/mmcblk0\n\nWelcome to fdisk (util-linux 2.33.1).\nChanges will remain in memory only, until you decide to write them.\nBe careful before using the write command.\n\nDevice does not contain a recognized partition table.\nCreated a new DOS disklabel with disk identifier 0x3c1ad14a.\n\nCommand (m for help): g\nCreated a new GPT disklabel (GUID: 4E7495FD-85A3-3E48-97FC-2DD8D41516C3).\n\nCommand (m for help): w\nThe partition table has been altered.\nCalling ioctl() to re-read partition table.\nSyncing disks.\n\"><pre>$ <span class=\"pl-s1\">sudo fdisk /dev/mmcblk0</span>\n\n<span class=\"pl-c1\">Welcome to fdisk (util-linux 2.33.1).</span>\n<span class=\"pl-c1\">Changes will remain in memory only, until you decide to write them.</span>\n<span class=\"pl-c1\">Be careful before using the write command.</span>\n\n<span class=\"pl-c1\">Device does not contain a recognized partition table.</span>\n<span class=\"pl-c1\">Created a new DOS disklabel with disk identifier 0x3c1ad14a.</span>\n\n<span class=\"pl-c1\">Command (m for help): g</span>\n<span class=\"pl-c1\">Created a new GPT disklabel (GUID: 4E7495FD-85A3-3E48-97FC-2DD8D41516C3).</span>\n\n<span class=\"pl-c1\">Command (m for help): w</span>\n<span class=\"pl-c1\">The partition table has been altered.</span>\n<span class=\"pl-c1\">Calling ioctl() to re-read partition table.</span>\n<span class=\"pl-c1\">Syncing disks.</span>\n</pre></div>\n<p dir=\"auto\">Create a new partition with a 25 Megabyte size:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ sudo fdisk /dev/mmcblk0\n\nWelcome to fdisk (util-linux 2.36.1).\nChanges will remain in memory only, until you decide to write them.\nBe careful before using the write command.\n\nCommand (m for help): n\nPartition number (1-128, default 1):\nFirst sector (2048-30261214, default 2048):\nLast sector, +/-sectors or +/-size{K,M,G,T,P} (2048-30261214, default 30261214): +25M\n\nCreated a new partition 1 of type 'Linux filesystem' and of size 25 MiB.\n\nCommand (m for help): w\nThe partition table has been altered.\nCalling ioctl() to re-read partition table.\nSyncing disks.\"><pre>$ <span class=\"pl-s1\">sudo fdisk /dev/mmcblk0</span>\n\n<span class=\"pl-c1\">Welcome to fdisk (util-linux 2.36.1).</span>\n<span class=\"pl-c1\">Changes will remain in memory only, until you decide to write them.</span>\n<span class=\"pl-c1\">Be careful before using the write command.</span>\n\n<span class=\"pl-c1\">Command (m for help): n</span>\n<span class=\"pl-c1\">Partition number (1-128, default 1):</span>\n<span class=\"pl-c1\">First sector (2048-30261214, default 2048):</span>\n<span class=\"pl-c1\">Last sector, +/-sectors or +/-size{K,M,G,T,P} (2048-30261214, default 30261214): +25M</span>\n\n<span class=\"pl-c1\">Created a new partition 1 of type 'Linux filesystem' and of size 25 MiB.</span>\n\n<span class=\"pl-c1\">Command (m for help): w</span>\n<span class=\"pl-c1\">The partition table has been altered.</span>\n<span class=\"pl-c1\">Calling ioctl() to re-read partition table.</span>\n<span class=\"pl-c1\">Syncing disks.</span></pre></div>\n<p dir=\"auto\">Use <a href=\"https://askubuntu.com/questions/97196/how-secure-is-an-encrypted-luks-filesystem\" rel=\"nofollow\">LUKS</a> to encrypt the new partition. Generate a different password which will be used to protect the filesystem:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ sudo cryptsetup luksFormat /dev/mmcblk0p1\n\nWARNING!\n========\nThis will overwrite data on /dev/mmcblk0p1 irrevocably.\n\nAre you sure? (Type uppercase yes): YES\nEnter passphrase for /dev/mmcblk0p1:\nVerify passphrase:\"><pre>$ <span class=\"pl-s1\">sudo cryptsetup luksFormat /dev/mmcblk0p1</span>\n\n<span class=\"pl-c1\">WARNING!</span>\n<span class=\"pl-c1\">========</span>\n<span class=\"pl-c1\">This will overwrite data on /dev/mmcblk0p1 irrevocably.</span>\n\n<span class=\"pl-c1\">Are you sure? (Type uppercase yes): YES</span>\n<span class=\"pl-c1\">Enter passphrase for /dev/mmcblk0p1:</span>\n<span class=\"pl-c1\">Verify passphrase:</span></pre></div>\n<p dir=\"auto\">Mount the partition:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ sudo cryptsetup luksOpen /dev/mmcblk0p1 secret\nEnter passphrase for /dev/mmcblk0p1:\"><pre>$ <span class=\"pl-s1\">sudo cryptsetup luksOpen /dev/mmcblk0p1 secret</span>\n<span class=\"pl-c1\">Enter passphrase for /dev/mmcblk0p1:</span></pre></div>\n<p dir=\"auto\">Create an ext2 filesystem:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ sudo mkfs.ext2 /dev/mapper/secret -L gpg-$(date +%F)\"><pre>$ <span class=\"pl-s1\">sudo mkfs.ext2 /dev/mapper/secret -L gpg-<span class=\"pl-s\"><span class=\"pl-pds\">$(</span>date +%F<span class=\"pl-pds\">)</span></span></span></pre></div>\n<p dir=\"auto\">Mount the filesystem and copy the temporary GnuPG directory with keyring:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ sudo mkdir /mnt/encrypted-storage\n\n$ sudo mount /dev/mapper/secret /mnt/encrypted-storage\n\n$ sudo cp -avi $GNUPGHOME /mnt/encrypted-storage/\"><pre>$ <span class=\"pl-s1\">sudo mkdir /mnt/encrypted-storage</span>\n\n$ <span class=\"pl-s1\">sudo mount /dev/mapper/secret /mnt/encrypted-storage</span>\n\n$ <span class=\"pl-s1\">sudo cp -avi <span class=\"pl-smi\">$GNUPGHOME</span> /mnt/encrypted-storage/</span></pre></div>\n<p dir=\"auto\"><strong>Optional</strong> Backup the OneRNG package:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ sudo cp onerng_3.7-1_all.deb /mnt/encrypted-storage/\"><pre>$ <span class=\"pl-s1\">sudo cp onerng_3.7-1_all.deb /mnt/encrypted-storage/</span></pre></div>\n<p dir=\"auto\"><strong>Note</strong> If you plan on setting up multiple keys, keep the backup mounted or remember to terminate the gpg process before <a href=\"https://lists.gnupg.org/pipermail/gnupg-users/2016-July/056353.html\" rel=\"nofollow\">saving</a>.</p>\n<p dir=\"auto\">Unmount, close and disconnect the encrypted volume:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ sudo umount /mnt/encrypted-storage/\n\n$ sudo cryptsetup luksClose secret\"><pre>$ <span class=\"pl-s1\">sudo umount /mnt/encrypted-storage/</span>\n\n$ <span class=\"pl-s1\">sudo cryptsetup luksClose secret</span></pre></div>\n<p dir=\"auto\"><strong>OpenBSD</strong></p>\n<p dir=\"auto\">Attach a USB disk and determine its label:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ dmesg | grep sd.\\ at\nsd2 at scsibus5 targ 1 lun 0: &lt;TS-RDF5, SD Transcend, TS37&gt; SCSI4 0/direct removable serial.00000000000000000000\"><pre>$ <span class=\"pl-s1\">dmesg <span class=\"pl-k\">|</span> grep sd.<span class=\"pl-cce\">\\ </span>at</span>\n<span class=\"pl-c1\">sd2 at scsibus5 targ 1 lun 0: &lt;TS-RDF5, SD Transcend, TS37&gt; SCSI4 0/direct removable serial.00000000000000000000</span></pre></div>\n<p dir=\"auto\">Print the existing partitions to make sure it's the right device:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ doas disklabel -h sd2\"><pre>$ <span class=\"pl-s1\">doas disklabel -h sd2</span></pre></div>\n<p dir=\"auto\">Initialize the disk by creating an <code>a</code> partition with FS type <code>RAID</code> and size of 25 Megabytes:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ doas fdisk -giy sd2\nWriting MBR at offset 0.\nWriting GPT.\n\n$ doas disklabel -E sd2\nLabel editor (enter '?' for help at any prompt)\nsd2&gt; a a\noffset: [64]\nsize: [31101776] 25M\nFS type: [4.2BSD] RAID\nsd2*&gt; w\nsd2&gt; q\nNo label changes\"><pre>$ <span class=\"pl-s1\">doas fdisk -giy sd2</span>\n<span class=\"pl-c1\">Writing MBR at offset 0.</span>\n<span class=\"pl-c1\">Writing GPT.</span>\n\n$ <span class=\"pl-s1\">doas disklabel -E sd2</span>\n<span class=\"pl-c1\">Label editor (enter '?' for help at any prompt)</span>\n<span class=\"pl-c1\">sd2&gt; a a</span>\n<span class=\"pl-c1\">offset: [64]</span>\n<span class=\"pl-c1\">size: [31101776] 25M</span>\n<span class=\"pl-c1\">FS type: [4.2BSD] RAID</span>\n<span class=\"pl-c1\">sd2*&gt; w</span>\n<span class=\"pl-c1\">sd2&gt; q</span>\n<span class=\"pl-c1\">No label changes</span></pre></div>\n<p dir=\"auto\">Encrypt with bioctl:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ doas bioctl -c C -l sd2a softraid0\nNew passphrase:\nRe-type passphrase:\nsoftraid0: CRYPTO volume attached as sd3\"><pre>$ <span class=\"pl-s1\">doas bioctl -c C -l sd2a softraid0</span>\n<span class=\"pl-c1\">New passphrase:</span>\n<span class=\"pl-c1\">Re-type passphrase:</span>\n<span class=\"pl-c1\">softraid0: CRYPTO volume attached as sd3</span></pre></div>\n<p dir=\"auto\">Create an <code>i</code> partition on the new crypto volume and the filesystem:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ doas fdisk -giy sd3\nWriting MBR at offset 0.\nWriting GPT.\n\n$ doas disklabel -E sd3\nLabel editor (enter '?' for help at any prompt)\nsd3&gt; a i\noffset: [64]\nsize: [16001]\nFS type: [4.2BSD]\nsd3*&gt; w\nsd3&gt; q\nNo label changes.\n\n$ doas newfs sd3i\"><pre>$ <span class=\"pl-s1\">doas fdisk -giy sd3</span>\n<span class=\"pl-c1\">Writing MBR at offset 0.</span>\n<span class=\"pl-c1\">Writing GPT.</span>\n\n$ <span class=\"pl-s1\">doas disklabel -E sd3</span>\n<span class=\"pl-c1\">Label editor (enter '?' for help at any prompt)</span>\n<span class=\"pl-c1\">sd3&gt; a i</span>\n<span class=\"pl-c1\">offset: [64]</span>\n<span class=\"pl-c1\">size: [16001]</span>\n<span class=\"pl-c1\">FS type: [4.2BSD]</span>\n<span class=\"pl-c1\">sd3*&gt; w</span>\n<span class=\"pl-c1\">sd3&gt; q</span>\n<span class=\"pl-c1\">No label changes.</span>\n\n$ <span class=\"pl-s1\">doas newfs sd3i</span></pre></div>\n<p dir=\"auto\">Mount the filesystem and copy the temporary directory with the keyring:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ doas mkdir /mnt/encrypted-storage\n\n$ doas mount /dev/sd3i /mnt/encrypted-storage\n\n$ doas cp -avi $GNUPGHOME /mnt/encrypted-storage\"><pre>$ <span class=\"pl-s1\">doas mkdir /mnt/encrypted-storage</span>\n\n$ <span class=\"pl-s1\">doas mount /dev/sd3i /mnt/encrypted-storage</span>\n\n$ <span class=\"pl-s1\">doas cp -avi <span class=\"pl-smi\">$GNUPGHOME</span> /mnt/encrypted-storage</span></pre></div>\n<p dir=\"auto\"><strong>Note</strong> If you plan on setting up multiple keys, keep the backup mounted or remember to terminate the gpg process before <a href=\"https://lists.gnupg.org/pipermail/gnupg-users/2016-July/056353.html\" rel=\"nofollow\">saving</a>.</p>\n<p dir=\"auto\">Otherwise, unmount and disconnect the encrypted volume:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ doas umount /mnt/encrypted-storage\n\n$ doas bioctl -d sd3\"><pre>$ <span class=\"pl-s1\">doas umount /mnt/encrypted-storage</span>\n\n$ <span class=\"pl-s1\">doas bioctl -d sd3</span></pre></div>\n<p dir=\"auto\">See <a href=\"https://www.openbsd.org/faq/faq14.html#softraidCrypto\" rel=\"nofollow\">OpenBSD FAQ#14</a> for more information.</p>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-export-public-keys\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#export-public-keys\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Export public keys</h1>\n<p dir=\"auto\"><strong>Important</strong> Without the <em>public</em> key, you will not be able to use GPG to encrypt, decrypt, nor sign messages. However, you will still be able to use YubiKey for SSH authentication.</p>\n<p dir=\"auto\">Create another partition on the removable storage device to store the public key, or reconnect networking and upload to a key server.</p>\n<p dir=\"auto\"><strong>Linux</strong></p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ sudo fdisk /dev/mmcblk0\n\nWelcome to fdisk (util-linux 2.36.1).\nChanges will remain in memory only, until you decide to write them.\nBe careful before using the write command.\n\nCommand (m for help): n\nPartition number (2-128, default 2):\nFirst sector (53248-30261214, default 53248):\nLast sector, +/-sectors or +/-size{K,M,G,T,P} (53248-30261214, default 30261214): +25M\n\nCreated a new partition 2 of type 'Linux filesystem' and of size 25 MiB.\n\nCommand (m for help): w\nThe partition table has been altered.\nCalling ioctl() to re-read partition table.\nSyncing disks.\n\n$ sudo mkfs.ext2 /dev/mmcblk0p2\n\n$ sudo mkdir /mnt/public\n\n$ sudo mount /dev/mmcblk0p2 /mnt/public/\n\n$ gpg --armor --export $KEYID | sudo tee /mnt/public/gpg-$KEYID-$(date +%F).asc\"><pre>$ <span class=\"pl-s1\">sudo fdisk /dev/mmcblk0</span>\n\n<span class=\"pl-c1\">Welcome to fdisk (util-linux 2.36.1).</span>\n<span class=\"pl-c1\">Changes will remain in memory only, until you decide to write them.</span>\n<span class=\"pl-c1\">Be careful before using the write command.</span>\n\n<span class=\"pl-c1\">Command (m for help): n</span>\n<span class=\"pl-c1\">Partition number (2-128, default 2):</span>\n<span class=\"pl-c1\">First sector (53248-30261214, default 53248):</span>\n<span class=\"pl-c1\">Last sector, +/-sectors or +/-size{K,M,G,T,P} (53248-30261214, default 30261214): +25M</span>\n\n<span class=\"pl-c1\">Created a new partition 2 of type 'Linux filesystem' and of size 25 MiB.</span>\n\n<span class=\"pl-c1\">Command (m for help): w</span>\n<span class=\"pl-c1\">The partition table has been altered.</span>\n<span class=\"pl-c1\">Calling ioctl() to re-read partition table.</span>\n<span class=\"pl-c1\">Syncing disks.</span>\n\n$ <span class=\"pl-s1\">sudo mkfs.ext2 /dev/mmcblk0p2</span>\n\n$ <span class=\"pl-s1\">sudo mkdir /mnt/public</span>\n\n$ <span class=\"pl-s1\">sudo mount /dev/mmcblk0p2 /mnt/public/</span>\n\n$ <span class=\"pl-s1\">gpg --armor --export <span class=\"pl-smi\">$KEYID</span> <span class=\"pl-k\">|</span> sudo tee /mnt/public/gpg-<span class=\"pl-smi\">$KEYID</span>-<span class=\"pl-s\"><span class=\"pl-pds\">$(</span>date +%F<span class=\"pl-pds\">)</span></span>.asc</span></pre></div>\n<p dir=\"auto\"><strong>OpenBSD</strong></p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ doas disklabel -E sd2\nLabel editor (enter '?' for help at any prompt)\nsd2&gt; a b\noffset: [32130]\nsize: [31069710] 25M\nFS type: [swap] 4.2BSD\nsd2*&gt; w\nsd2&gt; q\nNo label changes.\n\n$ doas newfs sd2b\n\n$ doas mkdir /mnt/public\n\n$ doas mount /dev/sd2b /mnt/public\n\n$ gpg --armor --export $KEYID | doas tee /mnt/public/gpg-$KEYID-$(date +%F).asc\"><pre>$ <span class=\"pl-s1\">doas disklabel -E sd2</span>\n<span class=\"pl-c1\">Label editor (enter '?' for help at any prompt)</span>\n<span class=\"pl-c1\">sd2&gt; a b</span>\n<span class=\"pl-c1\">offset: [32130]</span>\n<span class=\"pl-c1\">size: [31069710] 25M</span>\n<span class=\"pl-c1\">FS type: [swap] 4.2BSD</span>\n<span class=\"pl-c1\">sd2*&gt; w</span>\n<span class=\"pl-c1\">sd2&gt; q</span>\n<span class=\"pl-c1\">No label changes.</span>\n\n$ <span class=\"pl-s1\">doas newfs sd2b</span>\n\n$ <span class=\"pl-s1\">doas mkdir /mnt/public</span>\n\n$ <span class=\"pl-s1\">doas mount /dev/sd2b /mnt/public</span>\n\n$ <span class=\"pl-s1\">gpg --armor --export <span class=\"pl-smi\">$KEYID</span> <span class=\"pl-k\">|</span> doas tee /mnt/public/gpg-<span class=\"pl-smi\">$KEYID</span>-<span class=\"pl-s\"><span class=\"pl-pds\">$(</span>date +%F<span class=\"pl-pds\">)</span></span>.asc</span></pre></div>\n<p dir=\"auto\"><strong>Windows</strong></p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg -o \\path\\to\\dir\\pubkey.gpg --armor --export $KEYID\"><pre>$ <span class=\"pl-s1\">gpg -o <span class=\"pl-cce\">\\p</span>ath<span class=\"pl-cce\">\\t</span>o<span class=\"pl-cce\">\\d</span>ir<span class=\"pl-cce\">\\p</span>ubkey.gpg --armor --export <span class=\"pl-smi\">$KEYID</span></span></pre></div>\n<p dir=\"auto\"><strong>Keyserver</strong></p>\n<p dir=\"auto\">(Optional) Upload the public key to a <a href=\"https://debian-administration.org/article/451/Submitting_your_GPG_key_to_a_keyserver\" rel=\"nofollow\">public keyserver</a>:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --send-key $KEYID\n\n$ gpg --keyserver keys.gnupg.net --send-key $KEYID\n\n$ gpg --keyserver hkps://keyserver.ubuntu.com:443 --send-key $KEYID\"><pre>$ <span class=\"pl-s1\">gpg --send-key <span class=\"pl-smi\">$KEYID</span></span>\n\n$ <span class=\"pl-s1\">gpg --keyserver keys.gnupg.net --send-key <span class=\"pl-smi\">$KEYID</span></span>\n\n$ <span class=\"pl-s1\">gpg --keyserver hkps://keyserver.ubuntu.com:443 --send-key <span class=\"pl-smi\">$KEYID</span></span></pre></div>\n<p dir=\"auto\">Or if <a href=\"https://keys.openpgp.org/about/usage\" rel=\"nofollow\">uploading to keys.openpgp.org</a>:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --send-key $KEYID | curl -T - https://keys.openpgp.org\"><pre>$ <span class=\"pl-s1\">gpg --send-key <span class=\"pl-smi\">$KEYID</span> <span class=\"pl-k\">|</span> curl -T - https://keys.openpgp.org</span></pre></div>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-configure-smartcard\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#configure-smartcard\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Configure Smartcard</h1>\n<p dir=\"auto\">Plug in a YubiKey and use GPG to configure it as a smartcard:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --card-edit\n\nReader ...........: Yubico Yubikey 4 OTP U2F CCID\nApplication ID ...: D2760001240102010006055532110000\nApplication type .: OpenPGP\nVersion ..........: 3.4\nManufacturer .....: Yubico\nSerial number ....: 05553211\nName of cardholder: [not set]\nLanguage prefs ...: [not set]\nSalutation .......:\nURL of public key : [not set]\nLogin data .......: [not set]\nSignature PIN ....: not forced\nKey attributes ...: rsa2048 rsa2048 rsa2048\nMax. PIN lengths .: 127 127 127\nPIN retry counter : 3 0 3\nSignature counter : 0\nKDF setting ......: off\nSignature key ....: [none]\nEncryption key....: [none]\nAuthentication key: [none]\nGeneral key info..: [none]\"><pre>$ <span class=\"pl-s1\">gpg --card-edit</span>\n\n<span class=\"pl-c1\">Reader ...........: Yubico Yubikey 4 OTP U2F CCID</span>\n<span class=\"pl-c1\">Application ID ...: D2760001240102010006055532110000</span>\n<span class=\"pl-c1\">Application type .: OpenPGP</span>\n<span class=\"pl-c1\">Version ..........: 3.4</span>\n<span class=\"pl-c1\">Manufacturer .....: Yubico</span>\n<span class=\"pl-c1\">Serial number ....: 05553211</span>\n<span class=\"pl-c1\">Name of cardholder: [not set]</span>\n<span class=\"pl-c1\">Language prefs ...: [not set]</span>\n<span class=\"pl-c1\">Salutation .......:</span>\n<span class=\"pl-c1\">URL of public key : [not set]</span>\n<span class=\"pl-c1\">Login data .......: [not set]</span>\n<span class=\"pl-c1\">Signature PIN ....: not forced</span>\n<span class=\"pl-c1\">Key attributes ...: rsa2048 rsa2048 rsa2048</span>\n<span class=\"pl-c1\">Max. PIN lengths .: 127 127 127</span>\n<span class=\"pl-c1\">PIN retry counter : 3 0 3</span>\n<span class=\"pl-c1\">Signature counter : 0</span>\n<span class=\"pl-c1\">KDF setting ......: off</span>\n<span class=\"pl-c1\">Signature key ....: [none]</span>\n<span class=\"pl-c1\">Encryption key....: [none]</span>\n<span class=\"pl-c1\">Authentication key: [none]</span>\n<span class=\"pl-c1\">General key info..: [none]</span></pre></div>\n<p dir=\"auto\">Enter administrative mode:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"gpg/card&gt; admin\nAdmin commands are allowed\"><pre><span class=\"pl-c1\">gpg/card&gt; admin</span>\n<span class=\"pl-c1\">Admin commands are allowed</span></pre></div>\n<p dir=\"auto\"><strong>Note</strong> If the card is locked, see <a href=\"#reset\">Reset</a>.</p>\n<p dir=\"auto\"><strong>Windows</strong></p>\n<p dir=\"auto\">Use the <a href=\"https://developers.yubico.com/yubikey-manager\" rel=\"nofollow\">YubiKey Manager</a> application (note, this is not the similarly named older YubiKey NEO Manager) to enable CCID functionality.</p>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-enable-kdf\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#enable-kdf\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Enable KDF</h2>\n<p dir=\"auto\">Key Derived Function (KDF) enables YubiKey to store the hash of PIN, preventing the PIN from being passed as plain text. Note that this requires a relatively new version of GnuPG to work, and may not be compatible with other GPG clients (notably mobile clients). These incompatible clients will be unable to use the YubiKey GPG functions as the PIN will always be rejected. If you are not sure you will only be using your YubiKey on supported platforms, it may be better to skip this step.</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"gpg/card&gt; kdf-setup\"><pre><span class=\"pl-c1\">gpg/card&gt; kdf-setup</span></pre></div>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-change-pin\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#change-pin\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Change PIN</h2>\n<p dir=\"auto\">The <a href=\"https://developers.yubico.com/PGP/\" rel=\"nofollow\">GPG interface</a> is separate from other modules on a Yubikey such as the <a href=\"https://developers.yubico.com/PIV/Introduction/YubiKey_and_PIV.html\" rel=\"nofollow\">PIV interface</a>. The GPG interface has its own <em>PIN</em>, <em>Admin PIN</em>, and <em>Reset Code</em> - these should be changed from default values!</p>\n<p dir=\"auto\">Entering the user <em>PIN</em> incorrectly three times will cause the PIN to become blocked; it can be unblocked with either the <em>Admin PIN</em> or <em>Reset Code</em>.</p>\n<p dir=\"auto\">Entering the <em>Admin PIN</em> or <em>Reset Code</em> incorrectly three times destroys all GPG data on the card. The Yubikey will have to be reconfigured.</p>\n<table>\n<thead>\n<tr>\n<th>Name</th>\n<th>Default Value</th>\n<th>Use</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>PIN</td>\n<td><code>123456</code></td>\n<td>decrypt and authenticate (SSH)</td>\n</tr>\n<tr>\n<td>Admin PIN</td>\n<td><code>12345678</code></td>\n<td>reset <em>PIN</em>, change <em>Reset Code</em>, add keys and owner information</td>\n</tr>\n<tr>\n<td>Reset code</td>\n<td><em><strong>None</strong></em></td>\n<td>reset <em>PIN</em> (<a href=\"https://forum.yubico.com/viewtopicd01c.html?p=9055#p9055\" rel=\"nofollow\">more information</a>)</td>\n</tr>\n</tbody>\n</table>\n<p dir=\"auto\">Values are valid up to 127 ASCII characters and must be at least 6 (<em>PIN</em>) or 8 (<em>Admin PIN</em>, <em>Reset Code</em>) characters. See the GnuPG documentation on <a href=\"https://www.gnupg.org/howtos/card-howto/en/ch03s02.html\" rel=\"nofollow\">Managing PINs</a> for details.</p>\n<p dir=\"auto\">To update the GPG PINs on the Yubikey:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"gpg/card&gt; passwd\ngpg: OpenPGP card no. D2760001240102010006055532110000 detected\n\n1 - change PIN\n2 - unblock PIN\n3 - change Admin PIN\n4 - set the Reset Code\nQ - quit\n\nYour selection? 3\nPIN changed.\n\n1 - change PIN\n2 - unblock PIN\n3 - change Admin PIN\n4 - set the Reset Code\nQ - quit\n\nYour selection? 1\nPIN changed.\n\n1 - change PIN\n2 - unblock PIN\n3 - change Admin PIN\n4 - set the Reset Code\nQ - quit\n\nYour selection? q\"><pre><span class=\"pl-c1\">gpg/card&gt; passwd</span>\n<span class=\"pl-c1\">gpg: OpenPGP card no. D2760001240102010006055532110000 detected</span>\n\n<span class=\"pl-c1\">1 - change PIN</span>\n<span class=\"pl-c1\">2 - unblock PIN</span>\n<span class=\"pl-c1\">3 - change Admin PIN</span>\n<span class=\"pl-c1\">4 - set the Reset Code</span>\n<span class=\"pl-c1\">Q - quit</span>\n\n<span class=\"pl-c1\">Your selection? 3</span>\n<span class=\"pl-c1\">PIN changed.</span>\n\n<span class=\"pl-c1\">1 - change PIN</span>\n<span class=\"pl-c1\">2 - unblock PIN</span>\n<span class=\"pl-c1\">3 - change Admin PIN</span>\n<span class=\"pl-c1\">4 - set the Reset Code</span>\n<span class=\"pl-c1\">Q - quit</span>\n\n<span class=\"pl-c1\">Your selection? 1</span>\n<span class=\"pl-c1\">PIN changed.</span>\n\n<span class=\"pl-c1\">1 - change PIN</span>\n<span class=\"pl-c1\">2 - unblock PIN</span>\n<span class=\"pl-c1\">3 - change Admin PIN</span>\n<span class=\"pl-c1\">4 - set the Reset Code</span>\n<span class=\"pl-c1\">Q - quit</span>\n\n<span class=\"pl-c1\">Your selection? q</span></pre></div>\n<p dir=\"auto\"><strong>Note</strong> The number of retry attempts can be changed later with the following command, documented <a href=\"https://docs.yubico.com/software/yubikey/tools/ykman/OpenPGP_Commands.html#ykman-openpgp-access-set-retries-options-pin-retries-reset-code-retries-admin-pin-retries\" rel=\"nofollow\">here</a>:</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ ykman openpgp access set-retries 5 5 5 -f -a YOUR_ADMIN_PIN\"><pre>$ ykman openpgp access set-retries 5 5 5 -f -a YOUR_ADMIN_PIN</pre></div>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-set-information\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#set-information\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Set information</h2>\n<p dir=\"auto\">Some fields are optional.</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"gpg/card&gt; name\nCardholder's surname: Duh\nCardholder's given name: Dr\n\ngpg/card&gt; lang\nLanguage preferences: en\n\ngpg/card&gt; login\nLogin data (account name): doc@duh.to\n\ngpg/card&gt; list\n\nApplication ID ...: D2760001240102010006055532110000\nVersion ..........: 3.4\nManufacturer .....: unknown\nSerial number ....: 05553211\nName of cardholder: Dr Duh\nLanguage prefs ...: en\nSex ..............: unspecified\nURL of public key : [not set]\nLogin data .......: doc@duh.to\nPrivate DO 4 .....: [not set]\nSignature PIN ....: not forced\nKey attributes ...: rsa2048 rsa2048 rsa2048\nMax. PIN lengths .: 127 127 127\nPIN retry counter : 3 0 3\nSignature counter : 0\nKDF setting ......: on\nSignature key ....: [none]\nEncryption key....: [none]\nAuthentication key: [none]\nGeneral key info..: [none]\n\ngpg/card&gt; quit\"><pre><span class=\"pl-c1\">gpg/card&gt; name</span>\n<span class=\"pl-c1\">Cardholder's surname: Duh</span>\n<span class=\"pl-c1\">Cardholder's given name: Dr</span>\n\n<span class=\"pl-c1\">gpg/card&gt; lang</span>\n<span class=\"pl-c1\">Language preferences: en</span>\n\n<span class=\"pl-c1\">gpg/card&gt; login</span>\n<span class=\"pl-c1\">Login data (account name): doc@duh.to</span>\n\n<span class=\"pl-c1\">gpg/card&gt; list</span>\n\n<span class=\"pl-c1\">Application ID ...: D2760001240102010006055532110000</span>\n<span class=\"pl-c1\">Version ..........: 3.4</span>\n<span class=\"pl-c1\">Manufacturer .....: unknown</span>\n<span class=\"pl-c1\">Serial number ....: 05553211</span>\n<span class=\"pl-c1\">Name of cardholder: Dr Duh</span>\n<span class=\"pl-c1\">Language prefs ...: en</span>\n<span class=\"pl-c1\">Sex ..............: unspecified</span>\n<span class=\"pl-c1\">URL of public key : [not set]</span>\n<span class=\"pl-c1\">Login data .......: doc@duh.to</span>\n<span class=\"pl-c1\">Private DO 4 .....: [not set]</span>\n<span class=\"pl-c1\">Signature PIN ....: not forced</span>\n<span class=\"pl-c1\">Key attributes ...: rsa2048 rsa2048 rsa2048</span>\n<span class=\"pl-c1\">Max. PIN lengths .: 127 127 127</span>\n<span class=\"pl-c1\">PIN retry counter : 3 0 3</span>\n<span class=\"pl-c1\">Signature counter : 0</span>\n<span class=\"pl-c1\">KDF setting ......: on</span>\n<span class=\"pl-c1\">Signature key ....: [none]</span>\n<span class=\"pl-c1\">Encryption key....: [none]</span>\n<span class=\"pl-c1\">Authentication key: [none]</span>\n<span class=\"pl-c1\">General key info..: [none]</span>\n\n<span class=\"pl-c1\">gpg/card&gt; quit</span></pre></div>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-transfer-keys\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#transfer-keys\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Transfer keys</h1>\n<p dir=\"auto\"><strong>Important</strong> Transferring keys to YubiKey using <code>keytocard</code> is a destructive, one-way operation only. Make sure you've made a backup before proceeding: <code>keytocard</code> converts the local, on-disk key into a stub, which means the on-disk copy is no longer usable to transfer to subsequent security key devices or mint additional keys.</p>\n<p dir=\"auto\">Previous GPG versions required the <code>toggle</code> command before selecting keys. The currently selected key(s) are indicated with an <code>*</code>. When moving keys only one key should be selected at a time.</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --edit-key $KEYID\n\nSecret key is available.\n\nsec  rsa4096/0xFF3E7D88647EBCDB\n    created: 2017-10-09  expires: never       usage: C\n    trust: ultimate      validity: ultimate\nssb  rsa4096/0xBECFA3C1AE191D15\n    created: 2017-10-09  expires: 2018-10-09  usage: S\nssb  rsa4096/0x5912A795E90DD2CF\n    created: 2017-10-09  expires: 2018-10-09  usage: E\nssb  rsa4096/0x3F29127E79649A3D\n    created: 2017-10-09  expires: 2018-10-09  usage: A\n[ultimate] (1). Dr Duh &lt;doc@duh.to&gt;\"><pre>$ <span class=\"pl-s1\">gpg --edit-key <span class=\"pl-smi\">$KEYID</span></span>\n\n<span class=\"pl-c1\">Secret key is available.</span>\n\n<span class=\"pl-c1\">sec  rsa4096/0xFF3E7D88647EBCDB</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: never       usage: C</span>\n<span class=\"pl-c1\">    trust: ultimate      validity: ultimate</span>\n<span class=\"pl-c1\">ssb  rsa4096/0xBECFA3C1AE191D15</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: 2018-10-09  usage: S</span>\n<span class=\"pl-c1\">ssb  rsa4096/0x5912A795E90DD2CF</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: 2018-10-09  usage: E</span>\n<span class=\"pl-c1\">ssb  rsa4096/0x3F29127E79649A3D</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: 2018-10-09  usage: A</span>\n<span class=\"pl-c1\">[ultimate] (1). Dr Duh &lt;doc@duh.to&gt;</span></pre></div>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-signing-1\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#signing-1\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Signing</h2>\n<p dir=\"auto\">You will be prompted for the master key passphrase and Admin PIN.</p>\n<p dir=\"auto\">Select and transfer the signature key.</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"gpg&gt; key 1\n\nsec  rsa4096/0xFF3E7D88647EBCDB\n    created: 2017-10-09  expires: never       usage: C\n    trust: ultimate      validity: ultimate\nssb* rsa4096/0xBECFA3C1AE191D15\n    created: 2017-10-09  expires: 2018-10-09  usage: S\nssb  rsa4096/0x5912A795E90DD2CF\n    created: 2017-10-09  expires: 2018-10-09  usage: E\nssb  rsa4096/0x3F29127E79649A3D\n    created: 2017-10-09  expires: 2018-10-09  usage: A\n[ultimate] (1). Dr Duh &lt;doc@duh.to&gt;\n\ngpg&gt; keytocard\nPlease select where to store the key:\n   (1) Signature key\n   (3) Authentication key\nYour selection? 1\n\nYou need a passphrase to unlock the secret key for\nuser: &quot;Dr Duh &lt;doc@duh.to&gt;&quot;\n4096-bit RSA key, ID 0xBECFA3C1AE191D15, created 2016-05-24\"><pre><span class=\"pl-c1\">gpg&gt; key 1</span>\n\n<span class=\"pl-c1\">sec  rsa4096/0xFF3E7D88647EBCDB</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: never       usage: C</span>\n<span class=\"pl-c1\">    trust: ultimate      validity: ultimate</span>\n<span class=\"pl-c1\">ssb* rsa4096/0xBECFA3C1AE191D15</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: 2018-10-09  usage: S</span>\n<span class=\"pl-c1\">ssb  rsa4096/0x5912A795E90DD2CF</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: 2018-10-09  usage: E</span>\n<span class=\"pl-c1\">ssb  rsa4096/0x3F29127E79649A3D</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: 2018-10-09  usage: A</span>\n<span class=\"pl-c1\">[ultimate] (1). Dr Duh &lt;doc@duh.to&gt;</span>\n\n<span class=\"pl-c1\">gpg&gt; keytocard</span>\n<span class=\"pl-c1\">Please select where to store the key:</span>\n<span class=\"pl-c1\">   (1) Signature key</span>\n<span class=\"pl-c1\">   (3) Authentication key</span>\n<span class=\"pl-c1\">Your selection? 1</span>\n\n<span class=\"pl-c1\">You need a passphrase to unlock the secret key for</span>\n<span class=\"pl-c1\">user: \"Dr Duh &lt;doc@duh.to&gt;\"</span>\n<span class=\"pl-c1\">4096-bit RSA key, ID 0xBECFA3C1AE191D15, created 2016-05-24</span></pre></div>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-encryption-1\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#encryption-1\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Encryption</h2>\n<p dir=\"auto\">Type <code>key 1</code> again to de-select and <code>key 2</code> to select the next key:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"gpg&gt; key 1\n\ngpg&gt; key 2\n\nsec  rsa4096/0xFF3E7D88647EBCDB\n    created: 2017-10-09  expires: never       usage: C\n    trust: ultimate      validity: ultimate\nssb  rsa4096/0xBECFA3C1AE191D15\n    created: 2017-10-09  expires: 2018-10-09  usage: S\nssb* rsa4096/0x5912A795E90DD2CF\n    created: 2017-10-09  expires: 2018-10-09  usage: E\nssb  rsa4096/0x3F29127E79649A3D\n    created: 2017-10-09  expires: 2018-10-09  usage: A\n[ultimate] (1). Dr Duh &lt;doc@duh.to&gt;\n\ngpg&gt; keytocard\nPlease select where to store the key:\n   (2) Encryption key\nYour selection? 2\n\n[...]\"><pre><span class=\"pl-c1\">gpg&gt; key 1</span>\n\n<span class=\"pl-c1\">gpg&gt; key 2</span>\n\n<span class=\"pl-c1\">sec  rsa4096/0xFF3E7D88647EBCDB</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: never       usage: C</span>\n<span class=\"pl-c1\">    trust: ultimate      validity: ultimate</span>\n<span class=\"pl-c1\">ssb  rsa4096/0xBECFA3C1AE191D15</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: 2018-10-09  usage: S</span>\n<span class=\"pl-c1\">ssb* rsa4096/0x5912A795E90DD2CF</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: 2018-10-09  usage: E</span>\n<span class=\"pl-c1\">ssb  rsa4096/0x3F29127E79649A3D</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: 2018-10-09  usage: A</span>\n<span class=\"pl-c1\">[ultimate] (1). Dr Duh &lt;doc@duh.to&gt;</span>\n\n<span class=\"pl-c1\">gpg&gt; keytocard</span>\n<span class=\"pl-c1\">Please select where to store the key:</span>\n<span class=\"pl-c1\">   (2) Encryption key</span>\n<span class=\"pl-c1\">Your selection? 2</span>\n\n<span class=\"pl-c1\">[...]</span></pre></div>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-authentication-1\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#authentication-1\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Authentication</h2>\n<p dir=\"auto\">Type <code>key 2</code> again to deselect and <code>key 3</code> to select the last key:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"gpg&gt; key 2\n\ngpg&gt; key 3\n\nsec  rsa4096/0xFF3E7D88647EBCDB\n    created: 2017-10-09  expires: never       usage: C\n    trust: ultimate      validity: ultimate\nssb  rsa4096/0xBECFA3C1AE191D15\n    created: 2017-10-09  expires: 2018-10-09  usage: S\nssb  rsa4096/0x5912A795E90DD2CF\n    created: 2017-10-09  expires: 2018-10-09  usage: E\nssb* rsa4096/0x3F29127E79649A3D\n    created: 2017-10-09  expires: 2018-10-09  usage: A\n[ultimate] (1). Dr Duh &lt;doc@duh.to&gt;\n\ngpg&gt; keytocard\nPlease select where to store the key:\n   (3) Authentication key\nYour selection? 3\"><pre><span class=\"pl-c1\">gpg&gt; key 2</span>\n\n<span class=\"pl-c1\">gpg&gt; key 3</span>\n\n<span class=\"pl-c1\">sec  rsa4096/0xFF3E7D88647EBCDB</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: never       usage: C</span>\n<span class=\"pl-c1\">    trust: ultimate      validity: ultimate</span>\n<span class=\"pl-c1\">ssb  rsa4096/0xBECFA3C1AE191D15</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: 2018-10-09  usage: S</span>\n<span class=\"pl-c1\">ssb  rsa4096/0x5912A795E90DD2CF</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: 2018-10-09  usage: E</span>\n<span class=\"pl-c1\">ssb* rsa4096/0x3F29127E79649A3D</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: 2018-10-09  usage: A</span>\n<span class=\"pl-c1\">[ultimate] (1). Dr Duh &lt;doc@duh.to&gt;</span>\n\n<span class=\"pl-c1\">gpg&gt; keytocard</span>\n<span class=\"pl-c1\">Please select where to store the key:</span>\n<span class=\"pl-c1\">   (3) Authentication key</span>\n<span class=\"pl-c1\">Your selection? 3</span></pre></div>\n<p dir=\"auto\">Save and quit:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"gpg&gt; save\"><pre><span class=\"pl-c1\">gpg&gt; save</span></pre></div>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-verify-card\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#verify-card\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Verify card</h1>\n<p dir=\"auto\">Verify the sub-keys have been moved to YubiKey as indicated by <code>ssb&gt;</code>:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg -K\n/tmp.FLZC0xcM/pubring.kbx\n-------------------------------------------------------------------------\nsec   rsa4096/0xFF3E7D88647EBCDB 2017-10-09 [C]\n      Key fingerprint = 011C E16B D45B 27A5 5BA8  776D FF3E 7D88 647E BCDB\nuid                            Dr Duh &lt;doc@duh.to&gt;\nssb&gt;  rsa4096/0xBECFA3C1AE191D15 2017-10-09 [S] [expires: 2018-10-09]\nssb&gt;  rsa4096/0x5912A795E90DD2CF 2017-10-09 [E] [expires: 2018-10-09]\nssb&gt;  rsa4096/0x3F29127E79649A3D 2017-10-09 [A] [expires: 2018-10-09]\"><pre>$ <span class=\"pl-s1\">gpg -K</span>\n<span class=\"pl-c1\">/tmp.FLZC0xcM/pubring.kbx</span>\n<span class=\"pl-c1\">-------------------------------------------------------------------------</span>\n<span class=\"pl-c1\">sec   rsa4096/0xFF3E7D88647EBCDB 2017-10-09 [C]</span>\n<span class=\"pl-c1\">      Key fingerprint = 011C E16B D45B 27A5 5BA8  776D FF3E 7D88 647E BCDB</span>\n<span class=\"pl-c1\">uid                            Dr Duh &lt;doc@duh.to&gt;</span>\n<span class=\"pl-c1\">ssb&gt;  rsa4096/0xBECFA3C1AE191D15 2017-10-09 [S] [expires: 2018-10-09]</span>\n<span class=\"pl-c1\">ssb&gt;  rsa4096/0x5912A795E90DD2CF 2017-10-09 [E] [expires: 2018-10-09]</span>\n<span class=\"pl-c1\">ssb&gt;  rsa4096/0x3F29127E79649A3D 2017-10-09 [A] [expires: 2018-10-09]</span></pre></div>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-multiple-yubikeys\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#multiple-yubikeys\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Multiple YubiKeys</h1>\n<p dir=\"auto\">To provision additional security keys, restore the master key backup and repeat the <a href=\"#configure-smartcard\">Configure Smartcard</a> procedure.</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ mv -vi $GNUPGHOME $GNUPGHOME.1\nrenamed '/tmp.FLZC0xcM' -&gt; '/tmp.FLZC0xcM.1'\n\n$ cp -avi /mnt/encrypted-storage/tmp.XXX $GNUPGHOME\n'/mnt/encrypted-storage/tmp.FLZC0xcM' -&gt; '/tmp.FLZC0xcM'\n\n$ cd $GNUPGHOME\"><pre>$ <span class=\"pl-s1\">mv -vi <span class=\"pl-smi\">$GNUPGHOME</span> <span class=\"pl-smi\">$GNUPGHOME</span>.1</span>\n<span class=\"pl-c1\">renamed '/tmp.FLZC0xcM' -&gt; '/tmp.FLZC0xcM.1'</span>\n\n$ <span class=\"pl-s1\">cp -avi /mnt/encrypted-storage/tmp.XXX <span class=\"pl-smi\">$GNUPGHOME</span></span>\n<span class=\"pl-c1\">'/mnt/encrypted-storage/tmp.FLZC0xcM' -&gt; '/tmp.FLZC0xcM'</span>\n\n$ <span class=\"pl-s1\"><span class=\"pl-c1\">cd</span> <span class=\"pl-smi\">$GNUPGHOME</span></span></pre></div>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-switching-between-two-or-more-yubikeys\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#switching-between-two-or-more-yubikeys\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Switching between two or more Yubikeys</h2>\n<p dir=\"auto\">When you add a GPG key to a Yubikey using the <em>keytocard</em> command, GPG deletes the key from your keyring and adds a <em>stub</em> pointing to that exact Yubikey (the stub identifies the GPG KeyID and the Yubikey's serial number).</p>\n<p dir=\"auto\">However, when you do this same operation for a second Yubikey, the stub in your keyring is overwritten by the <em>keytocard</em> operation and now the stub points to your second Yubikey. Adding more repeats this overwriting operation.</p>\n<p dir=\"auto\">In other words, the stub will point ONLY to the LAST Yubikey written to.</p>\n<p dir=\"auto\">When using GPG key operations with the GPG key you placed onto the Yubikeys, GPG will request a specific Yubikey asking that you insert a Yubikey with a given serial number (referenced by the stub). GPG will not recognise another Yubikey with a different serial number without manual intervention.</p>\n<p dir=\"auto\">You can force GPG to scan the card and re-create the stubs to point to another Yubikey.</p>\n<p dir=\"auto\">Having created two (or more Yubikeys) with the same GPG key (as described above) where the stubs are pointing to the second Yubikey:</p>\n<p dir=\"auto\">Insert the first Yubikey (which has a different serial number) and run the following command:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$  gpg-connect-agent &quot;scd serialno&quot; &quot;learn --force&quot; /bye\"><pre>$  <span class=\"pl-s1\">gpg-connect-agent <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>scd serialno<span class=\"pl-pds\">\"</span></span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>learn --force<span class=\"pl-pds\">\"</span></span> /bye</span></pre></div>\n<p dir=\"auto\">GPG will then scan your first Yubikey for GPG keys and recreate the stubs to point to the GPG keyID and Yubikey Serial number of this first Yubikey.</p>\n<p dir=\"auto\">To return to using the second Yubikey just repeat (insert other Yubikey and re-run command).</p>\n<p dir=\"auto\">Obviously this command is not easy to remember so it is recommended to either create a script or a shell alias to make this more user friendly.</p>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-multiple-hosts\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#multiple-hosts\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Multiple Hosts</h1>\n<p dir=\"auto\">It can be convenient to use your YubiKey on multiple hosts:</p>\n<ul dir=\"auto\">\n<li>a desktop plus a laptop</li>\n<li>home and work computers</li>\n<li>an environment like <a href=\"https://tails.boum.org\" rel=\"nofollow\">Tails</a></li>\n</ul>\n<p dir=\"auto\">The simplest way to set up a second host is to begin by exporting your public key and trust settings on the host where your YubiKey is already working:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --armor --export $KEYID &gt; gpg-public-key-$KEYID.asc\n$ gpg --export-ownertrust &gt; gpg-owner-trust.txt\"><pre>$ <span class=\"pl-s1\">gpg --armor --export <span class=\"pl-smi\">$KEYID</span> <span class=\"pl-k\">&gt;</span> gpg-public-key-<span class=\"pl-smi\">$KEYID</span>.asc</span>\n$ <span class=\"pl-s1\">gpg --export-ownertrust <span class=\"pl-k\">&gt;</span> gpg-owner-trust.txt</span></pre></div>\n<p dir=\"auto\">Move both files to the second host. Then, on the second host:</p>\n<ol dir=\"auto\">\n<li>\n<p dir=\"auto\">Define your KEYID. For example:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ export KEYID=0xFF3E7D88647EBCDB\"><pre>$ <span class=\"pl-s1\"><span class=\"pl-k\">export</span> KEYID=0xFF3E7D88647EBCDB</span></pre></div>\n</li>\n<li>\n<p dir=\"auto\">Import your public key:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --import gpg-public-key-$KEYID.asc\"><pre>$ <span class=\"pl-s1\">gpg --import gpg-public-key-<span class=\"pl-smi\">$KEYID</span>.asc</span></pre></div>\n</li>\n<li>\n<p dir=\"auto\">Import the trust settings:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --import-ownertrust &lt; gpg-owner-trust.txt\"><pre>$ <span class=\"pl-s1\">gpg --import-ownertrust <span class=\"pl-k\">&lt;</span> gpg-owner-trust.txt</span></pre></div>\n</li>\n<li>\n<p dir=\"auto\">Insert your YubiKey into a USB port.</p>\n</li>\n<li>\n<p dir=\"auto\">Import the private key stubs from the YubiKey:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --card-status\"><pre>$ <span class=\"pl-s1\">gpg --card-status</span></pre></div>\n</li>\n</ol>\n<p dir=\"auto\">If you need to set up a second host when you are travelling and don't have ready access to your primary host, you can import your public key from a key-server and set trust manually:</p>\n<ol dir=\"auto\">\n<li>\n<p dir=\"auto\">Define your KEYID. For example:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ export KEYID=0xFF3E7D88647EBCDB\"><pre>$ <span class=\"pl-s1\"><span class=\"pl-k\">export</span> KEYID=0xFF3E7D88647EBCDB</span></pre></div>\n</li>\n<li>\n<p dir=\"auto\">Fetch the public key from a key-server. For example:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --keyserver hkps://keyserver.ubuntu.com:443 --recv $KEYID\"><pre>$ <span class=\"pl-s1\">gpg --keyserver hkps://keyserver.ubuntu.com:443 --recv <span class=\"pl-smi\">$KEYID</span></span></pre></div>\n</li>\n<li>\n<p dir=\"auto\">Set ultimate trust:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --edit-key $KEYID\ngpg&gt; trust\nYour decision? 5\nDo you really want to set this key to ultimate trust? (y/N) y\ngpg&gt; quit\"><pre>$ <span class=\"pl-s1\">gpg --edit-key <span class=\"pl-smi\">$KEYID</span></span>\n<span class=\"pl-c1\">gpg&gt; trust</span>\n<span class=\"pl-c1\">Your decision? 5</span>\n<span class=\"pl-c1\">Do you really want to set this key to ultimate trust? (y/N) y</span>\n<span class=\"pl-c1\">gpg&gt; quit</span></pre></div>\n</li>\n<li>\n<p dir=\"auto\">Insert your YubiKey into a USB port.</p>\n</li>\n<li>\n<p dir=\"auto\">Import the private key stubs from the YubiKey:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --card-status\"><pre>$ <span class=\"pl-s1\">gpg --card-status</span></pre></div>\n</li>\n</ol>\n<p dir=\"auto\">Another approach is to add the URL of your public key to your YubiKey:</p>\n<ol dir=\"auto\">\n<li>\n<p dir=\"auto\">Define your KEYID. For example:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ KEYID=0xFF3E7D88647EBCDB\"><pre>$ <span class=\"pl-s1\">KEYID=0xFF3E7D88647EBCDB</span></pre></div>\n</li>\n<li>\n<p dir=\"auto\">Construct the URL (based on <a href=\"https://datatracker.ietf.org/doc/html/draft-shaw-openpgp-hkp-00\" rel=\"nofollow\">Shaw 2003</a>):</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ [[ ! &quot;$KEYID&quot; =~ ^&quot;0x&quot; ]] &amp;&amp; KEYID=&quot;0x${KEYID}&quot;\n$ URL=&quot;hkps://keyserver.ubuntu.com:443/pks/lookup?op=get&amp;search=${KEYID}&quot;\n$ echo $URL\nhkps://keyserver.ubuntu.com:443/pks/lookup?op=get&amp;search=0xFF3E7D88647EBCDB\"><pre>$ <span class=\"pl-s1\">[[ <span class=\"pl-k\">!</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"pl-smi\">$KEYID</span><span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">=~</span> ^<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>0x<span class=\"pl-pds\">\"</span></span> ]] <span class=\"pl-k\">&amp;&amp;</span> KEYID=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>0x<span class=\"pl-smi\">${KEYID}</span><span class=\"pl-pds\">\"</span></span></span>\n$ <span class=\"pl-s1\">URL=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>hkps://keyserver.ubuntu.com:443/pks/lookup?op=get&amp;search=<span class=\"pl-smi\">${KEYID}</span><span class=\"pl-pds\">\"</span></span></span>\n$ <span class=\"pl-s1\"><span class=\"pl-c1\">echo</span> <span class=\"pl-smi\">$URL</span></span>\n<span class=\"pl-c1\">hkps://keyserver.ubuntu.com:443/pks/lookup?op=get&amp;search=0xFF3E7D88647EBCDB</span></pre></div>\n</li>\n<li>\n<p dir=\"auto\">Insert your YubiKey into a USB port.</p>\n</li>\n<li>\n<p dir=\"auto\">Add the URL to your YubiKey (will prompt for your YubiKey's admin PIN):</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --edit-card\ngpg/card&gt; admin\ngpg/card&gt; url\nURL to retrieve public key: hkps://keyserver.ubuntu.com:443/pks/lookup?op=get&amp;search=0xFF3E7D88647EBCDB\ngpg/card&gt; quit\"><pre>$ <span class=\"pl-s1\">gpg --edit-card</span>\n<span class=\"pl-c1\">gpg/card&gt; admin</span>\n<span class=\"pl-c1\">gpg/card&gt; url</span>\n<span class=\"pl-c1\">URL to retrieve public key: hkps://keyserver.ubuntu.com:443/pks/lookup?op=get&amp;search=0xFF3E7D88647EBCDB</span>\n<span class=\"pl-c1\">gpg/card&gt; quit</span></pre></div>\n<p dir=\"auto\">Note:</p>\n<ul dir=\"auto\">\n<li>You do not have to use a <em>keyserver</em> URL. You can export your public key as an armored ASCII file and upload it to any place on the web where it can be downloaded using HTTP/HTTPS.</li>\n</ul>\n</li>\n</ol>\n<p dir=\"auto\">Once the URL of your public key is present on your YubiKey, setting up a new host becomes:</p>\n<ol dir=\"auto\">\n<li>\n<p dir=\"auto\">Insert your YubiKey into a USB port.</p>\n</li>\n<li>\n<p dir=\"auto\">Use the <code>fetch</code> sub-command to retrieve your public key using the URL stored on the card:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --edit-card\n\ngpg/card&gt; fetch\ngpg: requesting key from 'hkps://keyserver.ubuntu.com:443/pks/lookup?op=get&amp;search=0xFF3E7D88647EBCDB'\ngpg: /home/pi/.gnupg/trustdb.gpg: trustdb created\ngpg: key FF3E7D88647EBCDB: public key &quot;Dr Duh &lt;doc@duh.to&gt;&quot; imported\ngpg: Total number processed: 1\ngpg:               imported: 1\n\ngpg/card&gt; quit\"><pre>$ <span class=\"pl-s1\">gpg --edit-card</span>\n\n<span class=\"pl-c1\">gpg/card&gt; fetch</span>\n<span class=\"pl-c1\">gpg: requesting key from 'hkps://keyserver.ubuntu.com:443/pks/lookup?op=get&amp;search=0xFF3E7D88647EBCDB'</span>\n<span class=\"pl-c1\">gpg: /home/pi/.gnupg/trustdb.gpg: trustdb created</span>\n<span class=\"pl-c1\">gpg: key FF3E7D88647EBCDB: public key \"Dr Duh &lt;doc@duh.to&gt;\" imported</span>\n<span class=\"pl-c1\">gpg: Total number processed: 1</span>\n<span class=\"pl-c1\">gpg:               imported: 1</span>\n\n<span class=\"pl-c1\">gpg/card&gt; quit</span></pre></div>\n<p dir=\"auto\">This step also imports the private key stubs from the YubiKey.</p>\n</li>\n<li>\n<p dir=\"auto\">Define your KEYID (which appears in the output in the previous step):</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ export KEYID=0xFF3E7D88647EBCDB\"><pre>$ <span class=\"pl-s1\"><span class=\"pl-k\">export</span> KEYID=0xFF3E7D88647EBCDB</span></pre></div>\n</li>\n<li>\n<p dir=\"auto\">Set ultimate trust:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --edit-key $KEYID\ngpg&gt; trust\nYour decision? 5\nDo you really want to set this key to ultimate trust? (y/N) y\ngpg&gt; quit\"><pre>$ <span class=\"pl-s1\">gpg --edit-key <span class=\"pl-smi\">$KEYID</span></span>\n<span class=\"pl-c1\">gpg&gt; trust</span>\n<span class=\"pl-c1\">Your decision? 5</span>\n<span class=\"pl-c1\">Do you really want to set this key to ultimate trust? (y/N) y</span>\n<span class=\"pl-c1\">gpg&gt; quit</span></pre></div>\n</li>\n</ol>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-cleanup\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#cleanup\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Cleanup</h1>\n<p dir=\"auto\">Before finishing the setup, ensure you have done the following:</p>\n<ul dir=\"auto\">\n<li>Saved encryption, signing and authentication sub-keys to YubiKey (<code>gpg -K</code> should show <code>ssb&gt;</code> for sub-keys).</li>\n<li>Saved the YubiKey user and admin PINs which are different and were changed from default values.</li>\n<li>Saved the password to the GPG master key in a secure, long-term location.</li>\n<li>Saved a copy of the master key, sub-keys and revocation certificate on an encrypted volume, to be stored offline.</li>\n<li>Saved the password to that LUKS-encrypted volume in a secure, long-term location (separate from the device itself).</li>\n<li>Saved a copy of the public key somewhere easily accessible later.</li>\n</ul>\n<p dir=\"auto\">Now reboot or <a href=\"http://srm.sourceforge.net/\" rel=\"nofollow\">securely delete</a> <code>$GNUPGHOME</code> and remove the secret keys from the GPG keyring:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --delete-secret-key $KEYID\n\n$ sudo srm -r $GNUPGHOME || sudo rm -rf $GNUPGHOME\n\n$ unset GNUPGHOME\"><pre>$ <span class=\"pl-s1\">gpg --delete-secret-key <span class=\"pl-smi\">$KEYID</span></span>\n\n$ <span class=\"pl-s1\">sudo srm -r <span class=\"pl-smi\">$GNUPGHOME</span> <span class=\"pl-k\">||</span> sudo rm -rf <span class=\"pl-smi\">$GNUPGHOME</span></span>\n\n$ <span class=\"pl-s1\"><span class=\"pl-c1\">unset</span> GNUPGHOME</span></pre></div>\n<p dir=\"auto\"><strong>Important</strong> Make sure you have securely erased all generated keys and revocation certificates if an ephemeral enviroment was not used!</p>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-using-keys\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#using-keys\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Using keys</h1>\n<p dir=\"auto\">Download <a href=\"https://github.com/drduh/config/blob/master/gpg.conf\">drduh/config/gpg.conf</a>:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ cd ~/.gnupg ; wget https://raw.githubusercontent.com/drduh/config/master/gpg.conf\n\n$ chmod 600 gpg.conf\"><pre>$ <span class=\"pl-s1\"><span class=\"pl-c1\">cd</span> <span class=\"pl-k\">~</span>/.gnupg <span class=\"pl-k\">;</span> wget https://raw.githubusercontent.com/drduh/config/master/gpg.conf</span>\n\n$ <span class=\"pl-s1\">chmod 600 gpg.conf</span></pre></div>\n<p dir=\"auto\">Install the required packages and mount the non-encrypted volume created earlier:</p>\n<p dir=\"auto\"><strong>Linux</strong></p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ sudo apt update &amp;&amp; sudo apt install -y gnupg2 gnupg-agent gnupg-curl scdaemon pcscd\n\n$ sudo mount /dev/mmcblk0p2 /mnt\"><pre>$ <span class=\"pl-s1\">sudo apt update <span class=\"pl-k\">&amp;&amp;</span> sudo apt install -y gnupg2 gnupg-agent gnupg-curl scdaemon pcscd</span>\n\n$ <span class=\"pl-s1\">sudo mount /dev/mmcblk0p2 /mnt</span></pre></div>\n<p dir=\"auto\"><strong>OpenBSD</strong></p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ doas pkg_add gnupg pcsc-tools\n\n$ doas mount /dev/sd2b /mnt\"><pre>$ <span class=\"pl-s1\">doas pkg_add gnupg pcsc-tools</span>\n\n$ <span class=\"pl-s1\">doas mount /dev/sd2b /mnt</span></pre></div>\n<p dir=\"auto\">Import the public key file:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --import /mnt/gpg-0x*.asc\ngpg: key 0xFF3E7D88647EBCDB: public key &quot;Dr Duh &lt;doc@duh.to&gt;&quot; imported\ngpg: Total number processed: 1\ngpg:               imported: 1\"><pre>$ <span class=\"pl-s1\">gpg --import /mnt/gpg-0x<span class=\"pl-k\">*</span>.asc</span>\n<span class=\"pl-c1\">gpg: key 0xFF3E7D88647EBCDB: public key \"Dr Duh &lt;doc@duh.to&gt;\" imported</span>\n<span class=\"pl-c1\">gpg: Total number processed: 1</span>\n<span class=\"pl-c1\">gpg:               imported: 1</span></pre></div>\n<p dir=\"auto\">Or download the public key from a keyserver:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --recv $KEYID\ngpg: requesting key 0xFF3E7D88647EBCDB from hkps server hkps.pool.sks-keyservers.net\n[...]\ngpg: key 0xFF3E7D88647EBCDB: public key &quot;Dr Duh &lt;doc@duh.to&gt;&quot; imported\ngpg: Total number processed: 1\ngpg:               imported: 1\"><pre>$ <span class=\"pl-s1\">gpg --recv <span class=\"pl-smi\">$KEYID</span></span>\n<span class=\"pl-c1\">gpg: requesting key 0xFF3E7D88647EBCDB from hkps server hkps.pool.sks-keyservers.net</span>\n<span class=\"pl-c1\">[...]</span>\n<span class=\"pl-c1\">gpg: key 0xFF3E7D88647EBCDB: public key \"Dr Duh &lt;doc@duh.to&gt;\" imported</span>\n<span class=\"pl-c1\">gpg: Total number processed: 1</span>\n<span class=\"pl-c1\">gpg:               imported: 1</span></pre></div>\n<p dir=\"auto\">Edit the master key to assign it ultimate trust by selecting <code>trust</code> and <code>5</code>:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ export KEYID=0xFF3E7D88647EBCDB\n\n$ gpg --edit-key $KEYID\n\ngpg&gt; trust\npub  4096R/0xFF3E7D88647EBCDB  created: 2016-05-24  expires: never       usage: C\n                               trust: unknown       validity: unknown\nsub  4096R/0xBECFA3C1AE191D15  created: 2017-10-09  expires: 2018-10-09  usage: S\nsub  4096R/0x5912A795E90DD2CF  created: 2017-10-09  expires: 2018-10-09  usage: E\nsub  4096R/0x3F29127E79649A3D  created: 2017-10-09  expires: 2018-10-09  usage: A\n[ unknown] (1). Dr Duh &lt;doc@duh.to&gt;\n\nPlease decide how far you trust this user to correctly verify other users' keys\n(by looking at passports, checking fingerprints from different sources, etc.)\n\n  1 = I don't know or won't say\n  2 = I do NOT trust\n  3 = I trust marginally\n  4 = I trust fully\n  5 = I trust ultimately\n  m = back to the main menu\n\nYour decision? 5\nDo you really want to set this key to ultimate trust? (y/N) y\n\npub  4096R/0xFF3E7D88647EBCDB  created: 2016-05-24  expires: never       usage: C\n                               trust: ultimate      validity: unknown\nsub  4096R/0xBECFA3C1AE191D15  created: 2017-10-09  expires: 2018-10-09  usage: S\nsub  4096R/0x5912A795E90DD2CF  created: 2017-10-09  expires: 2018-10-09  usage: E\nsub  4096R/0x3F29127E79649A3D  created: 2017-10-09  expires: 2018-10-09  usage: A\n[ unknown] (1). Dr Duh &lt;doc@duh.to&gt;\n\ngpg&gt; quit\"><pre>$ <span class=\"pl-s1\"><span class=\"pl-k\">export</span> KEYID=0xFF3E7D88647EBCDB</span>\n\n$ <span class=\"pl-s1\">gpg --edit-key <span class=\"pl-smi\">$KEYID</span></span>\n\n<span class=\"pl-c1\">gpg&gt; trust</span>\n<span class=\"pl-c1\">pub  4096R/0xFF3E7D88647EBCDB  created: 2016-05-24  expires: never       usage: C</span>\n<span class=\"pl-c1\">                               trust: unknown       validity: unknown</span>\n<span class=\"pl-c1\">sub  4096R/0xBECFA3C1AE191D15  created: 2017-10-09  expires: 2018-10-09  usage: S</span>\n<span class=\"pl-c1\">sub  4096R/0x5912A795E90DD2CF  created: 2017-10-09  expires: 2018-10-09  usage: E</span>\n<span class=\"pl-c1\">sub  4096R/0x3F29127E79649A3D  created: 2017-10-09  expires: 2018-10-09  usage: A</span>\n<span class=\"pl-c1\">[ unknown] (1). Dr Duh &lt;doc@duh.to&gt;</span>\n\n<span class=\"pl-c1\">Please decide how far you trust this user to correctly verify other users' keys</span>\n<span class=\"pl-c1\">(by looking at passports, checking fingerprints from different sources, etc.)</span>\n\n<span class=\"pl-c1\">  1 = I don't know or won't say</span>\n<span class=\"pl-c1\">  2 = I do NOT trust</span>\n<span class=\"pl-c1\">  3 = I trust marginally</span>\n<span class=\"pl-c1\">  4 = I trust fully</span>\n<span class=\"pl-c1\">  5 = I trust ultimately</span>\n<span class=\"pl-c1\">  m = back to the main menu</span>\n\n<span class=\"pl-c1\">Your decision? 5</span>\n<span class=\"pl-c1\">Do you really want to set this key to ultimate trust? (y/N) y</span>\n\n<span class=\"pl-c1\">pub  4096R/0xFF3E7D88647EBCDB  created: 2016-05-24  expires: never       usage: C</span>\n<span class=\"pl-c1\">                               trust: ultimate      validity: unknown</span>\n<span class=\"pl-c1\">sub  4096R/0xBECFA3C1AE191D15  created: 2017-10-09  expires: 2018-10-09  usage: S</span>\n<span class=\"pl-c1\">sub  4096R/0x5912A795E90DD2CF  created: 2017-10-09  expires: 2018-10-09  usage: E</span>\n<span class=\"pl-c1\">sub  4096R/0x3F29127E79649A3D  created: 2017-10-09  expires: 2018-10-09  usage: A</span>\n<span class=\"pl-c1\">[ unknown] (1). Dr Duh &lt;doc@duh.to&gt;</span>\n\n<span class=\"pl-c1\">gpg&gt; quit</span></pre></div>\n<p dir=\"auto\">Remove and re-insert YubiKey and verify the status:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --card-status\nReader ...........: Yubico YubiKey OTP FIDO CCID 00 00\nApplication ID ...: D2760001240102010006055532110000\nVersion ..........: 3.4\nManufacturer .....: Yubico\nSerial number ....: 05553211\nName of cardholder: Dr Duh\nLanguage prefs ...: en\nSex ..............: unspecified\nURL of public key : [not set]\nLogin data .......: doc@duh.to\nSignature PIN ....: not forced\nKey attributes ...: rsa4096 rsa4096 rsa4096\nMax. PIN lengths .: 127 127 127\nPIN retry counter : 3 3 3\nSignature counter : 0\nKDF setting ......: on\nSignature key ....: 07AA 7735 E502 C5EB E09E  B8B0 BECF A3C1 AE19 1D15\n      created ....: 2016-05-24 23:22:01\nEncryption key....: 6F26 6F46 845B BEB8 BDF3  7E9B 5912 A795 E90D D2CF\n      created ....: 2016-05-24 23:29:03\nAuthentication key: 82BE 7837 6A3F 2E7B E556  5E35 3F29 127E 7964 9A3D\n      created ....: 2016-05-24 23:36:40\nGeneral key info..: pub  4096R/0xBECFA3C1AE191D15 2016-05-24 Dr Duh &lt;doc@duh.to&gt;\nsec#  4096R/0xFF3E7D88647EBCDB  created: 2016-05-24  expires: never\nssb&gt;  4096R/0xBECFA3C1AE191D15  created: 2017-10-09  expires: 2018-10-09\n                      card-no: 0006 05553211\nssb&gt;  4096R/0x5912A795E90DD2CF  created: 2017-10-09  expires: 2018-10-09\n                      card-no: 0006 05553211\nssb&gt;  4096R/0x3F29127E79649A3D  created: 2017-10-09  expires: 2018-10-09\n                      card-no: 0006 05553211\"><pre>$ <span class=\"pl-s1\">gpg --card-status</span>\n<span class=\"pl-c1\">Reader ...........: Yubico YubiKey OTP FIDO CCID 00 00</span>\n<span class=\"pl-c1\">Application ID ...: D2760001240102010006055532110000</span>\n<span class=\"pl-c1\">Version ..........: 3.4</span>\n<span class=\"pl-c1\">Manufacturer .....: Yubico</span>\n<span class=\"pl-c1\">Serial number ....: 05553211</span>\n<span class=\"pl-c1\">Name of cardholder: Dr Duh</span>\n<span class=\"pl-c1\">Language prefs ...: en</span>\n<span class=\"pl-c1\">Sex ..............: unspecified</span>\n<span class=\"pl-c1\">URL of public key : [not set]</span>\n<span class=\"pl-c1\">Login data .......: doc@duh.to</span>\n<span class=\"pl-c1\">Signature PIN ....: not forced</span>\n<span class=\"pl-c1\">Key attributes ...: rsa4096 rsa4096 rsa4096</span>\n<span class=\"pl-c1\">Max. PIN lengths .: 127 127 127</span>\n<span class=\"pl-c1\">PIN retry counter : 3 3 3</span>\n<span class=\"pl-c1\">Signature counter : 0</span>\n<span class=\"pl-c1\">KDF setting ......: on</span>\n<span class=\"pl-c1\">Signature key ....: 07AA 7735 E502 C5EB E09E  B8B0 BECF A3C1 AE19 1D15</span>\n<span class=\"pl-c1\">      created ....: 2016-05-24 23:22:01</span>\n<span class=\"pl-c1\">Encryption key....: 6F26 6F46 845B BEB8 BDF3  7E9B 5912 A795 E90D D2CF</span>\n<span class=\"pl-c1\">      created ....: 2016-05-24 23:29:03</span>\n<span class=\"pl-c1\">Authentication key: 82BE 7837 6A3F 2E7B E556  5E35 3F29 127E 7964 9A3D</span>\n<span class=\"pl-c1\">      created ....: 2016-05-24 23:36:40</span>\n<span class=\"pl-c1\">General key info..: pub  4096R/0xBECFA3C1AE191D15 2016-05-24 Dr Duh &lt;doc@duh.to&gt;</span>\n<span class=\"pl-c1\">sec#  4096R/0xFF3E7D88647EBCDB  created: 2016-05-24  expires: never</span>\n<span class=\"pl-c1\">ssb&gt;  4096R/0xBECFA3C1AE191D15  created: 2017-10-09  expires: 2018-10-09</span>\n<span class=\"pl-c1\">                      card-no: 0006 05553211</span>\n<span class=\"pl-c1\">ssb&gt;  4096R/0x5912A795E90DD2CF  created: 2017-10-09  expires: 2018-10-09</span>\n<span class=\"pl-c1\">                      card-no: 0006 05553211</span>\n<span class=\"pl-c1\">ssb&gt;  4096R/0x3F29127E79649A3D  created: 2017-10-09  expires: 2018-10-09</span>\n<span class=\"pl-c1\">                      card-no: 0006 05553211</span></pre></div>\n<p dir=\"auto\"><code>sec#</code> indicates the master key is not available (as it should be stored encrypted offline).</p>\n<p dir=\"auto\"><strong>Note</strong> If you see <code>General key info..: [none]</code> in the output instead - go back and import the public key using the previous step.</p>\n<p dir=\"auto\">Encrypt a message to your own key (useful for storing password credentials and other data):</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ echo &quot;test message string&quot; | gpg --encrypt --armor --recipient $KEYID -o encrypted.txt\"><pre>$ <span class=\"pl-s1\"><span class=\"pl-c1\">echo</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>test message string<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">|</span> gpg --encrypt --armor --recipient <span class=\"pl-smi\">$KEYID</span> -o encrypted.txt</span></pre></div>\n<p dir=\"auto\">To encrypt to multiple recipients (or to multiple keys):</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ echo &quot;test message string&quot; | gpg --encrypt --armor --recipient $KEYID_0 --recipient $KEYID_1 --recipient $KEYID_2 -o encrypted.txt\"><pre>$ <span class=\"pl-s1\"><span class=\"pl-c1\">echo</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>test message string<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">|</span> gpg --encrypt --armor --recipient <span class=\"pl-smi\">$KEYID_0</span> --recipient <span class=\"pl-smi\">$KEYID_1</span> --recipient <span class=\"pl-smi\">$KEYID_2</span> -o encrypted.txt</span></pre></div>\n<p dir=\"auto\">Decrypt the message:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --decrypt --armor encrypted.txt\ngpg: anonymous recipient; trying secret key 0x0000000000000000 ...\ngpg: okay, we are the anonymous recipient.\ngpg: encrypted with RSA key, ID 0x0000000000000000\ntest message string\"><pre>$ <span class=\"pl-s1\">gpg --decrypt --armor encrypted.txt</span>\n<span class=\"pl-c1\">gpg: anonymous recipient; trying secret key 0x0000000000000000 ...</span>\n<span class=\"pl-c1\">gpg: okay, we are the anonymous recipient.</span>\n<span class=\"pl-c1\">gpg: encrypted with RSA key, ID 0x0000000000000000</span>\n<span class=\"pl-c1\">test message string</span></pre></div>\n<p dir=\"auto\">Sign a message:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ echo &quot;test message string&quot; | gpg --armor --clearsign &gt; signed.txt\"><pre>$ <span class=\"pl-s1\"><span class=\"pl-c1\">echo</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>test message string<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">|</span> gpg --armor --clearsign <span class=\"pl-k\">&gt;</span> signed.txt</span></pre></div>\n<p dir=\"auto\">Verify the signature:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --verify signed.txt\ngpg: Signature made Wed 25 May 2016 00:00:00 AM UTC\ngpg:                using RSA key 0xBECFA3C1AE191D15\ngpg: Good signature from &quot;Dr Duh &lt;doc@duh.to&gt;&quot; [ultimate]\nPrimary key fingerprint: 011C E16B D45B 27A5 5BA8  776D FF3E 7D88 647E BCDB\n     Subkey fingerprint: 07AA 7735 E502 C5EB E09E  B8B0 BECF A3C1 AE19 1D15\"><pre>$ <span class=\"pl-s1\">gpg --verify signed.txt</span>\n<span class=\"pl-c1\">gpg: Signature made Wed 25 May 2016 00:00:00 AM UTC</span>\n<span class=\"pl-c1\">gpg:                using RSA key 0xBECFA3C1AE191D15</span>\n<span class=\"pl-c1\">gpg: Good signature from \"Dr Duh &lt;doc@duh.to&gt;\" [ultimate]</span>\n<span class=\"pl-c1\">Primary key fingerprint: 011C E16B D45B 27A5 5BA8  776D FF3E 7D88 647E BCDB</span>\n<span class=\"pl-c1\">     Subkey fingerprint: 07AA 7735 E502 C5EB E09E  B8B0 BECF A3C1 AE19 1D15</span></pre></div>\n<p dir=\"auto\">Use a <a href=\"https://github.com/drduh/config/blob/master/zshrc\">shell function</a> to make encrypting files easier:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"secret () {\n        output=~/&quot;${1}&quot;.$(date +%s).enc\n        gpg --encrypt --armor --output ${output} -r 0x0000 -r 0x0001 -r 0x0002 &quot;${1}&quot; &amp;&amp; echo &quot;${1} -&gt; ${output}&quot;\n}\n\nreveal () {\n        output=$(echo &quot;${1}&quot; | rev | cut -c16- | rev)\n        gpg --decrypt --output ${output} &quot;${1}&quot; &amp;&amp; echo &quot;${1} -&gt; ${output}&quot;\n}\"><pre class=\"notranslate\"><code>secret () {\n        output=~/\"${1}\".$(date +%s).enc\n        gpg --encrypt --armor --output ${output} -r 0x0000 -r 0x0001 -r 0x0002 \"${1}\" &amp;&amp; echo \"${1} -&gt; ${output}\"\n}\n\nreveal () {\n        output=$(echo \"${1}\" | rev | cut -c16- | rev)\n        gpg --decrypt --output ${output} \"${1}\" &amp;&amp; echo \"${1} -&gt; ${output}\"\n}\n</code></pre></div>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ secret document.pdf\ndocument.pdf -&gt; document.pdf.1580000000.enc\n\n$ reveal document.pdf.1580000000.enc\ngpg: anonymous recipient; trying secret key 0xFF3E7D88647EBCDB ...\ngpg: okay, we are the anonymous recipient.\ngpg: encrypted with RSA key, ID 0x0000000000000000\ndocument.pdf.1580000000.enc -&gt; document.pdf\"><pre>$ <span class=\"pl-s1\">secret document.pdf</span>\n<span class=\"pl-c1\">document.pdf -&gt; document.pdf.1580000000.enc</span>\n\n$ <span class=\"pl-s1\">reveal document.pdf.1580000000.enc</span>\n<span class=\"pl-c1\">gpg: anonymous recipient; trying secret key 0xFF3E7D88647EBCDB ...</span>\n<span class=\"pl-c1\">gpg: okay, we are the anonymous recipient.</span>\n<span class=\"pl-c1\">gpg: encrypted with RSA key, ID 0x0000000000000000</span>\n<span class=\"pl-c1\">document.pdf.1580000000.enc -&gt; document.pdf</span></pre></div>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-rotating-keys\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#rotating-keys\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Rotating keys</h1>\n<p dir=\"auto\">PGP does not provide forward secrecy - a compromised key may be used to decrypt all past messages. Although keys stored on YubiKey are difficult to steal, it is not impossible - the key and PIN could be taken, or a vulnerability may be discovered in key hardware or the random number generator used to create them, for example. Therefore, it is good practice to occassionally rotate sub-keys.</p>\n<p dir=\"auto\">When a sub-key expires, it can either be renewed or replaced. Both actions require access to the offline master key. Renewing sub-keys by updating their expiration date indicates you are still in possession of the offline master key and is more convenient.</p>\n<p dir=\"auto\">Replacing keys, on the other hand, is less convenient but more secure: the new sub-keys will <strong>not</strong> be able to decrypt previous messages, authenticate with SSH, etc. Contacts will need to receive the updated public key and any encrypted secrets need to be decrypted and re-encrypted to new sub-keys to be usable. This process is functionally equivalent to \"losing\" the YubiKey and provisioning a new one. However, you will always be able to decrypt previous messages using the offline encrypted backup of the original keys.</p>\n<p dir=\"auto\">Neither rotation method is superior and it's up to personal philosophy on identity management and individual threat model to decide which one to use, or whether to expire sub-keys at all. Ideally, sub-keys would be ephemeral: used only once for each encryption, signing and authentication event, however in practice that is not really feasible nor worthwhile with YubiKey. Advanced users may want to dedicate an offline device for more frequent key rotations and ease of provisioning.</p>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-setup-environment\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#setup-environment\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Setup environment</h2>\n<p dir=\"auto\">To renew or rotate sub-keys, follow the same process as generating keys: boot to a secure environment, install required software and disconnect networking.</p>\n<p dir=\"auto\">Connect the offline secret storage device with the master keys and identify the disk label:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ sudo dmesg | tail\nmmc0: new high speed SDHC card at address a001\nmmcblk0: mmc0:a001 SS16G 14.8 GiB (ro)\nmmcblk0: p1 p2\"><pre>$ <span class=\"pl-s1\">sudo dmesg <span class=\"pl-k\">|</span> tail</span>\n<span class=\"pl-c1\">mmc0: new high speed SDHC card at address a001</span>\n<span class=\"pl-c1\">mmcblk0: mmc0:a001 SS16G 14.8 GiB (ro)</span>\n<span class=\"pl-c1\">mmcblk0: p1 p2</span></pre></div>\n<p dir=\"auto\">Decrypt and mount the offline volume:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ sudo cryptsetup luksOpen /dev/mmcblk0p1 secret\nEnter passphrase for /dev/mmcblk0p1:\n\n$ sudo mount /dev/mapper/secret /mnt/encrypted-storage\"><pre>$ <span class=\"pl-s1\">sudo cryptsetup luksOpen /dev/mmcblk0p1 secret</span>\n<span class=\"pl-c1\">Enter passphrase for /dev/mmcblk0p1:</span>\n\n$ <span class=\"pl-s1\">sudo mount /dev/mapper/secret /mnt/encrypted-storage</span></pre></div>\n<p dir=\"auto\">Import the master key and configuration to a temporary working directory. Note that Windows users should import mastersub.gpg:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ export GNUPGHOME=$(mktemp -d -t gnupg_$(date +%Y%m%d%H%M)_XXX)\n\n$ gpg --import /mnt/encrypted-storage/tmp.XXX/mastersub.key\n\n$ cp -v /mnt/encrypted-storage/tmp.XXX/gpg.conf $GNUPGHOME\"><pre>$ <span class=\"pl-s1\"><span class=\"pl-k\">export</span> GNUPGHOME=<span class=\"pl-s\"><span class=\"pl-pds\">$(</span>mktemp -d -t gnupg_<span class=\"pl-s\"><span class=\"pl-pds\">$(</span>date +%Y%m%d%H%M<span class=\"pl-pds\">)</span></span>_XXX<span class=\"pl-pds\">)</span></span></span>\n\n$ <span class=\"pl-s1\">gpg --import /mnt/encrypted-storage/tmp.XXX/mastersub.key</span>\n\n$ <span class=\"pl-s1\">cp -v /mnt/encrypted-storage/tmp.XXX/gpg.conf <span class=\"pl-smi\">$GNUPGHOME</span></span></pre></div>\n<p dir=\"auto\">Edit the master key:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ export KEYID=0xFF3E7D88647EBCDB\n\n$ gpg --expert --edit-key $KEYID\n\nSecret key is available\n[...]\"><pre>$ <span class=\"pl-s1\"><span class=\"pl-k\">export</span> KEYID=0xFF3E7D88647EBCDB</span>\n\n$ <span class=\"pl-s1\">gpg --expert --edit-key <span class=\"pl-smi\">$KEYID</span></span>\n\n<span class=\"pl-c1\">Secret key is available</span>\n<span class=\"pl-c1\">[...]</span></pre></div>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-renewing-sub-keys\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#renewing-sub-keys\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Renewing sub-keys</h2>\n<p dir=\"auto\">Renewing sub-keys is simpler: you do not need to generate new keys, move keys to the YubiKey, or update any SSH public keys linked to the GPG key.  All you need to do is to change the expiry time associated with the public key (which requires access to the master key you just loaded) and then to export that public key and import it on any computer where you wish to use the <strong>GPG</strong> (as distinct from the SSH) key.</p>\n<p dir=\"auto\">To change the expiration date of all sub-keys, start by selecting all keys:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --edit-key $KEYID\n\nSecret key is available.\n\nsec  rsa4096/0xFF3E7D88647EBCDB\n    created: 2017-10-09  expires: never       usage: C\n    trust: ultimate      validity: ultimate\nssb  rsa4096/0xBECFA3C1AE191D15\n    created: 2017-10-09  expires: 2018-10-09  usage: S\nssb  rsa4096/0x5912A795E90DD2CF\n    created: 2017-10-09  expires: 2018-10-09  usage: E\nssb  rsa4096/0x3F29127E79649A3D\n    created: 2017-10-09  expires: 2018-10-09  usage: A\n[ultimate] (1). Dr Duh &lt;doc@duh.to&gt;\n\ngpg&gt; key 1\n\nSecret key is available.\n\nsec  rsa4096/0xFF3E7D88647EBCDB\n     created: 2017-10-09  expires: never       usage: C\n     trust: ultimate      validity: ultimate\nssb* rsa4096/0xBECFA3C1AE191D15\n     created: 2017-10-09  expires: 2018-10-09  usage: S\nssb  rsa4096/0x5912A795E90DD2CF\n     created: 2017-10-09  expires: 2018-10-09  usage: E\nssb  rsa4096/0x3F29127E79649A3D\n     created: 2017-10-09  expires: 2018-10-09  usage: A\n[ultimate] (1). Dr Duh &lt;doc@duh.to&gt;\n\ngpg&gt; key 2\n\nSecret key is available.\n\nsec  rsa4096/0xFF3E7D88647EBCDB\n     created: 2017-10-09  expires: never       usage: C\n     trust: ultimate      validity: ultimate\nssb* rsa4096/0xBECFA3C1AE191D15\n     created: 2017-10-09  expires: 2018-10-09  usage: S\nssb* rsa4096/0x5912A795E90DD2CF\n     created: 2017-10-09  expires: 2018-10-09  usage: E\nssb  rsa4096/0x3F29127E79649A3D\n     created: 2017-10-09  expires: 2018-10-09  usage: A\n[ultimate] (1). Dr Duh &lt;doc@duh.to&gt;\n\ngpg&gt; key 3\n\nSecret key is available.\n\nsec   rsa4096/0xFF3E7D88647EBCDB\n      created: 2017-10-09  expires: never       usage: C\n      trust: ultimate      validity: ultimate\nssb*  rsa4096/0xBECFA3C1AE191D15\n      created: 2017-10-09  expires: 2018-10-09  usage: S\nssb*  rsa4096/0x5912A795E90DD2CF\n      created: 2017-10-09  expires: 2018-10-09  usage: E\nssb*  rsa4096/0x3F29127E79649A3D\n      created: 2017-10-09  expires: 2018-10-09  usage: A\n[ultimate] (1). Dr Duh &lt;doc@duh.to&gt;\"><pre>$ <span class=\"pl-s1\">gpg --edit-key <span class=\"pl-smi\">$KEYID</span></span>\n\n<span class=\"pl-c1\">Secret key is available.</span>\n\n<span class=\"pl-c1\">sec  rsa4096/0xFF3E7D88647EBCDB</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: never       usage: C</span>\n<span class=\"pl-c1\">    trust: ultimate      validity: ultimate</span>\n<span class=\"pl-c1\">ssb  rsa4096/0xBECFA3C1AE191D15</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: 2018-10-09  usage: S</span>\n<span class=\"pl-c1\">ssb  rsa4096/0x5912A795E90DD2CF</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: 2018-10-09  usage: E</span>\n<span class=\"pl-c1\">ssb  rsa4096/0x3F29127E79649A3D</span>\n<span class=\"pl-c1\">    created: 2017-10-09  expires: 2018-10-09  usage: A</span>\n<span class=\"pl-c1\">[ultimate] (1). Dr Duh &lt;doc@duh.to&gt;</span>\n\n<span class=\"pl-c1\">gpg&gt; key 1</span>\n\n<span class=\"pl-c1\">Secret key is available.</span>\n\n<span class=\"pl-c1\">sec  rsa4096/0xFF3E7D88647EBCDB</span>\n<span class=\"pl-c1\">     created: 2017-10-09  expires: never       usage: C</span>\n<span class=\"pl-c1\">     trust: ultimate      validity: ultimate</span>\n<span class=\"pl-c1\">ssb* rsa4096/0xBECFA3C1AE191D15</span>\n<span class=\"pl-c1\">     created: 2017-10-09  expires: 2018-10-09  usage: S</span>\n<span class=\"pl-c1\">ssb  rsa4096/0x5912A795E90DD2CF</span>\n<span class=\"pl-c1\">     created: 2017-10-09  expires: 2018-10-09  usage: E</span>\n<span class=\"pl-c1\">ssb  rsa4096/0x3F29127E79649A3D</span>\n<span class=\"pl-c1\">     created: 2017-10-09  expires: 2018-10-09  usage: A</span>\n<span class=\"pl-c1\">[ultimate] (1). Dr Duh &lt;doc@duh.to&gt;</span>\n\n<span class=\"pl-c1\">gpg&gt; key 2</span>\n\n<span class=\"pl-c1\">Secret key is available.</span>\n\n<span class=\"pl-c1\">sec  rsa4096/0xFF3E7D88647EBCDB</span>\n<span class=\"pl-c1\">     created: 2017-10-09  expires: never       usage: C</span>\n<span class=\"pl-c1\">     trust: ultimate      validity: ultimate</span>\n<span class=\"pl-c1\">ssb* rsa4096/0xBECFA3C1AE191D15</span>\n<span class=\"pl-c1\">     created: 2017-10-09  expires: 2018-10-09  usage: S</span>\n<span class=\"pl-c1\">ssb* rsa4096/0x5912A795E90DD2CF</span>\n<span class=\"pl-c1\">     created: 2017-10-09  expires: 2018-10-09  usage: E</span>\n<span class=\"pl-c1\">ssb  rsa4096/0x3F29127E79649A3D</span>\n<span class=\"pl-c1\">     created: 2017-10-09  expires: 2018-10-09  usage: A</span>\n<span class=\"pl-c1\">[ultimate] (1). Dr Duh &lt;doc@duh.to&gt;</span>\n\n<span class=\"pl-c1\">gpg&gt; key 3</span>\n\n<span class=\"pl-c1\">Secret key is available.</span>\n\n<span class=\"pl-c1\">sec   rsa4096/0xFF3E7D88647EBCDB</span>\n<span class=\"pl-c1\">      created: 2017-10-09  expires: never       usage: C</span>\n<span class=\"pl-c1\">      trust: ultimate      validity: ultimate</span>\n<span class=\"pl-c1\">ssb*  rsa4096/0xBECFA3C1AE191D15</span>\n<span class=\"pl-c1\">      created: 2017-10-09  expires: 2018-10-09  usage: S</span>\n<span class=\"pl-c1\">ssb*  rsa4096/0x5912A795E90DD2CF</span>\n<span class=\"pl-c1\">      created: 2017-10-09  expires: 2018-10-09  usage: E</span>\n<span class=\"pl-c1\">ssb*  rsa4096/0x3F29127E79649A3D</span>\n<span class=\"pl-c1\">      created: 2017-10-09  expires: 2018-10-09  usage: A</span>\n<span class=\"pl-c1\">[ultimate] (1). Dr Duh &lt;doc@duh.to&gt;</span></pre></div>\n<p dir=\"auto\">Then, use the <code>expire</code> command to set a new expiration date.  (Despite the name, this will not cause currently valid keys to become expired.)</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"gpg&gt; expire\nChanging expiration time for a subkey.\nPlease specify how long the key should be valid.\n         0 = key does not expire\n      &lt;n&gt;  = key expires in n days\n      &lt;n&gt;w = key expires in n weeks\n      &lt;n&gt;m = key expires in n months\n      &lt;n&gt;y = key expires in n years\nKey is valid for? (0)\"><pre><span class=\"pl-c1\">gpg&gt; expire</span>\n<span class=\"pl-c1\">Changing expiration time for a subkey.</span>\n<span class=\"pl-c1\">Please specify how long the key should be valid.</span>\n<span class=\"pl-c1\">         0 = key does not expire</span>\n<span class=\"pl-c1\">      &lt;n&gt;  = key expires in n days</span>\n<span class=\"pl-c1\">      &lt;n&gt;w = key expires in n weeks</span>\n<span class=\"pl-c1\">      &lt;n&gt;m = key expires in n months</span>\n<span class=\"pl-c1\">      &lt;n&gt;y = key expires in n years</span>\n<span class=\"pl-c1\">Key is valid for? (0)</span></pre></div>\n<p dir=\"auto\">Follow these prompts to set a new expiration date, then <code>save</code> to save your changes.</p>\n<p dir=\"auto\">Next, <a href=\"#export-public-keys\">export the public key</a>:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --armor --export $KEYID &gt; gpg-$KEYID-$(date +%F).asc\"><pre>$ <span class=\"pl-s1\">gpg --armor --export <span class=\"pl-smi\">$KEYID</span> <span class=\"pl-k\">&gt;</span> gpg-<span class=\"pl-smi\">$KEYID</span>-<span class=\"pl-s\"><span class=\"pl-pds\">$(</span>date +%F<span class=\"pl-pds\">)</span></span>.asc</span></pre></div>\n<p dir=\"auto\">Transfer that public key to the computer from which you use your GPG key, and then import it with:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --import gpg-0x*.asc\"><pre>$ <span class=\"pl-s1\">gpg --import gpg-0x<span class=\"pl-k\">*</span>.asc</span></pre></div>\n<p dir=\"auto\">Alternatively, use a public key server (it will update the key if already on the server):</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --send-key $KEYID\"><pre>$ <span class=\"pl-s1\">gpg --send-key <span class=\"pl-smi\">$KEYID</span></span></pre></div>\n<p dir=\"auto\">and import the newly updated key on any computer where you wish to use it (it will update the key if previously imported):</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --recv $KEYID\"><pre>$ <span class=\"pl-s1\">gpg --recv <span class=\"pl-smi\">$KEYID</span></span></pre></div>\n<p dir=\"auto\">This will extend the validity of your GPG key and will allow you to use it for SSH authorization.  Note that you do <em>not</em> need to update the SSH public key located on remote servers.</p>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-rotating-keys-1\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#rotating-keys-1\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Rotating keys</h2>\n<p dir=\"auto\">Rotating keys is more a bit more involved.  First, follow the original steps to generate each sub-key. Previous sub-keys may be kept or deleted from the identity.</p>\n<p dir=\"auto\">Finish by exporting new keys:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --armor --export-secret-keys $KEYID &gt; $GNUPGHOME/mastersub.key\n\n$ gpg --armor --export-secret-subkeys $KEYID &gt; $GNUPGHOME/sub.key\"><pre>$ <span class=\"pl-s1\">gpg --armor --export-secret-keys <span class=\"pl-smi\">$KEYID</span> <span class=\"pl-k\">&gt;</span> <span class=\"pl-smi\">$GNUPGHOME</span>/mastersub.key</span>\n\n$ <span class=\"pl-s1\">gpg --armor --export-secret-subkeys <span class=\"pl-smi\">$KEYID</span> <span class=\"pl-k\">&gt;</span> <span class=\"pl-smi\">$GNUPGHOME</span>/sub.key</span></pre></div>\n<p dir=\"auto\">Copy the <strong>new</strong> temporary working directory to encrypted offline storage, which should still be mounted:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ sudo cp -avi $GNUPGHOME /mnt/encrypted-storage\"><pre>$ <span class=\"pl-s1\">sudo cp -avi <span class=\"pl-smi\">$GNUPGHOME</span> /mnt/encrypted-storage</span></pre></div>\n<p dir=\"auto\">There should now be at least two versions of the master and sub-keys backed up:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ ls /mnt/encrypted-storage\nlost+found  tmp.ykhTOGjR36  tmp.2gyGnyCiHs\"><pre>$ <span class=\"pl-s1\">ls /mnt/encrypted-storage</span>\n<span class=\"pl-c1\">lost+found  tmp.ykhTOGjR36  tmp.2gyGnyCiHs</span></pre></div>\n<p dir=\"auto\">Unmount and close the encrypted volume:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ sudo umount /mnt/encrypted-storage\n\n$ sudo cryptsetup luksClose /dev/mapper/secret\"><pre>$ <span class=\"pl-s1\">sudo umount /mnt/encrypted-storage</span>\n\n$ <span class=\"pl-s1\">sudo cryptsetup luksClose /dev/mapper/secret</span></pre></div>\n<p dir=\"auto\">Export the updated public key:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ sudo mkdir /mnt/public\n\n$ sudo mount /dev/mmcblk0p2 /mnt/public\n\n$ gpg --armor --export $KEYID | sudo tee /mnt/public/$KEYID-$(date +%F).asc\n\n$ sudo umount /mnt/public\"><pre>$ <span class=\"pl-s1\">sudo mkdir /mnt/public</span>\n\n$ <span class=\"pl-s1\">sudo mount /dev/mmcblk0p2 /mnt/public</span>\n\n$ <span class=\"pl-s1\">gpg --armor --export <span class=\"pl-smi\">$KEYID</span> <span class=\"pl-k\">|</span> sudo tee /mnt/public/<span class=\"pl-smi\">$KEYID</span>-<span class=\"pl-s\"><span class=\"pl-pds\">$(</span>date +%F<span class=\"pl-pds\">)</span></span>.asc</span>\n\n$ <span class=\"pl-s1\">sudo umount /mnt/public</span></pre></div>\n<p dir=\"auto\">Disconnect the storage device and follow the original steps to transfer new keys (4, 5 and 6) to the YubiKey, replacing existing ones. Reboot or securely erase the GPG temporary working directory.</p>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-adding-notations\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#adding-notations\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Adding notations</h1>\n<p dir=\"auto\">Notations can be added to user ID(s) and can be used in conjunction with <a href=\"https://keyoxide.org\" rel=\"nofollow\">Keyoxide</a> to create <a href=\"https://keyoxide.org/guides/openpgp-proofs\" rel=\"nofollow\">OpenPGP identity proofs</a>.</p>\n<p dir=\"auto\">Adding notations requires access to the master key so we can follow the setup instructions taken from this <a href=\"#setup-environment\">section</a> of this guide.</p>\n<p dir=\"auto\">Please note that there is no need to connect the Yubikey to the setup environment and that we do not need to generate new keys, move keys to the YubiKey, or update any SSH public keys linked to the GPG key.</p>\n<p dir=\"auto\">After having completed the environment setup, it is possible to follow any of the guides listed under \"Adding proofs\" in the Keyoxide <a href=\"https://keyoxide.org/guides/\" rel=\"nofollow\">\"Guides\"</a> page <strong>up until the notation is saved using the <code>save</code> command</strong>.</p>\n<p dir=\"auto\">At this point the public key can be exported:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --export $KEYID &gt; pubkey.asc\"><pre>$ <span class=\"pl-s1\">gpg --export <span class=\"pl-smi\">$KEYID</span> <span class=\"pl-k\">&gt;</span> pubkey.asc</span></pre></div>\n<p dir=\"auto\">The public key can now be transferred to the computer where the GPG key is used and it is imported with:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --import pubkey.asc\"><pre>$ <span class=\"pl-s1\">gpg --import pubkey.asc</span></pre></div>\n<p dir=\"auto\">N.B.: The <code>showpref</code> command can be issued to ensure that the notions were correctly added.</p>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-ssh\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#ssh\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>SSH</h1>\n<p dir=\"auto\"><strong>Tip</strong> If you want to use a YubiKey for SSH only (and don't really care about PGP/GPG), then <a href=\"https://www.openssh.com/txt/release-8.2\" rel=\"nofollow\">since OpenSSH v8.2</a> you alternatively can simply <code>ssh-keygen -t ed25519-sk</code> (without requiring anything else from this guide!), as explained <a href=\"https://github.com/vorburger/vorburger.ch-Notes/blob/develop/security/ed25519-sk.md\">in this guide</a>. Yubico also recently announced support for resident ssh keys under OpenSSH 8.2+ on their blue \"security key 5 nfc\" as mentioned in their <a href=\"https://www.yubico.com/blog/github-now-supports-ssh-security-keys/\" rel=\"nofollow\">blog post</a>._</p>\n<p dir=\"auto\"><a href=\"https://wiki.archlinux.org/index.php/GnuPG#SSH_agent\" rel=\"nofollow\">gpg-agent</a> supports the OpenSSH ssh-agent protocol (<code>enable-ssh-support</code>), as well as Putty's Pageant on Windows (<code>enable-putty-support</code>). This means it can be used instead of the traditional ssh-agent / pageant. There are some differences from ssh-agent, notably that gpg-agent does not <em>cache</em> keys rather it converts, encrypts and stores them - persistently - as GPG keys and then makes them available to ssh clients. Any existing ssh private keys that you'd like to keep in <code>gpg-agent</code> should be deleted after they've been imported to the GPG agent.</p>\n<p dir=\"auto\">When importing the key to <code>gpg-agent</code>, you'll be prompted for a passphrase to protect that key within GPG's key store - you may want to use the same passphrase as the original's ssh version. GPG can both cache passphrases for a determined period (ref. <code>gpg-agent</code>'s various <code>cache-ttl</code> options), and since version 2.1 can store and fetch passphrases via the macOS keychain. Note than when removing the old private key after importing to <code>gpg-agent</code>, keep the <code>.pub</code> key file around for use in specifying ssh identities (e.g. <code>ssh -i /path/to/identity.pub</code>).</p>\n<p dir=\"auto\">Probably the biggest thing missing from <code>gpg-agent</code>'s ssh agent support is being able to remove keys. <code>ssh-add -d/-D</code> have no effect. Instead, you need to use the <code>gpg-connect-agent</code> utility to lookup a key's keygrip, match that with the desired ssh key fingerprint (as an MD5) and then delete that keygrip. The <a href=\"https://lists.gnupg.org/pipermail/gnupg-users/2016-August/056499.html\" rel=\"nofollow\">gnupg-users mailing list</a> has more information.</p>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-create-configuration\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#create-configuration\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Create configuration</h2>\n<p dir=\"auto\">Create a hardened configuration for gpg-agent by downloading <a href=\"https://github.com/drduh/config/blob/master/gpg-agent.conf\">drduh/config/gpg-agent.conf</a>:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ cd ~/.gnupg\n\n$ wget https://raw.githubusercontent.com/drduh/config/master/gpg-agent.conf\n\n$ grep -ve &quot;^#&quot; gpg-agent.conf\nenable-ssh-support\ndefault-cache-ttl 60\nmax-cache-ttl 120\npinentry-program /usr/bin/pinentry-curses\"><pre>$ <span class=\"pl-s1\"><span class=\"pl-c1\">cd</span> <span class=\"pl-k\">~</span>/.gnupg</span>\n\n$ <span class=\"pl-s1\">wget https://raw.githubusercontent.com/drduh/config/master/gpg-agent.conf</span>\n\n$ <span class=\"pl-s1\">grep -ve <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>^#<span class=\"pl-pds\">\"</span></span> gpg-agent.conf</span>\n<span class=\"pl-c1\">enable-ssh-support</span>\n<span class=\"pl-c1\">default-cache-ttl 60</span>\n<span class=\"pl-c1\">max-cache-ttl 120</span>\n<span class=\"pl-c1\">pinentry-program /usr/bin/pinentry-curses</span></pre></div>\n<p dir=\"auto\"><strong>Important</strong> The <code>cache-ttl</code> options do <strong>NOT</strong> apply when using a YubiKey as a smartcard as the PIN is <a href=\"https://dev.gnupg.org/T3362\" rel=\"nofollow\">cached by the smartcard itself</a>. Therefore, in order to clear the PIN from cache (smartcard equivalent to <code>default-cache-ttl</code> and <code>max-cache-ttl</code>), you need to unplug the YubiKey, or set the <code>forcesig</code> flag when editing the card to be prompted for the PIN each time.</p>\n<p dir=\"auto\"><strong>Tip</strong> Set <code>pinentry-program /usr/bin/pinentry-gnome3</code> for a GUI-based prompt. If the <em>pinentry</em> graphical dialog doesn't show and you get this error: <code>sign_and_send_pubkey: signing failed: agent refused operation</code>, you may need to install the <code>dbus-user-session</code> package and restart the computer for the <code>dbus</code> user session to be fully inherited; this is because behind the scenes, <code>pinentry</code> complains about <code>No $DBUS_SESSION_BUS_ADDRESS found</code>, falls back to <code>curses</code> but doesn't find the expected <code>tty</code>.</p>\n<p dir=\"auto\">On macOS, use <code>brew install pinentry-mac</code> and set the program path to <code>pinentry-program /usr/local/bin/pinentry-mac</code> for Intel Macs, <code>/opt/homebrew/bin/pinentry-mac</code> for ARM/Apple Silicon Macs or <code>pinentry-program /usr/local/MacGPG2/libexec/pinentry-mac.app/Contents/MacOS/pinentry-mac</code> if using MacGPG Suite. For the configuration to take effect you have to run <code>gpgconf --kill gpg-agent</code>.</p>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-replace-agents\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#replace-agents\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Replace agents</h2>\n<p dir=\"auto\">To launch <code>gpg-agent</code> for use by SSH, use the <code>gpg-connect-agent /bye</code> or <code>gpgconf --launch gpg-agent</code> commands.</p>\n<p dir=\"auto\">Add these to the shell <code>rc</code> file:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"export GPG_TTY=&quot;$(tty)&quot;\nexport SSH_AUTH_SOCK=&quot;/run/user/$UID/gnupg/S.gpg-agent.ssh&quot;\ngpg-connect-agent updatestartuptty /bye &gt; /dev/null\"><pre><span class=\"pl-c1\">export GPG_TTY=\"$(tty)\"</span>\n<span class=\"pl-c1\">export SSH_AUTH_SOCK=\"/run/user/$UID/gnupg/S.gpg-agent.ssh\"</span>\n<span class=\"pl-c1\">gpg-connect-agent updatestartuptty /bye &gt; /dev/null</span></pre></div>\n<p dir=\"auto\">On modern systems, <code>gpgconf --list-dirs agent-ssh-socket</code> will automatically set <code>SSH_AUTH_SOCK</code> to the correct value and is better than hard-coding to <code>run/user/$UID/gnupg/S.gpg-agent.ssh</code>, if available:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"export GPG_TTY=&quot;$(tty)&quot;\nexport SSH_AUTH_SOCK=$(gpgconf --list-dirs agent-ssh-socket)\ngpgconf --launch gpg-agent\"><pre><span class=\"pl-c1\">export GPG_TTY=\"$(tty)\"</span>\n<span class=\"pl-c1\">export SSH_AUTH_SOCK=$(gpgconf --list-dirs agent-ssh-socket)</span>\n<span class=\"pl-c1\">gpgconf --launch gpg-agent</span></pre></div>\n<p dir=\"auto\">If you use fish, the correct lines for your <code>config.fish</code> would look like this (consider putting them into the <code>is-interactive</code> block depending on your use case):</p>\n<div class=\"highlight highlight-source-fish notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"set -x GPG_TTY (tty)\nset -x SSH_AUTH_SOCK (gpgconf --list-dirs agent-ssh-socket)\ngpgconf --launch gpg-agent\"><pre><span class=\"pl-c1\">set</span> <span class=\"pl-s\">-x</span> GPG_TTY (<span class=\"pl-c1\">tty</span>)\n<span class=\"pl-c1\">set</span> <span class=\"pl-s\">-x</span> SSH_AUTH_SOCK (gpgconf <span class=\"pl-s\">--list-dirs</span> agent-ssh-socket)\ngpgconf <span class=\"pl-s\">--launch</span> gpg-agent</pre></div>\n<p dir=\"auto\">Note that if you use <code>ForwardAgent</code> for ssh-agent forwarding, <code>SSH_AUTH_SOCK</code> only needs to be set on the <em>local</em> laptop (workstation), where the YubiKey is plugged in.  On the <em>remote</em> server that we SSH into, <code>ssh</code> will automatically set <code>SSH_AUTH_SOCK</code> to something like <code>/tmp/ssh-mXzCzYT2Np/agent.7541</code> when we connect.  We therefore do <strong>NOT</strong> manually set <code>SSH_AUTH_SOCK</code> on the server - doing so would break <a href=\"#remote-machines-ssh-agent-forwarding\">SSH Agent Forwarding</a>.</p>\n<p dir=\"auto\">If you use <code>S.gpg-agent.ssh</code> (see <a href=\"#remote-machines-ssh-agent-forwarding\">SSH Agent Forwarding</a> for more info), <code>SSH_AUTH_SOCK</code> should also be set on the <em>remote</em>. However, <code>GPG_TTY</code> should not be set on the <em>remote</em>, explanation specified in that section.</p>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-copy-public-key\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#copy-public-key\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Copy public key</h2>\n<p dir=\"auto\"><strong>Note</strong> It is <strong>not</strong> necessary to import the corresponding GPG public key in order to use SSH.</p>\n<p dir=\"auto\">Copy and paste the output from <code>ssh-add</code> to the server's <code>authorized_keys</code> file:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ ssh-add -L\nssh-rsa AAAAB4NzaC1yc2EAAAADAQABAAACAz[...]zreOKM+HwpkHzcy9DQcVG2Nw== cardno:000605553211\"><pre>$ <span class=\"pl-s1\">ssh-add -L</span>\n<span class=\"pl-c1\">ssh-rsa AAAAB4NzaC1yc2EAAAADAQABAAACAz[...]zreOKM+HwpkHzcy9DQcVG2Nw== cardno:000605553211</span></pre></div>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-optional-save-public-key-for-identity-file-configuration\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#optional-save-public-key-for-identity-file-configuration\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>(Optional) Save public key for identity file configuration</h2>\n<p dir=\"auto\">By default, SSH attempts to use all the identities available via the agent. It's often a good idea to manage exactly which keys SSH will use to connect to a server, for example to separate different roles or <a href=\"https://blog.filippo.io/ssh-whoami-filippo-io/\" rel=\"nofollow\">to avoid being fingerprinted by untrusted ssh servers</a>. To do this you'll need to use the command line argument <code>-i [identity_file]</code> or the <code>IdentityFile</code> and <code>IdentitiesOnly</code> options in <code>.ssh/config</code>.</p>\n<p dir=\"auto\">The argument provided to <code>IdentityFile</code> is traditionally the path to the <em>private</em> key file (for example <code>IdentityFile ~/.ssh/id_rsa</code>). For the YubiKey - indeed, in general for keys stored in an ssh agent - <code>IdentityFile</code> should point to the <em>public</em> key file, <code>ssh</code> will select the appropriate private key from those available via the ssh agent. To prevent <code>ssh</code> from trying all keys in the agent use the <code>IdentitiesOnly yes</code> option along with one or more <code>-i</code> or <code>IdentityFile</code> options for the target host.</p>\n<p dir=\"auto\">To reiterate, with <code>IdentitiesOnly yes</code>, <code>ssh</code> will not automatically enumerate public keys loaded into <code>ssh-agent</code> or <code>gpg-agent</code>. This means <code>publickey</code> authentication will not proceed unless explicitly named by <code>ssh -i [identity_file]</code> or in <code>.ssh/config</code> on a per-host basis.</p>\n<p dir=\"auto\">In the case of YubiKey usage, to extract the public key from the ssh agent:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ ssh-add -L | grep &quot;cardno:000605553211&quot; &gt; ~/.ssh/id_rsa_yubikey.pub\"><pre>$ <span class=\"pl-s1\">ssh-add -L <span class=\"pl-k\">|</span> grep <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>cardno:000605553211<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">&gt;</span> <span class=\"pl-k\">~</span>/.ssh/id_rsa_yubikey.pub</span></pre></div>\n<p dir=\"auto\">Then you can explicitly associate this YubiKey-stored key for used with a host, <code>github.com</code> for example, as follows:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ cat &lt;&lt; EOF &gt;&gt; ~/.ssh/config\nHost github.com\n    IdentitiesOnly yes\n    IdentityFile ~/.ssh/id_rsa_yubikey.pub\nEOF\"><pre>$ <span class=\"pl-s1\">cat <span class=\"pl-s\"><span class=\"pl-k\">&lt;&lt;</span> <span class=\"pl-k\">EOF</span> &gt;&gt; ~/.ssh/config</span></span>\n<span class=\"pl-c1\">Host github.com</span>\n<span class=\"pl-c1\">    IdentitiesOnly yes</span>\n<span class=\"pl-c1\">    IdentityFile ~/.ssh/id_rsa_yubikey.pub</span>\n<span class=\"pl-c1\">EOF</span></pre></div>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-connect-with-public-key-authentication\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#connect-with-public-key-authentication\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Connect with public key authentication</h2>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ ssh git@github.com -vvv\n[...]\ndebug2: key: cardno:000605553211 (0x1234567890),\ndebug1: Authentications that can continue: publickey\ndebug3: start over, passed a different list publickey\ndebug3: preferred gssapi-keyex,gssapi-with-mic,publickey,keyboard-interactive,password\ndebug3: authmethod_lookup publickey\ndebug3: remaining preferred: keyboard-interactive,password\ndebug3: authmethod_is_enabled publickey\ndebug1: Next authentication method: publickey\ndebug1: Offering RSA public key: cardno:000605553211\ndebug3: send_pubkey_test\ndebug2: we sent a publickey packet, wait for reply\ndebug1: Server accepts key: pkalg ssh-rsa blen 535\ndebug2: input_userauth_pk_ok: fp e5:de:a5:74:b1:3e:96:9b:85:46:e7:28:53:b4:82:c3\ndebug3: sign_and_send_pubkey: RSA e5:de:a5:74:b1:3e:96:9b:85:46:e7:28:53:b4:82:c3\ndebug1: Authentication succeeded (publickey).\n[...]\"><pre>$ <span class=\"pl-s1\">ssh git@github.com -vvv</span>\n<span class=\"pl-c1\">[...]</span>\n<span class=\"pl-c1\">debug2: key: cardno:000605553211 (0x1234567890),</span>\n<span class=\"pl-c1\">debug1: Authentications that can continue: publickey</span>\n<span class=\"pl-c1\">debug3: start over, passed a different list publickey</span>\n<span class=\"pl-c1\">debug3: preferred gssapi-keyex,gssapi-with-mic,publickey,keyboard-interactive,password</span>\n<span class=\"pl-c1\">debug3: authmethod_lookup publickey</span>\n<span class=\"pl-c1\">debug3: remaining preferred: keyboard-interactive,password</span>\n<span class=\"pl-c1\">debug3: authmethod_is_enabled publickey</span>\n<span class=\"pl-c1\">debug1: Next authentication method: publickey</span>\n<span class=\"pl-c1\">debug1: Offering RSA public key: cardno:000605553211</span>\n<span class=\"pl-c1\">debug3: send_pubkey_test</span>\n<span class=\"pl-c1\">debug2: we sent a publickey packet, wait for reply</span>\n<span class=\"pl-c1\">debug1: Server accepts key: pkalg ssh-rsa blen 535</span>\n<span class=\"pl-c1\">debug2: input_userauth_pk_ok: fp e5:de:a5:74:b1:3e:96:9b:85:46:e7:28:53:b4:82:c3</span>\n<span class=\"pl-c1\">debug3: sign_and_send_pubkey: RSA e5:de:a5:74:b1:3e:96:9b:85:46:e7:28:53:b4:82:c3</span>\n<span class=\"pl-c1\">debug1: Authentication succeeded (publickey).</span>\n<span class=\"pl-c1\">[...]</span></pre></div>\n<p dir=\"auto\"><strong>Tip</strong> To make multiple connections or securely transfer many files, consider using the <a href=\"https://en.wikibooks.org/wiki/OpenSSH/Cookbook/Multiplexing\" rel=\"nofollow\">ControlMaster</a> ssh option. Also see <a href=\"https://github.com/drduh/config/blob/master/ssh_config\">drduh/config/ssh_config</a>.</p>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-import-ssh-keys\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#import-ssh-keys\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Import SSH keys</h2>\n<p dir=\"auto\">If there are existing SSH keys that you wish to make available via <code>gpg-agent</code>, you'll need to import them. You should then remove the original private keys. When importing the key, <code>gpg-agent</code> uses the key's filename as the key's label; this makes it easier to follow where the key originated from. In this example, we're starting with just the YubiKey's key in place and importing <code>~/.ssh/id_rsa</code>:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ ssh-add -l\n4096 SHA256:... cardno:00060123456 (RSA)\n\n$ ssh-add ~/.ssh/id_rsa &amp;&amp; rm ~/.ssh/id_rsa\"><pre>$ <span class=\"pl-s1\">ssh-add -l</span>\n<span class=\"pl-c1\">4096 SHA256:... cardno:00060123456 (RSA)</span>\n\n$ <span class=\"pl-s1\">ssh-add <span class=\"pl-k\">~</span>/.ssh/id_rsa <span class=\"pl-k\">&amp;&amp;</span> rm <span class=\"pl-k\">~</span>/.ssh/id_rsa</span></pre></div>\n<p dir=\"auto\">When invoking <code>ssh-add</code>, it will prompt for the SSH key's passphrase if present, then the <code>pinentry</code> program will prompt and confirm for a new passphrase to use to encrypt the converted key within the GPG key store.</p>\n<p dir=\"auto\">The migrated key will be listed in <code>ssh-add -l</code>:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ ssh-add -l\n4096 SHA256:... cardno:00060123456 (RSA)\n2048 SHA256:... /Users/username/.ssh/id_rsa (RSA)\"><pre>$ <span class=\"pl-s1\">ssh-add -l</span>\n<span class=\"pl-c1\">4096 SHA256:... cardno:00060123456 (RSA)</span>\n<span class=\"pl-c1\">2048 SHA256:... /Users/username/.ssh/id_rsa (RSA)</span></pre></div>\n<p dir=\"auto\">Or to show the keys with MD5 fingerprints, as used by <code>gpg-connect-agent</code>'s <code>KEYINFO</code> and <code>DELETE_KEY</code> commands:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ ssh-add -E md5 -l\n4096 MD5:... cardno:00060123456 (RSA)\n2048 MD5:... /Users/username/.ssh/id_rsa (RSA)\"><pre>$ <span class=\"pl-s1\">ssh-add -E md5 -l</span>\n<span class=\"pl-c1\">4096 MD5:... cardno:00060123456 (RSA)</span>\n<span class=\"pl-c1\">2048 MD5:... /Users/username/.ssh/id_rsa (RSA)</span></pre></div>\n<p dir=\"auto\">When using the key <code>pinentry</code> will be invoked to request the key's passphrase. The passphrase will be cached for up to 10 minutes idle time between uses, to a maximum of 2 hours.</p>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-remote-machines-ssh-agent-forwarding\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#remote-machines-ssh-agent-forwarding\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Remote Machines (SSH Agent Forwarding)</h2>\n<p dir=\"auto\"><strong>Note</strong> SSH Agent Forwarding can <a href=\"https://matrix.org/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#ssh-agent-forwarding-should-be-disabled\" rel=\"nofollow\">add additional risk</a> - proceed with caution!</p>\n<p dir=\"auto\">There are two methods for ssh-agent forwarding, one is provided by OpenSSH and the other is provided by GnuPG.</p>\n<p dir=\"auto\">The latter one may be more insecure as raw socket is just forwarded (not like <code>S.gpg-agent.extra</code> with only limited functionality; if <code>ForwardAgent</code> implemented by OpenSSH is just forwarding the raw socket, then they are insecure to the same degree). But for the latter one, one convenience is that one may forward once and use this agent everywhere in the remote. So again, proceed with caution!</p>\n<p dir=\"auto\">For example, <code>tmux</code> does not have some environment variables like <code>$SSH_AUTH_SOCK</code> when you ssh into remote and attach an old <code>tmux</code> session. In this case if you use <code>ForwardAgent</code>, you need to find the socket manually and <code>export SSH_AUTH_SOCK=/tmp/ssh-agent-xxx/xxxx.socket</code> for each shell. But with <code>S.gpg-agent.ssh</code> in fixed place, one can just use it as ssh-agent in their shell rc file.</p>\n<h3 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-use-ssh-agent\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#use-ssh-agent\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Use ssh-agent</h3>\n<p dir=\"auto\">In the above steps, you have successfully configured a local ssh-agent.</p>\n<p dir=\"auto\">You should now be able to use <code>ssh -A remote</code> on the <em>local</em> machine to log into <em>remote</em>, and should then be able to use YubiKey as if it were connected to the remote machine. For example, using e.g. <code>ssh-add -l</code> on that remote machine should show the public key from the YubiKey (note <code>cardno:</code>).  (If you don't want to have to remember to use <code>ssh -A</code>, you can use <code>ForwardAgent yes</code> in <code>~/.ssh/config</code>.  As a security best practice, always use <code>ForwardAgent yes</code> only for a single <code>Hostname</code>, never for all servers.)</p>\n<h3 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-use-sgpg-agentssh\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#use-sgpg-agentssh\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Use S.gpg-agent.ssh</h3>\n<p dir=\"auto\">First you need to go through <a href=\"#remote-machines-gpg-agent-forwarding\">Remote Machines (GPG Agent Forwarding)</a>, know the conditions for gpg-agent forwarding and know the location of <code>S.gpg-agent.ssh</code> on both the local and the remote.</p>\n<p dir=\"auto\">You may use the command:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpgconf --list-dirs agent-ssh-socket\"><pre>$ <span class=\"pl-s1\">gpgconf --list-dirs agent-ssh-socket</span></pre></div>\n<p dir=\"auto\">Then in your <code>.ssh/config</code> add one sentence for that remote</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Host\n  Hostname remote-host.tld\n  StreamLocalBindUnlink yes\n  RemoteForward /run/user/1000/gnupg/S.gpg-agent.ssh /run/user/1000/gnupg/S.gpg-agent.ssh\n  # RemoteForward [remote socket] [local socket]\n  # Note that ForwardAgent is not wanted here!\"><pre class=\"notranslate\"><code>Host\n  Hostname remote-host.tld\n  StreamLocalBindUnlink yes\n  RemoteForward /run/user/1000/gnupg/S.gpg-agent.ssh /run/user/1000/gnupg/S.gpg-agent.ssh\n  # RemoteForward [remote socket] [local socket]\n  # Note that ForwardAgent is not wanted here!\n</code></pre></div>\n<p dir=\"auto\">After successfully ssh into the remote, you should check that you have <code>/run/user/1000/gnupg/S.gpg-agent.ssh</code> lying there.</p>\n<p dir=\"auto\">Then in the <em>remote</em> you can type in command line or configure in the shell rc file with:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"export SSH_AUTH_SOCK=&quot;/run/user/$UID/gnupg/S.gpg-agent.ssh&quot;\"><pre><span class=\"pl-c1\">export SSH_AUTH_SOCK=\"/run/user/$UID/gnupg/S.gpg-agent.ssh\"</span></pre></div>\n<p dir=\"auto\">After typing or sourcing your shell rc file, with <code>ssh-add -l</code> you should find your ssh public key now.</p>\n<p dir=\"auto\"><strong>Note</strong> In this process no gpg-agent in the remote is involved, hence <code>gpg-agent.conf</code> in the remote is of no use. Also pinentry is invoked locally.</p>\n<h3 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-chained-ssh-agent-forwarding\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#chained-ssh-agent-forwarding\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Chained SSH Agent Forwarding</h3>\n<p dir=\"auto\">If you use <code>ssh-agent</code> provided by OpenSSH and want to forward it into a <em>third</em> box, you can just <code>ssh -A third</code> on the <em>remote</em>.</p>\n<p dir=\"auto\">Meanwhile, if you use <code>S.gpg-agent.ssh</code>, assume you have gone through the steps above and have <code>S.gpg-agent.ssh</code> on the <em>remote</em>, and you would like to forward this agent into a <em>third</em> box, first you may need to configure <code>sshd_config</code> and <code>SSH_AUTH_SOCK</code> of <em>third</em> in the same way as <em>remote</em>, then in the ssh config of <em>remote</em>, add the following lines</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Host third\n  Hostname third-host.tld\n  StreamLocalBindUnlink yes\n  RemoteForward /run/user/1000/gnupg/S.gpg-agent.ssh /run/user/1000/gnupg/S.gpg-agent.ssh\n  # RemoteForward [remote socket] [local socket]\n  # Note that ForwardAgent is not wanted here!\"><pre><span class=\"pl-c1\">Host third</span>\n<span class=\"pl-c1\">  Hostname third-host.tld</span>\n<span class=\"pl-c1\">  StreamLocalBindUnlink yes</span>\n<span class=\"pl-c1\">  RemoteForward /run/user/1000/gnupg/S.gpg-agent.ssh /run/user/1000/gnupg/S.gpg-agent.ssh</span>\n<span class=\"pl-c1\">  # RemoteForward [remote socket] [local socket]</span>\n<span class=\"pl-c1\">  # Note that ForwardAgent is not wanted here!</span></pre></div>\n<p dir=\"auto\">You should change the path according to <code>gpgconf --list-dirs agent-ssh-socket</code> on <em>remote</em> and <em>third</em>.</p>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-github\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#github\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>GitHub</h2>\n<p dir=\"auto\">You can use YubiKey to sign GitHub commits and tags. It can also be used for GitHub SSH authentication, allowing you to push, pull, and commit without a password.</p>\n<p dir=\"auto\">Login to GitHub and upload SSH and PGP public keys in Settings.</p>\n<p dir=\"auto\">To configure a signing key:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"&gt; git config --global user.signingkey $KEYID\"><pre class=\"notranslate\"><code>&gt; git config --global user.signingkey $KEYID\n</code></pre></div>\n<p dir=\"auto\">Make sure the user.email option matches the email address associated with the PGP identity.</p>\n<p dir=\"auto\">Now, to sign commits or tags simply use the <code>-S</code> option. GPG will automatically query YubiKey and prompt you for a PIN.</p>\n<p dir=\"auto\">To authenticate:</p>\n<p dir=\"auto\"><strong>Windows</strong></p>\n<p dir=\"auto\">Run the following commands:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"git config --global core.sshcommand &quot;plink -agent&quot;\n\ngit config --global gpg.program 'C:\\Program Files (x86)\\GnuPG\\bin\\gpg.exe'\"><pre><span class=\"pl-c1\">git config --global core.sshcommand \"plink -agent\"</span>\n\n<span class=\"pl-c1\">git config --global gpg.program 'C:\\Program Files (x86)\\GnuPG\\bin\\gpg.exe'</span></pre></div>\n<p dir=\"auto\">You can then change the repository URL to <code>git@github.com:USERNAME/repository</code> and any authenticated commands will be authorized by YubiKey.</p>\n<p dir=\"auto\"><strong>Note</strong> If you encounter the error <code>gpg: signing failed: No secret key</code> - run <code>gpg --card-status</code> with YubiKey plugged in and try the git command again.</p>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-openbsd-1\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#openbsd-1\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>OpenBSD</h2>\n<p dir=\"auto\">Install and enable tools for use with PC/SC drivers, cards, readers, then reboot to recognize YubiKey:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ doas pkg_add pcsc-tools\n\n$ doas rcctl enable pcscd\n\n$ doas reboot\"><pre>$ <span class=\"pl-s1\">doas pkg_add pcsc-tools</span>\n\n$ <span class=\"pl-s1\">doas rcctl <span class=\"pl-c1\">enable</span> pcscd</span>\n\n$ <span class=\"pl-s1\">doas reboot</span></pre></div>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-windows-1\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#windows-1\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Windows</h2>\n<p dir=\"auto\">Windows can already have some virtual smartcard readers installed, like the one provided for Windows Hello. To ensure your YubiKey is the correct one used by scdaemon, you should add it to its configuration. You will need your device's full name. To find your device's full name, plug in your YubiKey and open PowerShell to run the following command:</p>\n<div class=\"highlight highlight-source-powershell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"PS C:\\WINDOWS\\system32&gt; Get-PnpDevice -Class SoftwareDevice | Where-Object {$_.FriendlyName -like &quot;*YubiKey*&quot;} | Select-Object -ExpandProperty FriendlyName\nYubico YubiKey OTP+FIDO+CCID 0\"><pre>PS C:\\WINDOWS\\system3<span class=\"pl-k\">2&gt;</span> <span class=\"pl-c1\">Get-PnpDevice</span> <span class=\"pl-k\">-</span>Class SoftwareDevice <span class=\"pl-k\">|</span> <span class=\"pl-c1\">Where-Object</span> {<span class=\"pl-c1\">$_<span class=\"pl-smi\">.FriendlyName</span></span> <span class=\"pl-k\">-like</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>*YubiKey*<span class=\"pl-pds\">\"</span></span>} <span class=\"pl-k\">|</span> <span class=\"pl-c1\">Select-Object</span> <span class=\"pl-k\">-</span>ExpandProperty FriendlyName\nYubico YubiKey OTP<span class=\"pl-k\">+</span>FIDO<span class=\"pl-k\">+</span>CCID <span class=\"pl-c1\">0</span></pre></div>\n<p dir=\"auto\">The name slightly differs according to the model. Thanks to <a href=\"https://www.hanselman.com/blog/HowToSetupSignedGitCommitsWithAYubiKeyNEOAndGPGAndKeybaseOnWindows.aspx\" rel=\"nofollow\">Scott Hanselman</a> for sharing this information.</p>\n<ul dir=\"auto\">\n<li>Create or edit <code>%APPDATA%/gnupg/scdaemon.conf</code> to add:</li>\n</ul>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"reader-port &lt;your yubikey device's full name, e.g. Yubico YubiKey OTP+FIDO+CCID 0&gt;\"><pre class=\"notranslate\"><code>reader-port &lt;your yubikey device's full name, e.g. Yubico YubiKey OTP+FIDO+CCID 0&gt;\n</code></pre></div>\n<ul dir=\"auto\">\n<li>Create or edit <code>%APPDATA%/gnupg/gpg-agent.conf</code> to add:</li>\n</ul>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"enable-ssh-support\nenable-putty-support\"><pre class=\"notranslate\"><code>enable-ssh-support\nenable-putty-support\n</code></pre></div>\n<ul dir=\"auto\">\n<li>Open a command console, restart the agent:</li>\n</ul>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"&gt; gpg-connect-agent killagent /bye\n&gt; gpg-connect-agent /bye\"><pre class=\"notranslate\"><code>&gt; gpg-connect-agent killagent /bye\n&gt; gpg-connect-agent /bye\n</code></pre></div>\n<ul dir=\"auto\">\n<li>Enter <code>&gt; gpg --card-status</code> to see YubiKey details.</li>\n<li>Import the <a href=\"#export-public-key\">public key</a>: <code>&gt; gpg --import &lt;path to public key file&gt;</code></li>\n<li><a href=\"#trust-master-key\">Trust the master key</a></li>\n<li>Retrieve the public key id: <code>&gt; gpg --list-public-keys</code></li>\n<li>Export the SSH key from GPG: <code>&gt; gpg --export-ssh-key &lt;public key id&gt;</code></li>\n</ul>\n<p dir=\"auto\">Copy this key to a file for later use. It represents the public SSH key corresponding to the secret key on the YubiKey. You can upload this key to any server you wish to SSH into.</p>\n<p dir=\"auto\">Create a shortcut that points to <code>gpg-connect-agent /bye</code> and place it in the startup folder <code>shell:startup</code> to make sure the agent starts after a system shutdown. Modify the shortcut properties so it starts in a \"Minimized\" window, to avoid unnecessary noise at startup.</p>\n<p dir=\"auto\">Now you can use PuTTY for public key SSH authentication. When the server asks for public key verification, PuTTY will forward the request to GPG, which will prompt you for a PIN and authorize the login using YubiKey.</p>\n<h3 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-wsl\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#wsl\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>WSL</h3>\n<p dir=\"auto\">The goal here is to make the SSH client inside WSL work together with the Windows agent you are using (gpg-agent.exe in our case). Here is what we are going to achieve:\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"/drduh/YubiKey-Guide/blob/master/media/schema_gpg.png\"><img src=\"/drduh/YubiKey-Guide/raw/master/media/schema_gpg.png\" alt=\"WSL agent architecture\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\"><strong>Note</strong> this works only for SSH agent forwarding. Real GPG forwarding (encryption/decryption) is actually not supported. See <a href=\"https://github.com/vuori/weasel-pageant\">weasel-pageant</a> for further information or consider using <a href=\"https://github.com/BlackReloaded/wsl2-ssh-pageant\">wsl2-ssh-pageant</a> which supports both SSH and GPG agent forwarding.</p>\n<h4 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-use-ssh-agent-or-use-sweasel-pageant\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#use-ssh-agent-or-use-sweasel-pageant\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Use ssh-agent or use S.weasel-pageant</h4>\n<p dir=\"auto\">One way to forward is just <code>ssh -A</code> (still need to eval weasel to setup local ssh-agent), and only relies on OpenSSH. In this track, <code>ForwardAgent</code> and <code>AllowAgentForwarding</code> in ssh/sshd config may be involved; However, if you use the other way (gpg ssh socket forwarding), you should not enable <code>ForwardAgent</code> in ssh config. See <a href=\"#remote-machines-ssh-agent-forwarding\">SSH Agent Forwarding</a> for more info.</p>\n<p dir=\"auto\">Another way is to forward the gpg ssh socket, as described below.</p>\n<h4 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-prerequisites\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#prerequisites\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Prerequisites</h4>\n<ul dir=\"auto\">\n<li>Ubuntu 16.04 or newer for WSL</li>\n<li>Kleopatra</li>\n<li><a href=\"#windows\">Windows configuration</a></li>\n</ul>\n<h4 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-wsl-configuration\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#wsl-configuration\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>WSL configuration</h4>\n<p dir=\"auto\">Download or clone <a href=\"https://github.com/vuori/weasel-pageant\">weasel-pageant</a>.</p>\n<p dir=\"auto\">Add <code>eval $(/mnt/c/&lt;path of extraction&gt;/weasel-pageant -r -a /tmp/S.weasel-pageant)</code> to shell rc file. Use a named socket here so it can be used in the <code>RemoteForward</code> directive of <code>~/.ssh/config</code>. Source it with <code>source ~/.bashrc</code>.</p>\n<p dir=\"auto\">Display the SSH key with <code>$ ssh-add -l</code></p>\n<p dir=\"auto\">Edit <code>~/.ssh/config</code> to add the following for each host you want to use agent forwarding:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"RemoteForward &lt;remote SSH socket path&gt; /tmp/S.weasel-pageant\"><pre class=\"notranslate\"><code>RemoteForward &lt;remote SSH socket path&gt; /tmp/S.weasel-pageant\n</code></pre></div>\n<p dir=\"auto\"><strong>Note</strong> The remote SSH socket path can be found with <code>gpgconf --list-dirs agent-ssh-socket</code></p>\n<h4 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-remote-host-configuration\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#remote-host-configuration\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Remote host configuration</h4>\n<p dir=\"auto\">You may have to add the following to the shell rc file.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"export SSH_AUTH_SOCK=$(gpgconf --list-dirs agent-ssh-socket)\"><pre class=\"notranslate\"><code>export SSH_AUTH_SOCK=$(gpgconf --list-dirs agent-ssh-socket)\n</code></pre></div>\n<p dir=\"auto\">Add the following to <code>/etc/ssh/sshd_config</code>:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"StreamLocalBindUnlink yes\"><pre class=\"notranslate\"><code>StreamLocalBindUnlink yes\n</code></pre></div>\n<p dir=\"auto\">And reload the SSH daemon (e.g., <code>sudo service sshd reload</code>).</p>\n<p dir=\"auto\">Unplug YubiKey, disconnect or reboot. Log back into Windows, open a WSL console and enter <code>ssh-add -l</code> - you should see nothing.</p>\n<p dir=\"auto\">Plug in YubiKey, enter the same command to display the ssh key.</p>\n<p dir=\"auto\">Log into the remote host, you should have the pinentry dialog asking for the YubiKey pin.</p>\n<p dir=\"auto\">On the remote host, type <code>ssh-add -l</code> - if you see the ssh key, that means forwarding works!</p>\n<p dir=\"auto\"><strong>Note</strong> Agent forwarding may be chained through multiple hosts - just follow the same <a href=\"#remote-host-configuration\">protocol</a> to configure each host. You may also read this part on <a href=\"#chained-ssh-agent-forwarding\">chained ssh agent forwarding</a>.</p>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-macos-1\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#macos-1\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>macOS</h2>\n<p dir=\"auto\">To use gui applications on macOS, <a href=\"https://jms1.net/yubikey/make-ssh-use-gpg-agent.md\" rel=\"nofollow\">a little bit more setup is needed</a>.</p>\n<p dir=\"auto\">Create <code>$HOME/Library/LaunchAgents/gnupg.gpg-agent.plist</code> with the following contents:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot;\n  &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;\n&lt;plist version=&quot;1.0&quot;&gt;\n    &lt;dict&gt;\n        &lt;key&gt;Label&lt;/key&gt;\n        &lt;string&gt;gnupg.gpg-agent&lt;/string&gt;\n        &lt;key&gt;RunAtLoad&lt;/key&gt;\n        &lt;true/&gt;\n        &lt;key&gt;KeepAlive&lt;/key&gt;\n        &lt;false/&gt;\n        &lt;key&gt;ProgramArguments&lt;/key&gt;\n        &lt;array&gt;\n            &lt;string&gt;/usr/local/MacGPG2/bin/gpg-connect-agent&lt;/string&gt;\n            &lt;string&gt;/bye&lt;/string&gt;\n        &lt;/array&gt;\n    &lt;/dict&gt;\n&lt;/plist&gt;\"><pre class=\"notranslate\"><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\"\n  \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"&gt;\n&lt;plist version=\"1.0\"&gt;\n    &lt;dict&gt;\n        &lt;key&gt;Label&lt;/key&gt;\n        &lt;string&gt;gnupg.gpg-agent&lt;/string&gt;\n        &lt;key&gt;RunAtLoad&lt;/key&gt;\n        &lt;true/&gt;\n        &lt;key&gt;KeepAlive&lt;/key&gt;\n        &lt;false/&gt;\n        &lt;key&gt;ProgramArguments&lt;/key&gt;\n        &lt;array&gt;\n            &lt;string&gt;/usr/local/MacGPG2/bin/gpg-connect-agent&lt;/string&gt;\n            &lt;string&gt;/bye&lt;/string&gt;\n        &lt;/array&gt;\n    &lt;/dict&gt;\n&lt;/plist&gt;\n</code></pre></div>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"launchctl load $HOME/Library/LaunchAgents/gnupg.gpg-agent.plist\"><pre><span class=\"pl-c1\">launchctl load $HOME/Library/LaunchAgents/gnupg.gpg-agent.plist</span></pre></div>\n<p dir=\"auto\">Create <code>$HOME/Library/LaunchAgents/gnupg.gpg-agent-symlink.plist</code> with the following contens:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/ProperyList-1.0/dtd&quot;&gt;\n&lt;plist version=&quot;1.0&quot;&gt;\n    &lt;dict&gt;\n        &lt;key&gt;Label&lt;/key&gt;\n        &lt;string&gt;gnupg.gpg-agent-symlink&lt;/string&gt;\n        &lt;key&gt;ProgramArguments&lt;/key&gt;\n        &lt;array&gt;\n            &lt;string&gt;/bin/sh&lt;/string&gt;\n            &lt;string&gt;-c&lt;/string&gt;\n            &lt;string&gt;/bin/ln -sf $HOME/.gnupg/S.gpg-agent.ssh $SSH_AUTH_SOCK&lt;/string&gt;\n        &lt;/array&gt;\n        &lt;key&gt;RunAtLoad&lt;/key&gt;\n        &lt;true/&gt;\n    &lt;/dict&gt;\n&lt;/plist&gt;\"><pre class=\"notranslate\"><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/ProperyList-1.0/dtd\"&gt;\n&lt;plist version=\"1.0\"&gt;\n    &lt;dict&gt;\n        &lt;key&gt;Label&lt;/key&gt;\n        &lt;string&gt;gnupg.gpg-agent-symlink&lt;/string&gt;\n        &lt;key&gt;ProgramArguments&lt;/key&gt;\n        &lt;array&gt;\n            &lt;string&gt;/bin/sh&lt;/string&gt;\n            &lt;string&gt;-c&lt;/string&gt;\n            &lt;string&gt;/bin/ln -sf $HOME/.gnupg/S.gpg-agent.ssh $SSH_AUTH_SOCK&lt;/string&gt;\n        &lt;/array&gt;\n        &lt;key&gt;RunAtLoad&lt;/key&gt;\n        &lt;true/&gt;\n    &lt;/dict&gt;\n&lt;/plist&gt;\n</code></pre></div>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"launchctl load $HOME/Library/LaunchAgents/gnupg.gpg-agent-symlink.plist\"><pre><span class=\"pl-c1\">launchctl load $HOME/Library/LaunchAgents/gnupg.gpg-agent-symlink.plist</span></pre></div>\n<p dir=\"auto\">You will need to either reboot, or log out and log back in, in order to activate these changes.</p>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-remote-machines-gpg-agent-forwarding\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#remote-machines-gpg-agent-forwarding\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Remote Machines (GPG Agent Forwarding)</h1>\n<p dir=\"auto\">This section is different from ssh-agent forwarding in <a href=\"#ssh\">SSH</a> as gpg-agent forwarding has a broader usage, not only limited to ssh.</p>\n<p dir=\"auto\">To use YubiKey to sign a git commit on a remote host, or signing email/decrypt files on a remote host, configure and use GPG Agent Forwarding. To ssh through another network, especially to push to/pull from GitHub using ssh, see <a href=\"#remote-machines-ssh-agent-forwarding\">Remote Machines (SSH Agent forwarding)</a> for more info.</p>\n<p dir=\"auto\">To do this, you need access to the remote machine and the YubiKey has to be set up on the host machine.</p>\n<p dir=\"auto\">After gpg-agent forwarding, it is nearly the same as if YubiKey was inserted in the remote. Hence configurations except <code>gpg-agent.conf</code> for the remote can be the same as those for the local.</p>\n<p dir=\"auto\"><strong>Important</strong> <code>gpg-agent.conf</code> for the remote is of no use, hence <code>$GPG_TTY</code> is of no use too for the remote. The mechanism is that after forwarding, remote <code>gpg</code> directly communicates with <code>S.gpg-agent</code> without <em>starting</em> <code>gpg-agent</code> on the remote.</p>\n<p dir=\"auto\">On the remote machine, edit <code>/etc/ssh/sshd_config</code> to set <code>StreamLocalBindUnlink yes</code></p>\n<p dir=\"auto\"><strong>Optional</strong> If you do not have root access to the remote machine to edit <code>/etc/ssh/sshd_config</code>, you will need to remove the socket (located at <code>gpgconf --list-dir agent-socket</code>) on the remote machine before forwarding works. For example, <code>rm /run/user/1000/gnupg/S.gpg-agent</code>. Further information can be found on the <a href=\"https://wiki.gnupg.org/AgentForwarding\" rel=\"nofollow\">AgentForwarding GNUPG wiki page</a>.</p>\n<p dir=\"auto\">Import public keys to the remote machine. This can be done by fetching from a keyserver. On the local machine, copy the public keyring to the remote machine:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ scp ~/.gnupg/pubring.kbx remote:~/.gnupg/\"><pre>$ <span class=\"pl-s1\">scp <span class=\"pl-k\">~</span>/.gnupg/pubring.kbx remote:<span class=\"pl-k\">~</span>/.gnupg/</span></pre></div>\n<p dir=\"auto\">On modern distributions, such as Fedora 30, there is typically no need to also set <code>RemoteForward</code> in <code>~/.ssh/config</code> as detailed in the next chapter, because the right thing happens automatically.</p>\n<p dir=\"auto\">If any error happens (or there is no <code>gpg-agent.socket</code> in the remote) for modern distributions, you may go through the configuration steps in the next section.</p>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-steps-for-older-distributions\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#steps-for-older-distributions\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Steps for older distributions</h2>\n<p dir=\"auto\">On the local machine, run:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpgconf --list-dirs agent-extra-socket\"><pre>$ <span class=\"pl-s1\">gpgconf --list-dirs agent-extra-socket</span></pre></div>\n<p dir=\"auto\">This should return a path to agent-extra-socket - <code>/run/user/1000/gnupg/S.gpg-agent.extra</code> - though on older Linux distros (and macOS) it may be <code>/home/&lt;user&gt;/.gnupg/S/gpg-agent.extra</code></p>\n<p dir=\"auto\">Find the agent socket on the <strong>remote</strong> machine:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpgconf --list-dirs agent-socket\"><pre>$ <span class=\"pl-s1\">gpgconf --list-dirs agent-socket</span></pre></div>\n<p dir=\"auto\">This should return a path such as <code>/run/user/1000/gnupg/S.gpg-agent</code></p>\n<p dir=\"auto\">Finally, enable agent forwarding for a given machine by adding the following to the local machine's ssh config file <code>~/.ssh/config</code> (your agent sockets may be different):</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Host\n  Hostname remote-host.tld\n  StreamLocalBindUnlink yes\n  RemoteForward /run/user/1000/gnupg/S.gpg-agent /run/user/1000/gnupg/S.gpg-agent.extra\n  # RemoteForward [remote socket] [local socket]\"><pre class=\"notranslate\"><code>Host\n  Hostname remote-host.tld\n  StreamLocalBindUnlink yes\n  RemoteForward /run/user/1000/gnupg/S.gpg-agent /run/user/1000/gnupg/S.gpg-agent.extra\n  # RemoteForward [remote socket] [local socket]\n</code></pre></div>\n<p dir=\"auto\">If you're still having problems, it may be necessary to edit <code>gpg-agent.conf</code> file on the <em>local</em> machines to add the following information:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"pinentry-program /usr/bin/pinentry-gtk-2\nextra-socket /run/user/1000/gnupg/S.gpg-agent.extra\"><pre class=\"notranslate\"><code>pinentry-program /usr/bin/pinentry-gtk-2\nextra-socket /run/user/1000/gnupg/S.gpg-agent.extra\n</code></pre></div>\n<p dir=\"auto\"><strong>Note</strong> The pinentry program starts on <em>local</em> machine, not remote. Hence when there are needs to enter the pin you need to find the prompt on the local machine.</p>\n<p dir=\"auto\"><strong>Important</strong> Any pinentry program except <code>pinentry-tty</code> or <code>pinentry-curses</code> may be used. This is because local <code>gpg-agent</code> may start headlessly (By systemd without <code>$GPG_TTY</code> set locally telling which tty it is on), thus failed to obtain the pin. Errors on the remote may be misleading saying that there is <em>IO Error</em>. (Yes, internally there is actually an <em>IO Error</em> since it happens when writing to/reading from tty while finding no tty to use, but for end users this is not friendly.)</p>\n<p dir=\"auto\">See <a href=\"https://github.com/drduh/YubiKey-Guide/issues/85\" data-hovercard-type=\"issue\" data-hovercard-url=\"/drduh/YubiKey-Guide/issues/85/hovercard\">Issue #85</a> for more information and troubleshooting.</p>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-chained-gpg-agent-forwarding\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#chained-gpg-agent-forwarding\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Chained GPG Agent Forwarding</h2>\n<p dir=\"auto\">Assume you have gone through the steps above and have <code>S.gpg-agent</code> on the <em>remote</em>, and you would like to forward this agent into a <em>third</em> box, first you may need to configure <code>sshd_config</code> of <em>third</em> in the same way as <em>remote</em>, then in the ssh config of <em>remote</em>, add the following lines:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Host third\n  Hostname third-host.tld\n  StreamLocalBindUnlink yes\n  RemoteForward /run/user/1000/gnupg/S.gpg-agent /run/user/1000/gnupg/S.gpg-agent\n  # RemoteForward [remote socket] [local socket]\"><pre><span class=\"pl-c1\">Host third</span>\n<span class=\"pl-c1\">  Hostname third-host.tld</span>\n<span class=\"pl-c1\">  StreamLocalBindUnlink yes</span>\n<span class=\"pl-c1\">  RemoteForward /run/user/1000/gnupg/S.gpg-agent /run/user/1000/gnupg/S.gpg-agent</span>\n<span class=\"pl-c1\">  # RemoteForward [remote socket] [local socket]</span></pre></div>\n<p dir=\"auto\">You should change the path according to <code>gpgconf --list-dirs agent-socket</code> on <em>remote</em> and <em>third</em>.</p>\n<p dir=\"auto\"><strong>Note</strong> On <em>local</em> you have <code>S.gpg-agent.extra</code> whereas on <em>remote</em> and <em>third</em>, you only have <code>S.gpg-agent</code>.</p>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-using-multiple-keys\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#using-multiple-keys\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Using Multiple Keys</h1>\n<p dir=\"auto\">To use a single identity with multiple YubiKeys - or to replace a lost card with another - issue this command to switch keys:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg-connect-agent &quot;scd serialno&quot; &quot;learn --force&quot; /bye\"><pre>$ <span class=\"pl-s1\">gpg-connect-agent <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>scd serialno<span class=\"pl-pds\">\"</span></span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>learn --force<span class=\"pl-pds\">\"</span></span> /bye</span></pre></div>\n<p dir=\"auto\">Alternatively, use a script to delete the GnuPG shadowed key, where the card serial number is stored (see <a href=\"https://dev.gnupg.org/T2291\" rel=\"nofollow\">GnuPG #T2291</a>):</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ cat &gt;&gt; ~/scripts/remove-keygrips.sh &lt;&lt;EOF\n#!/usr/bin/env bash\n(( $# )) || { echo &quot;Specify a key.&quot; &gt;&amp;2; exit 1; }\nKEYGRIPS=$(gpg --with-keygrip --list-secret-keys &quot;$@&quot; | awk '/Keygrip/ { print $3 }')\nfor keygrip in $KEYGRIPS\ndo\n    rm &quot;$HOME/.gnupg/private-keys-v1.d/$keygrip.key&quot; 2&gt; /dev/null\ndone\n\ngpg --card-status\nEOF\n\n$ chmod +x ~/scripts/remove-keygrips.sh\n\n$ ~/scripts/remove-keygrips.sh $KEYID\"><pre>$ <span class=\"pl-s1\">cat <span class=\"pl-k\">&gt;&gt;</span> <span class=\"pl-k\">~</span>/scripts/remove-keygrips.sh <span class=\"pl-s\"><span class=\"pl-k\">&lt;&lt;</span><span class=\"pl-k\">EOF</span></span></span>\n<span class=\"pl-c1\">#!/usr/bin/env bash</span>\n<span class=\"pl-c1\">(( $# )) || { echo \"Specify a key.\" &gt;&amp;2; exit 1; }</span>\n<span class=\"pl-c1\">KEYGRIPS=$(gpg --with-keygrip --list-secret-keys \"$@\" | awk '/Keygrip/ { print $3 }')</span>\n<span class=\"pl-c1\">for keygrip in $KEYGRIPS</span>\n<span class=\"pl-c1\">do</span>\n<span class=\"pl-c1\">    rm \"$HOME/.gnupg/private-keys-v1.d/$keygrip.key\" 2&gt; /dev/null</span>\n<span class=\"pl-c1\">done</span>\n\n<span class=\"pl-c1\">gpg --card-status</span>\n<span class=\"pl-c1\">EOF</span>\n\n$ <span class=\"pl-s1\">chmod +x <span class=\"pl-k\">~</span>/scripts/remove-keygrips.sh</span>\n\n$ <span class=\"pl-s1\"><span class=\"pl-k\">~</span>/scripts/remove-keygrips.sh <span class=\"pl-smi\">$KEYID</span></span></pre></div>\n<p dir=\"auto\">See discussion in Issues <a href=\"https://github.com/drduh/YubiKey-Guide/issues/19\" data-hovercard-type=\"issue\" data-hovercard-url=\"/drduh/YubiKey-Guide/issues/19/hovercard\">#19</a> and <a href=\"https://github.com/drduh/YubiKey-Guide/issues/112\" data-hovercard-type=\"issue\" data-hovercard-url=\"/drduh/YubiKey-Guide/issues/112/hovercard\">#112</a> for more information and troubleshooting steps.</p>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-adding-an-identity\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#adding-an-identity\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Adding an identity</h1>\n<p dir=\"auto\">You may need to add an identity after you've created, backed up, and moved your keys to your YubiKey. To do so, you'll need to first add the identity to your master key, and then reset your YubiKey and use <code>keytocard</code> to move the subkeys to your card again.</p>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-add-an-identity-to-your-master-key\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#add-an-identity-to-your-master-key\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Add an identity to your master key</h2>\n<p dir=\"auto\">To add another identity to your GPG key, follow the same process as generating keys: boot to a secure environment, install required software and disconnect networking.</p>\n<p dir=\"auto\">Connect the offline secret storage device with the master keys and identify the disk label:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ sudo dmesg | tail\nmmc0: new high speed SDHC card at address a001\nmmcblk0: mmc0:a001 SS16G 14.8 GiB (ro)\nmmcblk0: p1 p2\"><pre>$ <span class=\"pl-s1\">sudo dmesg <span class=\"pl-k\">|</span> tail</span>\n<span class=\"pl-c1\">mmc0: new high speed SDHC card at address a001</span>\n<span class=\"pl-c1\">mmcblk0: mmc0:a001 SS16G 14.8 GiB (ro)</span>\n<span class=\"pl-c1\">mmcblk0: p1 p2</span></pre></div>\n<p dir=\"auto\">Decrypt and mount the offline volume:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ sudo cryptsetup luksOpen /dev/mmcblk0p1 secret\nEnter passphrase for /dev/mmcblk0p1:\n\n$ sudo mount /dev/mapper/secret /mnt/encrypted-storage\"><pre>$ <span class=\"pl-s1\">sudo cryptsetup luksOpen /dev/mmcblk0p1 secret</span>\n<span class=\"pl-c1\">Enter passphrase for /dev/mmcblk0p1:</span>\n\n$ <span class=\"pl-s1\">sudo mount /dev/mapper/secret /mnt/encrypted-storage</span></pre></div>\n<p dir=\"auto\">Restore your backup to a temporary directory:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ export GNUPGHOME=$(mktemp -d -t gnupg_$(date +%Y%m%d%H%M)_XXX)\n\n$ cp -avi /mnt/encrypted-storage/tmp.XXX/* $GNUPGHOME\"><pre>$ <span class=\"pl-s1\"><span class=\"pl-k\">export</span> GNUPGHOME=<span class=\"pl-s\"><span class=\"pl-pds\">$(</span>mktemp -d -t gnupg_<span class=\"pl-s\"><span class=\"pl-pds\">$(</span>date +%Y%m%d%H%M<span class=\"pl-pds\">)</span></span>_XXX<span class=\"pl-pds\">)</span></span></span>\n\n$ <span class=\"pl-s1\">cp -avi /mnt/encrypted-storage/tmp.XXX/<span class=\"pl-k\">*</span> <span class=\"pl-smi\">$GNUPGHOME</span></span></pre></div>\n<p dir=\"auto\">Edit your master key to add your new identity:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ KEYID=Â«your keyIDÂ»\n$ gpg --expert --edit-key $KEYID\n\ngpg&gt; adduid\nReal name: Â«your nameÂ»\nEmail address: Â«user@domain.tldÂ»\nComment: Â«somethingÂ»\nYou selected this USER-ID:\n      &quot;Â«your nameÂ» (Â«somethingÂ») &lt;Â«user@domain.tldÂ»&gt;&quot;\n\nChange (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit? O\n\ngpg&gt; trust\n\nPlease decide how far you trust this user to correctly verify other users' keys\n(by looking at passports, checking fingerprints from different sources, etc.)\n\n  1 = I don't know or won't say\n  2 = I do NOT trust\n  3 = I trust marginally\n  4 = I trust fully\n  5 = I trust ultimately\n  m = back to the main menu\n\nYour decision? 5\nDo you really want to set this key to ultimate trust? (y/N) y\n\ngpg&gt; save\"><pre>$ <span class=\"pl-s1\">KEYID=Â«your keyIDÂ»</span>\n$ <span class=\"pl-s1\">gpg --expert --edit-key <span class=\"pl-smi\">$KEYID</span></span>\n\n<span class=\"pl-c1\">gpg&gt; adduid</span>\n<span class=\"pl-c1\">Real name: Â«your nameÂ»</span>\n<span class=\"pl-c1\">Email address: Â«user@domain.tldÂ»</span>\n<span class=\"pl-c1\">Comment: Â«somethingÂ»</span>\n<span class=\"pl-c1\">You selected this USER-ID:</span>\n<span class=\"pl-c1\">      \"Â«your nameÂ» (Â«somethingÂ») &lt;Â«user@domain.tldÂ»&gt;\"</span>\n\n<span class=\"pl-c1\">Change (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit? O</span>\n\n<span class=\"pl-c1\">gpg&gt; trust</span>\n\n<span class=\"pl-c1\">Please decide how far you trust this user to correctly verify other users' keys</span>\n<span class=\"pl-c1\">(by looking at passports, checking fingerprints from different sources, etc.)</span>\n\n<span class=\"pl-c1\">  1 = I don't know or won't say</span>\n<span class=\"pl-c1\">  2 = I do NOT trust</span>\n<span class=\"pl-c1\">  3 = I trust marginally</span>\n<span class=\"pl-c1\">  4 = I trust fully</span>\n<span class=\"pl-c1\">  5 = I trust ultimately</span>\n<span class=\"pl-c1\">  m = back to the main menu</span>\n\n<span class=\"pl-c1\">Your decision? 5</span>\n<span class=\"pl-c1\">Do you really want to set this key to ultimate trust? (y/N) y</span>\n\n<span class=\"pl-c1\">gpg&gt; save</span></pre></div>\n<p dir=\"auto\">Now, re-export your master and sub keys:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --armor --export-secret-keys $KEYID &gt; $GNUPGHOME/mastersub.key\n\n$ gpg --armor --export-secret-subkeys $KEYID &gt; $GNUPGHOME/sub.key\"><pre>$ <span class=\"pl-s1\">gpg --armor --export-secret-keys <span class=\"pl-smi\">$KEYID</span> <span class=\"pl-k\">&gt;</span> <span class=\"pl-smi\">$GNUPGHOME</span>/mastersub.key</span>\n\n$ <span class=\"pl-s1\">gpg --armor --export-secret-subkeys <span class=\"pl-smi\">$KEYID</span> <span class=\"pl-k\">&gt;</span> <span class=\"pl-smi\">$GNUPGHOME</span>/sub.key</span></pre></div>\n<p dir=\"auto\">And your public key:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --armor --export $KEYID | sudo tee /mnt/public/gpg-$KEYID-$(date +%F).asc\"><pre>$ <span class=\"pl-s1\">gpg --armor --export <span class=\"pl-smi\">$KEYID</span> <span class=\"pl-k\">|</span> sudo tee /mnt/public/gpg-<span class=\"pl-smi\">$KEYID</span>-<span class=\"pl-s\"><span class=\"pl-pds\">$(</span>date +%F<span class=\"pl-pds\">)</span></span>.asc</span></pre></div>\n<p dir=\"auto\">As before, on Windows, note that using any extension other than <code>.gpg</code> or attempting IO redirection to a file will garble the secret key, making it impossible to import it again at a later date:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg -o \\path\\to\\dir\\mastersub.gpg --armor --export-secret-keys $KEYID\n\n$ gpg -o \\path\\to\\dir\\sub.gpg --armor --export-secret-subkeys $KEYID\n\n$ gpg -o \\path\\to\\dir\\pubkey.gpg --armor --export $KEYID\"><pre>$ <span class=\"pl-s1\">gpg -o <span class=\"pl-cce\">\\p</span>ath<span class=\"pl-cce\">\\t</span>o<span class=\"pl-cce\">\\d</span>ir<span class=\"pl-cce\">\\m</span>astersub.gpg --armor --export-secret-keys <span class=\"pl-smi\">$KEYID</span></span>\n\n$ <span class=\"pl-s1\">gpg -o <span class=\"pl-cce\">\\p</span>ath<span class=\"pl-cce\">\\t</span>o<span class=\"pl-cce\">\\d</span>ir<span class=\"pl-cce\">\\s</span>ub.gpg --armor --export-secret-subkeys <span class=\"pl-smi\">$KEYID</span></span>\n\n$ <span class=\"pl-s1\">gpg -o <span class=\"pl-cce\">\\p</span>ath<span class=\"pl-cce\">\\t</span>o<span class=\"pl-cce\">\\d</span>ir<span class=\"pl-cce\">\\p</span>ubkey.gpg --armor --export <span class=\"pl-smi\">$KEYID</span></span></pre></div>\n<p dir=\"auto\">Copy the <strong>new</strong> temporary working directory to encrypted offline storage, which should still be mounted:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ sudo cp -avi $GNUPGHOME /mnt/encrypted-storage\"><pre>$ <span class=\"pl-s1\">sudo cp -avi <span class=\"pl-smi\">$GNUPGHOME</span> /mnt/encrypted-storage</span></pre></div>\n<p dir=\"auto\">There should now be at least two versions of the master and sub-keys backed up:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ ls /mnt/encrypted-storage\nlost+found  tmp.ykhTOGjR36  tmp.2gyGnyCiHs\"><pre>$ <span class=\"pl-s1\">ls /mnt/encrypted-storage</span>\n<span class=\"pl-c1\">lost+found  tmp.ykhTOGjR36  tmp.2gyGnyCiHs</span></pre></div>\n<p dir=\"auto\">Unmount and close the encrypted volume:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ sudo umount /mnt/encrypted-storage\n\n$ sudo cryptsetup luksClose /dev/mapper/secret\"><pre>$ <span class=\"pl-s1\">sudo umount /mnt/encrypted-storage</span>\n\n$ <span class=\"pl-s1\">sudo cryptsetup luksClose /dev/mapper/secret</span></pre></div>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-updating-your-yubikey\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#updating-your-yubikey\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Updating your YubiKey</h2>\n<p dir=\"auto\">Now that your keys have been updated with your new identity, you have to move them onto your YubiKey. To do so, you need to first <a href=\"#reset\">reset</a> the OpenPGP applet on your YubiKey, and then follow the steps to <a href=\"#configure-smartcard\">configure your smartcard</a> again.</p>\n<p dir=\"auto\">Now you can <a href=\"#transfer-keys\">transfer the keys</a> to your YubiKey. Once you've done so, be sure to reboot or securely erase the GPG temporary working directory, and <code>unset GNUPGHOME</code>.</p>\n<p dir=\"auto\">Finally, re-import the public key, as described in the <a href=\"#using-keys\">using keys</a> section.</p>\n<p dir=\"auto\">Run <code>gpg -K</code> to confirm that your new identity is listed.</p>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-require-touch\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#require-touch\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Require touch</h1>\n<p dir=\"auto\"><strong>Note</strong> This is not possible on YubiKey NEO.</p>\n<p dir=\"auto\">By default, YubiKey will perform encryption, signing and authentication operations without requiring any action from the user, after the key is plugged in and first unlocked with the PIN.</p>\n<p dir=\"auto\">To require a touch for each key operation, install <a href=\"https://developers.yubico.com/yubikey-manager/\" rel=\"nofollow\">YubiKey Manager</a> and recall the Admin PIN:</p>\n<p dir=\"auto\"><strong>Note</strong> Older versions of YubiKey Manager use <code>touch</code> instead of <code>set-touch</code> in the following commands.</p>\n<p dir=\"auto\">Authentication:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ ykman openpgp keys set-touch aut on\"><pre>$ <span class=\"pl-s1\">ykman openpgp keys set-touch aut on</span></pre></div>\n<p dir=\"auto\">Signing:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ ykman openpgp keys set-touch sig on\"><pre>$ <span class=\"pl-s1\">ykman openpgp keys set-touch sig on</span></pre></div>\n<p dir=\"auto\">Encryption:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ ykman openpgp keys set-touch dec on\"><pre>$ <span class=\"pl-s1\">ykman openpgp keys set-touch dec on</span></pre></div>\n<p dir=\"auto\"><strong>Note</strong> Versions of YubiKey Manager before 5.1.0 use <code>enc</code> instead of <code>dec</code> for encryption.</p>\n<p dir=\"auto\">Depending on how the YubiKey is going to be used, you may want to look at the policy options for each of these and adjust the above commands accordingly. They can be viewed with the following command:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"$ ykman openpgp keys set-touch -h\nUsage: ykman openpgp keys set-touch [OPTIONS] KEY POLICY\n\n  Set the touch policy for OpenPGP keys.\n\n  The touch policy is used to require user interaction for all operations using the private key on the YubiKey. The touch policy is set\n  individually for each key slot. To see the current touch policy, run the &quot;openpgp info&quot; subcommand.\n\n  Touch policies:\n\n  Off (default)   no touch required\n  On              touch required\n  Fixed           touch required, can't be disabled without deleting the private key\n  Cached          touch required, cached for 15s after use\n  Cached-Fixed    touch required, cached for 15s after use, can't be disabled\n                  without deleting the private key\n\n  KEY     key slot to set (sig, dec, aut or att)\n  POLICY  touch policy to set (on, off, fixed, cached or cached-fixed)\n\nOptions:\n  -a, --admin-pin TEXT  Admin PIN for OpenPGP\n  -f, --force           confirm the action without prompting\n  -h, --help            show this message and exit\"><pre class=\"notranslate\"><code>$ ykman openpgp keys set-touch -h\nUsage: ykman openpgp keys set-touch [OPTIONS] KEY POLICY\n\n  Set the touch policy for OpenPGP keys.\n\n  The touch policy is used to require user interaction for all operations using the private key on the YubiKey. The touch policy is set\n  individually for each key slot. To see the current touch policy, run the \"openpgp info\" subcommand.\n\n  Touch policies:\n\n  Off (default)   no touch required\n  On              touch required\n  Fixed           touch required, can't be disabled without deleting the private key\n  Cached          touch required, cached for 15s after use\n  Cached-Fixed    touch required, cached for 15s after use, can't be disabled\n                  without deleting the private key\n\n  KEY     key slot to set (sig, dec, aut or att)\n  POLICY  touch policy to set (on, off, fixed, cached or cached-fixed)\n\nOptions:\n  -a, --admin-pin TEXT  Admin PIN for OpenPGP\n  -f, --force           confirm the action without prompting\n  -h, --help            show this message and exit\n</code></pre></div>\n<p dir=\"auto\">If the YubiKey is going to be used within an email client that opens and verifies encrypted mail, <code>Cached</code> or <code>Cached-Fixed</code> may be desirable.</p>\n<p dir=\"auto\">YubiKey will blink when it is waiting for a touch. On Linux you can also use <a href=\"https://github.com/maximbaz/yubikey-touch-detector\">yubikey-touch-detector</a> to have an indicator or notification that YubiKey is waiting for a touch.</p>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-email\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#email\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Email</h1>\n<p dir=\"auto\">GPG keys on YubiKey can be used with ease to encrypt and/or sign emails and attachments using <a href=\"https://www.thunderbird.net/\" rel=\"nofollow\">Thunderbird</a>, <a href=\"https://www.enigmail.net\" rel=\"nofollow\">Enigmail</a> and <a href=\"http://www.mutt.org/\" rel=\"nofollow\">Mutt</a>. Thunderbird supports OAuth 2 authentication and can be used with Gmail. See <a href=\"https://ssd.eff.org/en/module/how-use-pgp-linux\" rel=\"nofollow\">this guide</a> from EFF for detailed instructions. Mutt has OAuth 2 support since version 2.0.</p>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-mailvelope\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#mailvelope\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Mailvelope</h2>\n<p dir=\"auto\"><a href=\"https://www.mailvelope.com/en\" rel=\"nofollow\">Mailvelope</a> allows GPG keys on YubiKey to be used with Gmail and others.</p>\n<p dir=\"auto\"><strong>Important</strong> Mailvelope <a href=\"https://github.com/drduh/YubiKey-Guide/issues/178\" data-hovercard-type=\"issue\" data-hovercard-url=\"/drduh/YubiKey-Guide/issues/178/hovercard\">does not work</a> with the <code>throw-keyids</code> option set in <code>gpg.conf</code>.</p>\n<p dir=\"auto\">On macOS, install gpgme using Homebrew:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ brew install gpgme\"><pre>$ <span class=\"pl-s1\">brew install gpgme</span></pre></div>\n<p dir=\"auto\">To allow Chrome to run gpgme, edit <code>~/Library/Application\\ Support/Google/Chrome/NativeMessagingHosts/gpgmejson.json</code> and add:</p>\n<div class=\"highlight highlight-source-json notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{\n    &quot;name&quot;: &quot;gpgmejson&quot;,\n    &quot;description&quot;: &quot;Integration with GnuPG&quot;,\n    &quot;path&quot;: &quot;/usr/local/bin/gpgme-json&quot;,\n    &quot;type&quot;: &quot;stdio&quot;,\n    &quot;allowed_origins&quot;: [\n        &quot;chrome-extension://kajibbejlbohfaggdiogboambcijhkke/&quot;\n    ]\n}\"><pre>{\n    <span class=\"pl-ent\">\"name\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>gpgmejson<span class=\"pl-pds\">\"</span></span>,\n    <span class=\"pl-ent\">\"description\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Integration with GnuPG<span class=\"pl-pds\">\"</span></span>,\n    <span class=\"pl-ent\">\"path\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/usr/local/bin/gpgme-json<span class=\"pl-pds\">\"</span></span>,\n    <span class=\"pl-ent\">\"type\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>stdio<span class=\"pl-pds\">\"</span></span>,\n    <span class=\"pl-ent\">\"allowed_origins\"</span>: [\n        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>chrome-extension://kajibbejlbohfaggdiogboambcijhkke/<span class=\"pl-pds\">\"</span></span>\n    ]\n}</pre></div>\n<p dir=\"auto\">Edit the default path to allow Chrome to find GPG:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ sudo launchctl config user path /usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin\"><pre>$ <span class=\"pl-s1\">sudo launchctl config user path /usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin</span></pre></div>\n<p dir=\"auto\">Finally, install the <a href=\"https://chrome.google.com/webstore/detail/mailvelope/kajibbejlbohfaggdiogboambcijhkke\" rel=\"nofollow\">Mailvelope extension</a> from the Chrome app store.</p>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-mutt\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#mutt\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Mutt</h2>\n<p dir=\"auto\">Mutt has both CLI and TUI interfaces, and the latter provides powerful functions for daily email processing. In addition, PGP can be integrated such that signing/encryption/verifying/decryption can be done without leaving TUI.</p>\n<p dir=\"auto\">To enable GnuPG support, one can just use the config file <code>gpg.rc</code> provided by mutt, usually located at <code>/usr/share/doc/mutt/samples/gpg.rc</code> after installation. One only needs to edit the file on options like <code>pgp_default_key</code>, <code>pgp_sign_as</code> and <code>pgp_autosign</code>. After editting one can <code>source</code> this rcfile in their main <code>muttrc</code> to use it.</p>\n<p dir=\"auto\"><strong>Important</strong> If one uses <code>pinentry-tty</code> as one's pinentry program in <code>gpg-agent.conf</code>, it would mess with one's Mutt TUI, as reported. This is because Mutt TUI uses curses while tty output may harm the format. It is recommended to use <code>pinentry-curses</code> or other graphic pinentry program.</p>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-reset\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#reset\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Reset</h1>\n<p dir=\"auto\">If PIN attempts are exceeded, the card is locked and must be <a href=\"https://developers.yubico.com/ykneo-openpgp/ResetApplet.html\" rel=\"nofollow\">reset</a> and set up again using the encrypted backup.</p>\n<p dir=\"auto\">Copy the following script to a file and run <code>gpg-connect-agent -r $file</code> to lock and terminate the card. Then re-insert YubiKey to reset.</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"/hex\nscd serialno\nscd apdu 00 20 00 81 08 40 40 40 40 40 40 40 40\nscd apdu 00 20 00 81 08 40 40 40 40 40 40 40 40\nscd apdu 00 20 00 81 08 40 40 40 40 40 40 40 40\nscd apdu 00 20 00 81 08 40 40 40 40 40 40 40 40\nscd apdu 00 20 00 83 08 40 40 40 40 40 40 40 40\nscd apdu 00 20 00 83 08 40 40 40 40 40 40 40 40\nscd apdu 00 20 00 83 08 40 40 40 40 40 40 40 40\nscd apdu 00 20 00 83 08 40 40 40 40 40 40 40 40\nscd apdu 00 e6 00 00\nscd apdu 00 44 00 00\n/echo Card has been successfully reset.\"><pre><span class=\"pl-c1\">/hex</span>\n<span class=\"pl-c1\">scd serialno</span>\n<span class=\"pl-c1\">scd apdu 00 20 00 81 08 40 40 40 40 40 40 40 40</span>\n<span class=\"pl-c1\">scd apdu 00 20 00 81 08 40 40 40 40 40 40 40 40</span>\n<span class=\"pl-c1\">scd apdu 00 20 00 81 08 40 40 40 40 40 40 40 40</span>\n<span class=\"pl-c1\">scd apdu 00 20 00 81 08 40 40 40 40 40 40 40 40</span>\n<span class=\"pl-c1\">scd apdu 00 20 00 83 08 40 40 40 40 40 40 40 40</span>\n<span class=\"pl-c1\">scd apdu 00 20 00 83 08 40 40 40 40 40 40 40 40</span>\n<span class=\"pl-c1\">scd apdu 00 20 00 83 08 40 40 40 40 40 40 40 40</span>\n<span class=\"pl-c1\">scd apdu 00 20 00 83 08 40 40 40 40 40 40 40 40</span>\n<span class=\"pl-c1\">scd apdu 00 e6 00 00</span>\n<span class=\"pl-c1\">scd apdu 00 44 00 00</span>\n<span class=\"pl-c1\">/echo Card has been successfully reset.</span></pre></div>\n<p dir=\"auto\">Or use <code>ykman</code> (sometimes in <code>~/.local/bin/</code>):</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ ykman openpgp reset\nWARNING! This will delete all stored OpenPGP keys and data and restore factory settings? [y/N]: y\nResetting OpenPGP data, don't remove your YubiKey...\nSuccess! All data has been cleared and default PINs are set.\nPIN:         123456\nReset code:  NOT SET\nAdmin PIN:   12345678\"><pre>$ <span class=\"pl-s1\">ykman openpgp reset</span>\n<span class=\"pl-c1\">WARNING! This will delete all stored OpenPGP keys and data and restore factory settings? [y/N]: y</span>\n<span class=\"pl-c1\">Resetting OpenPGP data, don't remove your YubiKey...</span>\n<span class=\"pl-c1\">Success! All data has been cleared and default PINs are set.</span>\n<span class=\"pl-c1\">PIN:         123456</span>\n<span class=\"pl-c1\">Reset code:  NOT SET</span>\n<span class=\"pl-c1\">Admin PIN:   12345678</span></pre></div>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-recovery-after-reset\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#recovery-after-reset\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Recovery after reset</h2>\n<p dir=\"auto\">If for whatever reason you need to reinstate your YubiKey from your master key backup (such as the one stored on an encrypted USB described in <a href=\"#backup\">Backup</a>), follow the following steps in <a href=\"#rotating-keys\">Rotating keys</a> to setup your environment, and then follow the steps of again <a href=\"#configure-smartcard\">Configure Smartcard</a>.</p>\n<p dir=\"auto\">Before you unmount your backup, ask yourself if you should make another one just in case.</p>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-notes\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#notes\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Notes</h1>\n<ol dir=\"auto\">\n<li>YubiKey has two configurations: one invoked with a short press, and the other with a long press. By default, the short-press mode is configured for HID OTP - a brief touch will emit an OTP string starting with <code>cccccccc</code>. If you rarely use the OTP mode, you can swap it to the second configuration via the YubiKey Personalization tool. If you <em>never</em> use OTP, you can disable it entirely using the <a href=\"https://developers.yubico.com/yubikey-manager\" rel=\"nofollow\">YubiKey Manager</a> application (note, this not the similarly named older YubiKey NEO Manager). The command to disable OTP with ykman is <code>ykman config usb -d OTP</code>.</li>\n<li>Programming YubiKey for GPG keys still lets you use its other configurations - <a href=\"https://en.wikipedia.org/wiki/Universal_2nd_Factor\" rel=\"nofollow\">U2F</a>, <a href=\"https://www.yubico.com/faq/what-is-a-one-time-password-otp/\" rel=\"nofollow\">OTP</a> and <a href=\"https://www.yubico.com/products/services-software/personalization-tools/static-password/\" rel=\"nofollow\">static password</a> modes, for example.</li>\n<li>Setting an expiry essentially forces you to manage your subkeys and announces to the rest of the world that you are doing so. Setting an expiry on a primary key is ineffective for protecting the key from loss - whoever has the primary key can simply extend its expiry period. Revocation certificates are <a href=\"https://security.stackexchange.com/questions/14718/does-openpgp-key-expiration-add-to-security/79386#79386\" rel=\"nofollow\">better suited</a> for this purpose. It may be appropriate for your use case to set expiry dates on subkeys.</li>\n<li>To switch between two or more identities on different keys - unplug the first key and restart gpg-agent, ssh-agent and pinentry with <code>pkill gpg-agent ; pkill ssh-agent ; pkill pinentry ; eval $(gpg-agent --daemon --enable-ssh-support)</code>, then plug in the other key and run <code>gpg-connect-agent updatestartuptty /bye</code> - then it should be ready for use.</li>\n<li>To use yubikeys on more than one computer with gpg: After the initial setup, import the public keys on the second workstation. Confirm gpg can see the card via <code>gpg --card-status</code>, Trust the public keys you imported ultimately (as above). At this point <code>gpg --list-secret-keys</code> should show your (trusted) key.</li>\n</ol>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-troubleshooting\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#troubleshooting\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Troubleshooting</h1>\n<ul dir=\"auto\">\n<li>\n<p dir=\"auto\">Use <code>man gpg</code> to understand GPG options and command-line flags.</p>\n</li>\n<li>\n<p dir=\"auto\">To get more information on potential errors, restart the <code>gpg-agent</code> process with debug output to the console with <code>pkill gpg-agent; gpg-agent --daemon --no-detach -v -v --debug-level advanced --homedir ~/.gnupg</code>.</p>\n</li>\n<li>\n<p dir=\"auto\">If you encounter problems connecting to YubiKey with GPG - try unplugging and re-inserting YubiKey, and restarting the <code>gpg-agent</code> process.</p>\n</li>\n<li>\n<p dir=\"auto\">If you receive the error, <code>gpg: decryption failed: secret key not available</code> - you likely need to install GnuPG version 2.x. Another possibility is that there is a problem with the PIN, e.g. it is too short or blocked.</p>\n</li>\n<li>\n<p dir=\"auto\">If you receive the error, <code>Yubikey core error: no yubikey present</code> - make sure the YubiKey is inserted correctly. It should blink once when plugged in.</p>\n</li>\n<li>\n<p dir=\"auto\">If you still receive the error, <code>Yubikey core error: no yubikey present</code> - you likely need to install newer versions of yubikey-personalize as outlined in <a href=\"#required-software\">Required software</a>.</p>\n</li>\n<li>\n<p dir=\"auto\">If you receive the error, <code>Yubikey core error: write error</code> - YubiKey is likely locked. Install and run yubikey-personalization-gui to unlock it.</p>\n</li>\n<li>\n<p dir=\"auto\">If you receive the error, <code>Key does not match the card's capability</code> - you likely need to use 2048 bit RSA key sizes.</p>\n</li>\n<li>\n<p dir=\"auto\">If you receive the error, <code>sign_and_send_pubkey: signing failed: agent refused operation</code> - make sure you replaced <code>ssh-agent</code> with <code>gpg-agent</code> as noted above.</p>\n</li>\n<li>\n<p dir=\"auto\">If you still receive the error, <code>sign_and_send_pubkey: signing failed: agent refused operation</code> - <a href=\"https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=835394\" rel=\"nofollow\">run the command</a> <code>gpg-connect-agent updatestartuptty /bye</code></p>\n</li>\n<li>\n<p dir=\"auto\">If you still receive the error, <code>sign_and_send_pubkey: signing failed: agent refused operation</code> - edit <code>~/.gnupg/gpg-agent.conf</code> to set a valid <code>pinentry</code> program path, e.g. <code>pinentry-program /usr/local/bin/pinentry-mac</code> on macOS.</p>\n</li>\n<li>\n<p dir=\"auto\">If you still receive the error, <code>sign_and_send_pubkey: signing failed: agent refused operation</code> - it is a <a href=\"https://bbs.archlinux.org/viewtopic.php?id=274571\" rel=\"nofollow\">known issue</a> that openssh 8.9p1 and higher has issues with YubiKey. Adding <code>KexAlgorithms -sntrup761x25519-sha512@openssh.com</code> to <code>/etc/ssh/ssh_config</code> often resolves the issue.</p>\n</li>\n<li>\n<p dir=\"auto\">If you receive the error, <code>The agent has no identities</code> from <code>ssh-add -L</code>, make sure you have installed and started <code>scdaemon</code>.</p>\n</li>\n<li>\n<p dir=\"auto\">If you receive the error, <code>Error connecting to agent: No such file or directory</code> from <code>ssh-add -L</code>, the UNIX file socket that the agent uses for communication with other processes may not be set up correctly. On Debian, try <code>export SSH_AUTH_SOCK=\"/run/user/$UID/gnupg/S.gpg-agent.ssh\"</code>. Also see that <code>gpgconf --list-dirs agent-ssh-socket</code> is returning single path, to existing <code>S.gpg-agent.ssh</code> socket.</p>\n</li>\n<li>\n<p dir=\"auto\">If you receive the error, <code>Permission denied (publickey)</code>, increase ssh verbosity with the <code>-v</code> flag and ensure the public key from the card is being offered: <code>Offering public key: RSA SHA256:abcdefg... cardno:00060123456</code>. If it is, ensure you are connecting as the right user on the target system, rather than as the user on the local system. Otherwise, be sure <code>IdentitiesOnly</code> is not <a href=\"https://github.com/FiloSottile/whosthere#how-do-i-stop-it\">enabled</a> for this host.</p>\n</li>\n<li>\n<p dir=\"auto\">If SSH authentication still fails - add up to 3 <code>-v</code> flags to the <code>ssh</code> client to increase verbosity.</p>\n</li>\n<li>\n<p dir=\"auto\">If it still fails, it may be useful to stop the background <code>sshd</code> daemon process service on the server (e.g. using <code>sudo systemctl stop sshd</code>) and instead start it in the foreground with extensive debugging output, using <code>/usr/sbin/sshd -eddd</code>. Note that the server will not fork and will only process one connection, therefore has to be re-started after every <code>ssh</code> test.</p>\n</li>\n<li>\n<p dir=\"auto\">If you receive the error, <code>Please insert the card with serial number: *</code> see <a href=\"#using-multiple-keys\">using of multiple keys</a>.</p>\n</li>\n<li>\n<p dir=\"auto\">If you receive the error, <code>There is no assurance this key belongs to the named user</code> or <code>encryption failed: Unusable public key</code> use <code>gpg --edit-key</code> to set <code>trust</code> to <code>5 = I trust ultimately</code>.</p>\n</li>\n<li>\n<p dir=\"auto\">If, when you try the above <code>--edit-key</code> command, you get the error <code>Need the secret key to do this</code> - manually specify trust for the key in <code>~/.gnupg/gpg.conf</code> by using the <code>trust-key [key ID]</code> directive.</p>\n</li>\n<li>\n<p dir=\"auto\">If, when using a previously provisioned YubiKey on a new computer with <code>pass</code>, you see the following error on <code>pass insert</code>, you need to adjust the trust associated with the key. See the note above.</p>\n</li>\n</ul>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"gpg: 0x0000000000000000: There is no assurance this key belongs to the named user\ngpg: [stdin]: encryption failed: Unusable public key\"><pre class=\"notranslate\"><code>gpg: 0x0000000000000000: There is no assurance this key belongs to the named user\ngpg: [stdin]: encryption failed: Unusable public key\n</code></pre></div>\n<ul dir=\"auto\">\n<li>\n<p dir=\"auto\">If you receive the error, <code>gpg: 0x0000000000000000: skipped: Unusable public key</code>, <code>signing failed: Unusable secret key</code>, or <code>encryption failed: Unusable public key</code> the sub-key may be expired and can no longer be used to encrypt nor sign messages. It can still be used to decrypt and authenticate, however.</p>\n</li>\n<li>\n<p dir=\"auto\">If you lost your GPG public key, follow <a href=\"https://www.nicksherlock.com/2021/08/recovering-lost-gpg-public-keys-from-your-yubikey/\" rel=\"nofollow\">this guide</a> to recover it from YubiKey.</p>\n</li>\n<li>\n<p dir=\"auto\">Refer to Yubico article <a href=\"https://support.yubico.com/hc/en-us/articles/360013714479-Troubleshooting-Issues-with-GPG\" rel=\"nofollow\">Troubleshooting Issues with GPG</a> for additional guidance.</p>\n</li>\n<li>\n<p dir=\"auto\">If, when you try the above <code>--card-status</code> command, you get receive the error, <code>gpg: selecting card failed: No such device</code> or <code>gpg: OpenPGP card not available: No such device</code>, it's possible that the latest release of pcscd is now requires polkit rules to operate properly. Create the following file to allow users in the <code>wheel</code> group to use the card. Be sure to restart pcscd when you're done to allow the new rules to take effect.</p>\n</li>\n</ul>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"cat &lt;&lt; EOF &gt;  /etc/polkit-1/rules.d/99-pcscd.rules\npolkit.addRule(function(action, subject) {\n        if (action.id == &quot;org.debian.pcsc-lite.access_card&quot; &amp;&amp;\n                subject.isInGroup(&quot;wheel&quot;)) {\n                return polkit.Result.YES;\n        }\n});\npolkit.addRule(function(action, subject) {\n        if (action.id == &quot;org.debian.pcsc-lite.access_pcsc&quot; &amp;&amp;\n                subject.isInGroup(&quot;wheel&quot;)) {\n                return polkit.Result.YES;\n        }\n});\nEOF\"><pre class=\"notranslate\"><code>cat &lt;&lt; EOF &gt;  /etc/polkit-1/rules.d/99-pcscd.rules\npolkit.addRule(function(action, subject) {\n        if (action.id == \"org.debian.pcsc-lite.access_card\" &amp;&amp;\n                subject.isInGroup(\"wheel\")) {\n                return polkit.Result.YES;\n        }\n});\npolkit.addRule(function(action, subject) {\n        if (action.id == \"org.debian.pcsc-lite.access_pcsc\" &amp;&amp;\n                subject.isInGroup(\"wheel\")) {\n                return polkit.Result.YES;\n        }\n});\nEOF\n</code></pre></div>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-alternatives\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#alternatives\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Alternatives</h1>\n<ul dir=\"auto\">\n<li><a href=\"https://github.com/smlx/piv-agent\"><code>piv-agent</code></a> is an SSH and GPG agent which you can use with your PIV hardware security device (e.g. a Yubikey).</li>\n<li><a href=\"https://www.gnupg.org/documentation/manuals/gnupg/OpenPGP-Key-Management.html\" rel=\"nofollow\"><code>keytotpm</code></a> is an option to use GnuPG with TPM systems.</li>\n</ul>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-create-keys-with-batch\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#create-keys-with-batch\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Create keys with batch</h2>\n<p dir=\"auto\">Keys can also be generated using template files and the <code>batch</code> parameter - see <a href=\"https://www.gnupg.org/documentation/manuals/gnupg/Unattended-GPG-key-generation.html\" rel=\"nofollow\">GnuPG documentation</a>.</p>\n<p dir=\"auto\">Start from the <a href=\"/drduh/YubiKey-Guide/blob/master/contrib/gen-params-rsa4096\">gen-params-rsa4096</a> template. If you're using GnuPG v2.1.7 or newer, you can also use the (<a href=\"/drduh/YubiKey-Guide/blob/master/contrib/gen-params-ed25519\">gen-params-ed25519</a> template. These templates will not set the master key to expire - see <a href=\"#notes\">Note #3</a>.</p>\n<p dir=\"auto\">Generate master key:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --batch --generate-key gen-params-rsa4096\ngpg: Generating a basic OpenPGP key\ngpg: key 0xEA5DE91459B80592 marked as ultimately trusted\ngpg: revocation certificate stored as '/tmp.FLZC0xcM/openpgp-revocs.d/D6F924841F78D62C65ABB9588B461860159FFB7B.rev'\ngpg: done\"><pre>$ <span class=\"pl-s1\">gpg --batch --generate-key gen-params-rsa4096</span>\n<span class=\"pl-c1\">gpg: Generating a basic OpenPGP key</span>\n<span class=\"pl-c1\">gpg: key 0xEA5DE91459B80592 marked as ultimately trusted</span>\n<span class=\"pl-c1\">gpg: revocation certificate stored as '/tmp.FLZC0xcM/openpgp-revocs.d/D6F924841F78D62C65ABB9588B461860159FFB7B.rev'</span>\n<span class=\"pl-c1\">gpg: done</span></pre></div>\n<p dir=\"auto\">Verify the result:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --list-key\ngpg: checking the trustdb\ngpg: marginals needed: 3  completes needed: 1  trust model: pgp\ngpg: depth: 0  valid:   1  signed:   0  trust: 0-, 0q, 0n, 0m, 0f, 1u\n/tmp.FLZC0xcM/pubring.kbx\n-------------------------------\npub   rsa4096/0xFF3E7D88647EBCDB 2021-08-22 [C]\n       Key fingerprint = 011C E16B D45B 27A5 5BA8  776D FF3E 7D88 647E BCDB\nuid                   [ultimate] Dr Duh &lt;doc@duh.to&gt;\"><pre>$ <span class=\"pl-s1\">gpg --list-key</span>\n<span class=\"pl-c1\">gpg: checking the trustdb</span>\n<span class=\"pl-c1\">gpg: marginals needed: 3  completes needed: 1  trust model: pgp</span>\n<span class=\"pl-c1\">gpg: depth: 0  valid:   1  signed:   0  trust: 0-, 0q, 0n, 0m, 0f, 1u</span>\n<span class=\"pl-c1\">/tmp.FLZC0xcM/pubring.kbx</span>\n<span class=\"pl-c1\">-------------------------------</span>\n<span class=\"pl-c1\">pub   rsa4096/0xFF3E7D88647EBCDB 2021-08-22 [C]</span>\n<span class=\"pl-c1\">       Key fingerprint = 011C E16B D45B 27A5 5BA8  776D FF3E 7D88 647E BCDB</span>\n<span class=\"pl-c1\">uid                   [ultimate] Dr Duh &lt;doc@duh.to&gt;</span></pre></div>\n<p dir=\"auto\">The key fingerprint (<code>011C E16B D45B 27A5 5BA8 776D FF3E 7D88 647E BCDB</code>) will be used to create the three subkeys for signing, authentication and encryption.</p>\n<p dir=\"auto\">Now create the three subkeys for signing, authentication and encryption. Use a 1 year expiration for sub-keys - they can be renewed using the offline master key, see <a href=\"#rotating-keys\">rotating keys</a>.</p>\n<p dir=\"auto\">We will use the the quick key manipulation interface of GNUPG (with <code>--quick-add-key</code>), see <a href=\"https://www.gnupg.org/documentation/manuals/gnupg/Unattended-GPG-key-generation.html#Unattended-GPG-key-generation\" rel=\"nofollow\">the documentation</a>.</p>\n<p dir=\"auto\">Create a <a href=\"https://stackoverflow.com/questions/5421107/can-rsa-be-both-used-as-encryption-and-signature/5432623#5432623\" rel=\"nofollow\">signing subkey</a>:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --quick-add-key &quot;011C E16B D45B 27A5 5BA8  776D FF3E 7D88 647E BCDB&quot; \\\n  rsa4096 sign 1y\"><pre>$ <span class=\"pl-s1\">gpg --quick-add-key <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>011C E16B D45B 27A5 5BA8  776D FF3E 7D88 647E BCDB<span class=\"pl-pds\">\"</span></span> \\</span>\n<span class=\"pl-c1\">  rsa4096 sign 1y</span></pre></div>\n<p dir=\"auto\">Now create an <a href=\"https://www.cs.cornell.edu/courses/cs5430/2015sp/notes/rsa_sign_vs_dec.php\" rel=\"nofollow\">encryption subkey</a>:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --quick-add-key &quot;011C E16B D45B 27A5 5BA8  776D FF3E 7D88 647E BCDB&quot; \\\n  rsa4096 encrypt 1y\"><pre>$ <span class=\"pl-s1\">gpg --quick-add-key <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>011C E16B D45B 27A5 5BA8  776D FF3E 7D88 647E BCDB<span class=\"pl-pds\">\"</span></span> \\</span>\n<span class=\"pl-c1\">  rsa4096 encrypt 1y</span></pre></div>\n<p dir=\"auto\">Finally, create an <a href=\"https://superuser.com/questions/390265/what-is-a-gpg-with-authenticate-capability-used-for\" rel=\"nofollow\">authentication subkey</a>:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ gpg --quick-add-key &quot;011C E16B D45B 27A5 5BA8  776D FF3E 7D88 647E BCDB&quot; \\\n  rsa4096 auth 1y\"><pre>$ <span class=\"pl-s1\">gpg --quick-add-key <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>011C E16B D45B 27A5 5BA8  776D FF3E 7D88 647E BCDB<span class=\"pl-pds\">\"</span></span> \\</span>\n<span class=\"pl-c1\">  rsa4096 auth 1y</span></pre></div>\n<p dir=\"auto\">Continue with the Verify section of this guide.</p>\n<h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-links\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#links\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Links</h1>\n<ul dir=\"auto\">\n<li><a href=\"https://gitlab.com/lsasolutions/makegpg\" rel=\"nofollow\">Minimal key management tool written for this guide</a></li>\n<li><a href=\"https://alexcabal.com/creating-the-perfect-gpg-keypair/\" rel=\"nofollow\">https://alexcabal.com/creating-the-perfect-gpg-keypair/</a></li>\n<li><a href=\"https://blog.habets.se/2013/02/GPG-and-SSH-with-Yubikey-NEO\" rel=\"nofollow\">https://blog.habets.se/2013/02/GPG-and-SSH-with-Yubikey-NEO</a></li>\n<li><a href=\"https://blog.josefsson.org/2014/06/23/offline-gnupg-master-key-and-subkeys-on-yubikey-neo-smartcard/\" rel=\"nofollow\">https://blog.josefsson.org/2014/06/23/offline-gnupg-master-key-and-subkeys-on-yubikey-neo-smartcard/</a></li>\n<li><a href=\"https://blog.onefellow.com/post/180065697833/yubikey-forwarding-ssh-keys\" rel=\"nofollow\">https://blog.onefellow.com/post/180065697833/yubikey-forwarding-ssh-keys</a></li>\n<li><a href=\"https://developers.yubico.com/PGP/\" rel=\"nofollow\">https://developers.yubico.com/PGP/</a>\n<ul dir=\"auto\">\n<li><a href=\"https://developers.yubico.com/PGP/Card_edit.html\" rel=\"nofollow\">https://developers.yubico.com/PGP/Card_edit.html</a></li>\n</ul>\n</li>\n<li><a href=\"https://developers.yubico.com/yubikey-personalization/\" rel=\"nofollow\">https://developers.yubico.com/yubikey-personalization/</a></li>\n<li><a href=\"https://evilmartians.com/chronicles/stick-with-security-yubikey-ssh-gnupg-macos\" rel=\"nofollow\">https://evilmartians.com/chronicles/stick-with-security-yubikey-ssh-gnupg-macos</a></li>\n<li><a href=\"https://gist.github.com/ageis/14adc308087859e199912b4c79c4aaa4\">https://gist.github.com/ageis/14adc308087859e199912b4c79c4aaa4</a></li>\n<li><a href=\"https://github.com/herlo/ssh-gpg-smartcard-config\">https://github.com/herlo/ssh-gpg-smartcard-config</a></li>\n<li><a href=\"https://github.com/tomlowenthal/documentation/blob/master/gpg/smartcard-keygen.md\">https://github.com/tomlowenthal/documentation/blob/master/gpg/smartcard-keygen.md</a></li>\n<li><a href=\"https://help.riseup.net/en/security/message-security/openpgp/best-practices\" rel=\"nofollow\">https://help.riseup.net/en/security/message-security/openpgp/best-practices</a></li>\n<li><a href=\"https://jclement.ca/articles/2015/gpg-smartcard/\" rel=\"nofollow\">https://jclement.ca/articles/2015/gpg-smartcard/</a></li>\n<li><a href=\"https://rnorth.org/gpg-and-ssh-with-yubikey-for-mac\" rel=\"nofollow\">https://rnorth.org/gpg-and-ssh-with-yubikey-for-mac</a></li>\n<li><a href=\"https://trmm.net/Yubikey\" rel=\"nofollow\">https://trmm.net/Yubikey</a></li>\n<li><a href=\"https://www.bootc.net/archives/2013/06/09/my-perfect-gnupg-ssh-agent-setup/\" rel=\"nofollow\">https://www.bootc.net/archives/2013/06/09/my-perfect-gnupg-ssh-agent-setup/</a></li>\n<li><a href=\"https://www.esev.com/blog/post/2015-01-pgp-ssh-key-on-yubikey-neo/\" rel=\"nofollow\">https://www.esev.com/blog/post/2015-01-pgp-ssh-key-on-yubikey-neo/</a></li>\n<li><a href=\"https://www.hanselman.com/blog/HowToSetupSignedGitCommitsWithAYubiKeyNEOAndGPGAndKeybaseOnWindows.aspx\" rel=\"nofollow\">https://www.hanselman.com/blog/HowToSetupSignedGitCommitsWithAYubiKeyNEOAndGPGAndKeybaseOnWindows.aspx</a></li>\n<li><a href=\"https://www.void.gr/kargig/blog/2013/12/02/creating-a-new-gpg-key-with-subkeys/\" rel=\"nofollow\">https://www.void.gr/kargig/blog/2013/12/02/creating-a-new-gpg-key-with-subkeys/</a></li>\n<li><a href=\"https://mlohr.com/gpg-agent-forwarding/\" rel=\"nofollow\">https://mlohr.com/gpg-agent-forwarding/</a></li>\n<li><a href=\"https://www.ingby.com/?p=293\" rel=\"nofollow\">https://www.ingby.com/?p=293</a></li>\n<li><a href=\"https://support.yubico.com/support/solutions/articles/15000027139-yubikey-5-2-3-enhancements-to-openpgp-3-4-support\" rel=\"nofollow\">https://support.yubico.com/support/solutions/articles/15000027139-yubikey-5-2-3-enhancements-to-openpgp-3-4-support</a></li>\n<li><a href=\"https://github.com/dhess/nixos-yubikey\">https://github.com/dhess/nixos-yubikey</a></li>\n</ul>\n</article>","renderedFileInfo":null,"shortPath":null,"tabSize":8,"topBannersInfo":{"overridingGlobalFundingFile":false,"globalPreferredFundingPath":null,"repoOwner":"drduh","repoName":"YubiKey-Guide","showInvalidCitationWarning":false,"citationHelpUrl":"https://docs.github.com/en/github/creating-cloning-and-archiving-repositories/creating-a-repository-on-github/about-citation-files","showDependabotConfigurationBanner":false,"actionsOnboardingTip":null},"truncated":false,"viewable":true,"workflowRedirectUrl":null,"symbols":{"timedOut":false,"notAnalyzed":false,"symbols":[{"name":"Purchase","kind":"section_1","identStart":4932,"identEnd":4940,"extentStart":4930,"extentEnd":6556,"fullyQualifiedName":"Purchase","identUtf16":{"start":{"lineNumber":97,"utf16Col":2},"end":{"lineNumber":97,"utf16Col":10}},"extentUtf16":{"start":{"lineNumber":97,"utf16Col":0},"end":{"lineNumber":107,"utf16Col":0}}},{"name":"Prepare environment","kind":"section_1","identStart":6558,"identEnd":6577,"extentStart":6556,"extentEnd":11072,"fullyQualifiedName":"Prepare environment","identUtf16":{"start":{"lineNumber":107,"utf16Col":2},"end":{"lineNumber":107,"utf16Col":21}},"extentUtf16":{"start":{"lineNumber":107,"utf16Col":0},"end":{"lineNumber":205,"utf16Col":0}}},{"name":"Required software","kind":"section_1","identStart":11074,"identEnd":11091,"extentStart":11072,"extentEnd":21696,"fullyQualifiedName":"Required software","identUtf16":{"start":{"lineNumber":205,"utf16Col":2},"end":{"lineNumber":205,"utf16Col":19}},"extentUtf16":{"start":{"lineNumber":205,"utf16Col":0},"end":{"lineNumber":530,"utf16Col":0}}},{"name":"Debian and Ubuntu","kind":"section_2","identStart":11260,"identEnd":11277,"extentStart":11257,"extentEnd":12869,"fullyQualifiedName":"Debian and Ubuntu","identUtf16":{"start":{"lineNumber":213,"utf16Col":3},"end":{"lineNumber":213,"utf16Col":20}},"extentUtf16":{"start":{"lineNumber":213,"utf16Col":0},"end":{"lineNumber":265,"utf16Col":0}}},{"name":"Fedora","kind":"section_2","identStart":12872,"identEnd":12878,"extentStart":12869,"extentEnd":13189,"fullyQualifiedName":"Fedora","identUtf16":{"start":{"lineNumber":265,"utf16Col":3},"end":{"lineNumber":265,"utf16Col":9}},"extentUtf16":{"start":{"lineNumber":265,"utf16Col":0},"end":{"lineNumber":277,"utf16Col":0}}},{"name":"Arch","kind":"section_2","identStart":13192,"identEnd":13196,"extentStart":13189,"extentEnd":13292,"fullyQualifiedName":"Arch","identUtf16":{"start":{"lineNumber":277,"utf16Col":3},"end":{"lineNumber":277,"utf16Col":7}},"extentUtf16":{"start":{"lineNumber":277,"utf16Col":0},"end":{"lineNumber":283,"utf16Col":0}}},{"name":"RHEL7","kind":"section_2","identStart":13295,"identEnd":13300,"extentStart":13292,"extentEnd":13401,"fullyQualifiedName":"RHEL7","identUtf16":{"start":{"lineNumber":283,"utf16Col":3},"end":{"lineNumber":283,"utf16Col":8}},"extentUtf16":{"start":{"lineNumber":283,"utf16Col":0},"end":{"lineNumber":289,"utf16Col":0}}},{"name":"NixOS","kind":"section_2","identStart":13404,"identEnd":13409,"extentStart":13401,"extentEnd":20917,"fullyQualifiedName":"NixOS","identUtf16":{"start":{"lineNumber":289,"utf16Col":3},"end":{"lineNumber":289,"utf16Col":8}},"extentUtf16":{"start":{"lineNumber":289,"utf16Col":0},"end":{"lineNumber":508,"utf16Col":0}}},{"name":"OpenBSD","kind":"section_2","identStart":20920,"identEnd":20927,"extentStart":20917,"extentEnd":20977,"fullyQualifiedName":"OpenBSD","identUtf16":{"start":{"lineNumber":508,"utf16Col":3},"end":{"lineNumber":508,"utf16Col":10}},"extentUtf16":{"start":{"lineNumber":508,"utf16Col":0},"end":{"lineNumber":514,"utf16Col":0}}},{"name":"macOS","kind":"section_2","identStart":20980,"identEnd":20985,"extentStart":20977,"extentEnd":21394,"fullyQualifiedName":"macOS","identUtf16":{"start":{"lineNumber":514,"utf16Col":3},"end":{"lineNumber":514,"utf16Col":8}},"extentUtf16":{"start":{"lineNumber":514,"utf16Col":0},"end":{"lineNumber":524,"utf16Col":0}}},{"name":"Windows","kind":"section_2","identStart":21397,"identEnd":21404,"extentStart":21394,"extentEnd":21696,"fullyQualifiedName":"Windows","identUtf16":{"start":{"lineNumber":524,"utf16Col":3},"end":{"lineNumber":524,"utf16Col":10}},"extentUtf16":{"start":{"lineNumber":524,"utf16Col":0},"end":{"lineNumber":530,"utf16Col":0}}},{"name":"Entropy","kind":"section_1","identStart":21698,"identEnd":21705,"extentStart":21696,"extentEnd":23106,"fullyQualifiedName":"Entropy","identUtf16":{"start":{"lineNumber":530,"utf16Col":2},"end":{"lineNumber":530,"utf16Col":9}},"extentUtf16":{"start":{"lineNumber":530,"utf16Col":0},"end":{"lineNumber":573,"utf16Col":0}}},{"name":"YubiKey","kind":"section_2","identStart":22169,"identEnd":22176,"extentStart":22166,"extentEnd":22527,"fullyQualifiedName":"YubiKey","identUtf16":{"start":{"lineNumber":538,"utf16Col":3},"end":{"lineNumber":538,"utf16Col":10}},"extentUtf16":{"start":{"lineNumber":538,"utf16Col":0},"end":{"lineNumber":548,"utf16Col":0}}},{"name":"OneRNG","kind":"section_2","identStart":22530,"identEnd":22536,"extentStart":22527,"extentEnd":23106,"fullyQualifiedName":"OneRNG","identUtf16":{"start":{"lineNumber":548,"utf16Col":3},"end":{"lineNumber":548,"utf16Col":9}},"extentUtf16":{"start":{"lineNumber":548,"utf16Col":0},"end":{"lineNumber":573,"utf16Col":0}}},{"name":"Creating keys","kind":"section_1","identStart":23108,"identEnd":23121,"extentStart":23106,"extentEnd":24406,"fullyQualifiedName":"Creating keys","identUtf16":{"start":{"lineNumber":573,"utf16Col":2},"end":{"lineNumber":573,"utf16Col":15}},"extentUtf16":{"start":{"lineNumber":573,"utf16Col":0},"end":{"lineNumber":621,"utf16Col":0}}},{"name":"Temporary working directory","kind":"section_2","identStart":23126,"identEnd":23153,"extentStart":23123,"extentEnd":23519,"fullyQualifiedName":"Temporary working directory","identUtf16":{"start":{"lineNumber":575,"utf16Col":3},"end":{"lineNumber":575,"utf16Col":30}},"extentUtf16":{"start":{"lineNumber":575,"utf16Col":0},"end":{"lineNumber":589,"utf16Col":0}}},{"name":"Harden configuration","kind":"section_2","identStart":23522,"identEnd":23542,"extentStart":23519,"extentEnd":24406,"fullyQualifiedName":"Harden configuration","identUtf16":{"start":{"lineNumber":589,"utf16Col":3},"end":{"lineNumber":589,"utf16Col":23}},"extentUtf16":{"start":{"lineNumber":589,"utf16Col":0},"end":{"lineNumber":621,"utf16Col":0}}},{"name":"Master key","kind":"section_1","identStart":24408,"identEnd":24418,"extentStart":24406,"extentEnd":28808,"fullyQualifiedName":"Master key","identUtf16":{"start":{"lineNumber":621,"utf16Col":2},"end":{"lineNumber":621,"utf16Col":12}},"extentUtf16":{"start":{"lineNumber":621,"utf16Col":0},"end":{"lineNumber":745,"utf16Col":0}}},{"name":"Sign with existing key","kind":"section_1","identStart":28810,"identEnd":28832,"extentStart":28808,"extentEnd":29196,"fullyQualifiedName":"Sign with existing key","identUtf16":{"start":{"lineNumber":745,"utf16Col":2},"end":{"lineNumber":745,"utf16Col":24}},"extentUtf16":{"start":{"lineNumber":745,"utf16Col":0},"end":{"lineNumber":761,"utf16Col":0}}},{"name":"Sub-keys","kind":"section_1","identStart":29198,"identEnd":29206,"extentStart":29196,"extentEnd":38973,"fullyQualifiedName":"Sub-keys","identUtf16":{"start":{"lineNumber":761,"utf16Col":2},"end":{"lineNumber":761,"utf16Col":10}},"extentUtf16":{"start":{"lineNumber":761,"utf16Col":0},"end":{"lineNumber":1069,"utf16Col":0}}},{"name":"Signing","kind":"section_2","identStart":29643,"identEnd":29650,"extentStart":29640,"extentEnd":31242,"fullyQualifiedName":"Signing","identUtf16":{"start":{"lineNumber":780,"utf16Col":3},"end":{"lineNumber":780,"utf16Col":10}},"extentUtf16":{"start":{"lineNumber":780,"utf16Col":0},"end":{"lineNumber":826,"utf16Col":0}}},{"name":"Encryption","kind":"section_2","identStart":31245,"identEnd":31255,"extentStart":31242,"extentEnd":32853,"fullyQualifiedName":"Encryption","identUtf16":{"start":{"lineNumber":826,"utf16Col":3},"end":{"lineNumber":826,"utf16Col":13}},"extentUtf16":{"start":{"lineNumber":826,"utf16Col":0},"end":{"lineNumber":872,"utf16Col":0}}},{"name":"Authentication","kind":"section_2","identStart":32856,"identEnd":32870,"extentStart":32853,"extentEnd":35751,"fullyQualifiedName":"Authentication","identUtf16":{"start":{"lineNumber":872,"utf16Col":3},"end":{"lineNumber":872,"utf16Col":17}},"extentUtf16":{"start":{"lineNumber":872,"utf16Col":0},"end":{"lineNumber":968,"utf16Col":0}}},{"name":"Add extra identities","kind":"section_2","identStart":35754,"identEnd":35774,"extentStart":35751,"extentEnd":38973,"fullyQualifiedName":"Add extra identities","identUtf16":{"start":{"lineNumber":968,"utf16Col":3},"end":{"lineNumber":968,"utf16Col":23}},"extentUtf16":{"start":{"lineNumber":968,"utf16Col":0},"end":{"lineNumber":1069,"utf16Col":0}}},{"name":"Verify","kind":"section_1","identStart":38975,"identEnd":38981,"extentStart":38973,"extentEnd":40522,"fullyQualifiedName":"Verify","identUtf16":{"start":{"lineNumber":1069,"utf16Col":2},"end":{"lineNumber":1069,"utf16Col":8}},"extentUtf16":{"start":{"lineNumber":1069,"utf16Col":0},"end":{"lineNumber":1097,"utf16Col":0}}},{"name":"Export secret keys","kind":"section_1","identStart":40524,"identEnd":40542,"extentStart":40522,"extentEnd":41149,"fullyQualifiedName":"Export secret keys","identUtf16":{"start":{"lineNumber":1097,"utf16Col":2},"end":{"lineNumber":1097,"utf16Col":20}},"extentUtf16":{"start":{"lineNumber":1097,"utf16Col":0},"end":{"lineNumber":1117,"utf16Col":0}}},{"name":"Revocation certificate","kind":"section_1","identStart":41151,"identEnd":41173,"extentStart":41149,"extentEnd":41965,"fullyQualifiedName":"Revocation certificate","identUtf16":{"start":{"lineNumber":1117,"utf16Col":2},"end":{"lineNumber":1117,"utf16Col":24}},"extentUtf16":{"start":{"lineNumber":1117,"utf16Col":0},"end":{"lineNumber":1131,"utf16Col":0}}},{"name":"Backup","kind":"section_1","identStart":41967,"identEnd":41973,"extentStart":41965,"extentEnd":47963,"fullyQualifiedName":"Backup","identUtf16":{"start":{"lineNumber":1131,"utf16Col":2},"end":{"lineNumber":1131,"utf16Col":8}},"extentUtf16":{"start":{"lineNumber":1131,"utf16Col":0},"end":{"lineNumber":1344,"utf16Col":0}}},{"name":"Export public keys","kind":"section_1","identStart":47965,"identEnd":47983,"extentStart":47963,"extentEnd":50007,"fullyQualifiedName":"Export public keys","identUtf16":{"start":{"lineNumber":1344,"utf16Col":2},"end":{"lineNumber":1344,"utf16Col":20}},"extentUtf16":{"start":{"lineNumber":1344,"utf16Col":0},"end":{"lineNumber":1426,"utf16Col":0}}},{"name":"Configure Smartcard","kind":"section_1","identStart":50009,"identEnd":50028,"extentStart":50007,"extentEnd":54582,"fullyQualifiedName":"Configure Smartcard","identUtf16":{"start":{"lineNumber":1426,"utf16Col":2},"end":{"lineNumber":1426,"utf16Col":21}},"extentUtf16":{"start":{"lineNumber":1426,"utf16Col":0},"end":{"lineNumber":1573,"utf16Col":0}}},{"name":"Enable KDF","kind":"section_2","identStart":51105,"identEnd":51115,"extentStart":51102,"extentEnd":51644,"fullyQualifiedName":"Enable KDF","identUtf16":{"start":{"lineNumber":1469,"utf16Col":3},"end":{"lineNumber":1469,"utf16Col":13}},"extentUtf16":{"start":{"lineNumber":1469,"utf16Col":0},"end":{"lineNumber":1477,"utf16Col":0}}},{"name":"Change PIN","kind":"section_2","identStart":51647,"identEnd":51657,"extentStart":51644,"extentEnd":53728,"fullyQualifiedName":"Change PIN","identUtf16":{"start":{"lineNumber":1477,"utf16Col":3},"end":{"lineNumber":1477,"utf16Col":13}},"extentUtf16":{"start":{"lineNumber":1477,"utf16Col":0},"end":{"lineNumber":1532,"utf16Col":0}}},{"name":"Set information","kind":"section_2","identStart":53731,"identEnd":53746,"extentStart":53728,"extentEnd":54582,"fullyQualifiedName":"Set information","identUtf16":{"start":{"lineNumber":1532,"utf16Col":3},"end":{"lineNumber":1532,"utf16Col":18}},"extentUtf16":{"start":{"lineNumber":1532,"utf16Col":0},"end":{"lineNumber":1573,"utf16Col":0}}},{"name":"Transfer keys","kind":"section_1","identStart":54584,"identEnd":54597,"extentStart":54582,"extentEnd":57801,"fullyQualifiedName":"Transfer keys","identUtf16":{"start":{"lineNumber":1573,"utf16Col":2},"end":{"lineNumber":1573,"utf16Col":15}},"extentUtf16":{"start":{"lineNumber":1573,"utf16Col":0},"end":{"lineNumber":1687,"utf16Col":0}}},{"name":"Signing","kind":"section_2","identStart":55622,"identEnd":55629,"extentStart":55619,"extentEnd":56453,"fullyQualifiedName":"Signing","identUtf16":{"start":{"lineNumber":1596,"utf16Col":3},"end":{"lineNumber":1596,"utf16Col":10}},"extentUtf16":{"start":{"lineNumber":1596,"utf16Col":0},"end":{"lineNumber":1627,"utf16Col":0}}},{"name":"Encryption","kind":"section_2","identStart":56456,"identEnd":56466,"extentStart":56453,"extentEnd":57106,"fullyQualifiedName":"Encryption","identUtf16":{"start":{"lineNumber":1627,"utf16Col":3},"end":{"lineNumber":1627,"utf16Col":13}},"extentUtf16":{"start":{"lineNumber":1627,"utf16Col":0},"end":{"lineNumber":1655,"utf16Col":0}}},{"name":"Authentication","kind":"section_2","identStart":57109,"identEnd":57123,"extentStart":57106,"extentEnd":57801,"fullyQualifiedName":"Authentication","identUtf16":{"start":{"lineNumber":1655,"utf16Col":3},"end":{"lineNumber":1655,"utf16Col":17}},"extentUtf16":{"start":{"lineNumber":1655,"utf16Col":0},"end":{"lineNumber":1687,"utf16Col":0}}},{"name":"Verify card","kind":"section_1","identStart":57803,"identEnd":57814,"extentStart":57801,"extentEnd":58397,"fullyQualifiedName":"Verify card","identUtf16":{"start":{"lineNumber":1687,"utf16Col":2},"end":{"lineNumber":1687,"utf16Col":13}},"extentUtf16":{"start":{"lineNumber":1687,"utf16Col":0},"end":{"lineNumber":1703,"utf16Col":0}}},{"name":"Multiple YubiKeys","kind":"section_1","identStart":58399,"identEnd":58416,"extentStart":58397,"extentEnd":60436,"fullyQualifiedName":"Multiple YubiKeys","identUtf16":{"start":{"lineNumber":1703,"utf16Col":2},"end":{"lineNumber":1703,"utf16Col":19}},"extentUtf16":{"start":{"lineNumber":1703,"utf16Col":0},"end":{"lineNumber":1742,"utf16Col":0}}},{"name":"Switching between two or more Yubikeys","kind":"section_2","identStart":58782,"identEnd":58820,"extentStart":58779,"extentEnd":60436,"fullyQualifiedName":"Switching between two or more Yubikeys","identUtf16":{"start":{"lineNumber":1717,"utf16Col":3},"end":{"lineNumber":1717,"utf16Col":41}},"extentUtf16":{"start":{"lineNumber":1717,"utf16Col":0},"end":{"lineNumber":1742,"utf16Col":0}}},{"name":"Multiple Hosts","kind":"section_1","identStart":60438,"identEnd":60452,"extentStart":60436,"extentEnd":64049,"fullyQualifiedName":"Multiple Hosts","identUtf16":{"start":{"lineNumber":1742,"utf16Col":2},"end":{"lineNumber":1742,"utf16Col":16}},"extentUtf16":{"start":{"lineNumber":1742,"utf16Col":0},"end":{"lineNumber":1884,"utf16Col":0}}},{"name":"Cleanup","kind":"section_1","identStart":64051,"identEnd":64058,"extentStart":64049,"extentEnd":65095,"fullyQualifiedName":"Cleanup","identUtf16":{"start":{"lineNumber":1884,"utf16Col":2},"end":{"lineNumber":1884,"utf16Col":9}},"extentUtf16":{"start":{"lineNumber":1884,"utf16Col":0},"end":{"lineNumber":1907,"utf16Col":0}}},{"name":"Using keys","kind":"section_1","identStart":65097,"identEnd":65107,"extentStart":65095,"extentEnd":71152,"fullyQualifiedName":"Using keys","identUtf16":{"start":{"lineNumber":1907,"utf16Col":2},"end":{"lineNumber":1907,"utf16Col":12}},"extentUtf16":{"start":{"lineNumber":1907,"utf16Col":0},"end":{"lineNumber":2097,"utf16Col":0}}},{"name":"Rotating keys","kind":"section_1","identStart":71154,"identEnd":71167,"extentStart":71152,"extentEnd":78894,"fullyQualifiedName":"Rotating keys","identUtf16":{"start":{"lineNumber":2097,"utf16Col":2},"end":{"lineNumber":2097,"utf16Col":15}},"extentUtf16":{"start":{"lineNumber":2097,"utf16Col":0},"end":{"lineNumber":2306,"utf16Col":0}}},{"name":"Setup environment","kind":"section_2","identStart":72836,"identEnd":72853,"extentStart":72833,"extentEnd":73906,"fullyQualifiedName":"Setup environment","identUtf16":{"start":{"lineNumber":2107,"utf16Col":3},"end":{"lineNumber":2107,"utf16Col":20}},"extentUtf16":{"start":{"lineNumber":2107,"utf16Col":0},"end":{"lineNumber":2150,"utf16Col":0}}},{"name":"Renewing sub-keys","kind":"section_2","identStart":73909,"identEnd":73926,"extentStart":73906,"extentEnd":77631,"fullyQualifiedName":"Renewing sub-keys","identUtf16":{"start":{"lineNumber":2150,"utf16Col":3},"end":{"lineNumber":2150,"utf16Col":20}},"extentUtf16":{"start":{"lineNumber":2150,"utf16Col":0},"end":{"lineNumber":2259,"utf16Col":0}}},{"name":"Rotating keys","kind":"section_2","identStart":77634,"identEnd":77647,"extentStart":77631,"extentEnd":78894,"fullyQualifiedName":"Rotating keys","identUtf16":{"start":{"lineNumber":2259,"utf16Col":3},"end":{"lineNumber":2259,"utf16Col":16}},"extentUtf16":{"start":{"lineNumber":2259,"utf16Col":0},"end":{"lineNumber":2306,"utf16Col":0}}},{"name":"Adding notations","kind":"section_1","identStart":78896,"identEnd":78912,"extentStart":78894,"extentEnd":80044,"fullyQualifiedName":"Adding notations","identUtf16":{"start":{"lineNumber":2306,"utf16Col":2},"end":{"lineNumber":2306,"utf16Col":18}},"extentUtf16":{"start":{"lineNumber":2306,"utf16Col":0},"end":{"lineNumber":2330,"utf16Col":0}}},{"name":"SSH","kind":"section_1","identStart":80046,"identEnd":80049,"extentStart":80044,"extentEnd":101888,"fullyQualifiedName":"SSH","identUtf16":{"start":{"lineNumber":2330,"utf16Col":2},"end":{"lineNumber":2330,"utf16Col":5}},"extentUtf16":{"start":{"lineNumber":2330,"utf16Col":0},"end":{"lineNumber":2754,"utf16Col":0}}},{"name":"Create configuration","kind":"section_2","identStart":82255,"identEnd":82275,"extentStart":82252,"extentEnd":83974,"fullyQualifiedName":"Create configuration","identUtf16":{"start":{"lineNumber":2340,"utf16Col":3},"end":{"lineNumber":2340,"utf16Col":23}},"extentUtf16":{"start":{"lineNumber":2340,"utf16Col":0},"end":{"lineNumber":2362,"utf16Col":0}}},{"name":"Replace agents","kind":"section_2","identStart":83977,"identEnd":83991,"extentStart":83974,"extentEnd":85649,"fullyQualifiedName":"Replace agents","identUtf16":{"start":{"lineNumber":2362,"utf16Col":3},"end":{"lineNumber":2362,"utf16Col":17}},"extentUtf16":{"start":{"lineNumber":2362,"utf16Col":0},"end":{"lineNumber":2393,"utf16Col":0}}},{"name":"Copy public key","kind":"section_2","identStart":85652,"identEnd":85667,"extentStart":85649,"extentEnd":85968,"fullyQualifiedName":"Copy public key","identUtf16":{"start":{"lineNumber":2393,"utf16Col":3},"end":{"lineNumber":2393,"utf16Col":18}},"extentUtf16":{"start":{"lineNumber":2393,"utf16Col":0},"end":{"lineNumber":2404,"utf16Col":0}}},{"name":"(Optional) Save public key for identity file configuration","kind":"section_2","identStart":85971,"identEnd":86029,"extentStart":85968,"extentEnd":87696,"fullyQualifiedName":"(Optional) Save public key for identity file configuration","identUtf16":{"start":{"lineNumber":2404,"utf16Col":3},"end":{"lineNumber":2404,"utf16Col":61}},"extentUtf16":{"start":{"lineNumber":2404,"utf16Col":0},"end":{"lineNumber":2428,"utf16Col":0}}},{"name":"Connect with public key authentication","kind":"section_2","identStart":87699,"identEnd":87737,"extentStart":87696,"extentEnd":88877,"fullyQualifiedName":"Connect with public key authentication","identUtf16":{"start":{"lineNumber":2428,"utf16Col":3},"end":{"lineNumber":2428,"utf16Col":41}},"extentUtf16":{"start":{"lineNumber":2428,"utf16Col":0},"end":{"lineNumber":2453,"utf16Col":0}}},{"name":"Import SSH keys","kind":"section_2","identStart":88880,"identEnd":88895,"extentStart":88877,"extentEnd":90215,"fullyQualifiedName":"Import SSH keys","identUtf16":{"start":{"lineNumber":2453,"utf16Col":3},"end":{"lineNumber":2453,"utf16Col":18}},"extentUtf16":{"start":{"lineNumber":2453,"utf16Col":0},"end":{"lineNumber":2484,"utf16Col":0}}},{"name":"Remote Machines (SSH Agent Forwarding)","kind":"section_2","identStart":90218,"identEnd":90256,"extentStart":90215,"extentEnd":94091,"fullyQualifiedName":"Remote Machines (SSH Agent Forwarding)","identUtf16":{"start":{"lineNumber":2484,"utf16Col":3},"end":{"lineNumber":2484,"utf16Col":41}},"extentUtf16":{"start":{"lineNumber":2484,"utf16Col":0},"end":{"lineNumber":2550,"utf16Col":0}}},{"name":"Use ssh-agent","kind":"section_3","identStart":91382,"identEnd":91395,"extentStart":91378,"extentEnd":91993,"fullyQualifiedName":"Use ssh-agent","identUtf16":{"start":{"lineNumber":2494,"utf16Col":4},"end":{"lineNumber":2494,"utf16Col":17}},"extentUtf16":{"start":{"lineNumber":2494,"utf16Col":0},"end":{"lineNumber":2500,"utf16Col":0}}},{"name":"Use S.gpg-agent.ssh","kind":"section_3","identStart":91997,"identEnd":92016,"extentStart":91993,"extentEnd":93195,"fullyQualifiedName":"Use S.gpg-agent.ssh","identUtf16":{"start":{"lineNumber":2500,"utf16Col":4},"end":{"lineNumber":2500,"utf16Col":23}},"extentUtf16":{"start":{"lineNumber":2500,"utf16Col":0},"end":{"lineNumber":2533,"utf16Col":0}}},{"name":"Chained SSH Agent Forwarding","kind":"section_3","identStart":93199,"identEnd":93227,"extentStart":93195,"extentEnd":94091,"fullyQualifiedName":"Chained SSH Agent Forwarding","identUtf16":{"start":{"lineNumber":2533,"utf16Col":4},"end":{"lineNumber":2533,"utf16Col":32}},"extentUtf16":{"start":{"lineNumber":2533,"utf16Col":0},"end":{"lineNumber":2550,"utf16Col":0}}},{"name":"GitHub","kind":"section_2","identStart":94094,"identEnd":94100,"extentStart":94091,"extentEnd":95121,"fullyQualifiedName":"GitHub","identUtf16":{"start":{"lineNumber":2550,"utf16Col":3},"end":{"lineNumber":2550,"utf16Col":9}},"extentUtf16":{"start":{"lineNumber":2550,"utf16Col":0},"end":{"lineNumber":2580,"utf16Col":0}}},{"name":"OpenBSD","kind":"section_2","identStart":95124,"identEnd":95131,"extentStart":95121,"extentEnd":95321,"fullyQualifiedName":"OpenBSD","identUtf16":{"start":{"lineNumber":2580,"utf16Col":3},"end":{"lineNumber":2580,"utf16Col":10}},"extentUtf16":{"start":{"lineNumber":2580,"utf16Col":0},"end":{"lineNumber":2592,"utf16Col":0}}},{"name":"Windows","kind":"section_2","identStart":95324,"identEnd":95331,"extentStart":95321,"extentEnd":100223,"fullyQualifiedName":"Windows","identUtf16":{"start":{"lineNumber":2592,"utf16Col":3},"end":{"lineNumber":2592,"utf16Col":10}},"extentUtf16":{"start":{"lineNumber":2592,"utf16Col":0},"end":{"lineNumber":2696,"utf16Col":0}}},{"name":"WSL","kind":"section_3","identStart":97472,"identEnd":97475,"extentStart":97468,"extentEnd":100223,"fullyQualifiedName":"WSL","identUtf16":{"start":{"lineNumber":2635,"utf16Col":4},"end":{"lineNumber":2635,"utf16Col":7}},"extentUtf16":{"start":{"lineNumber":2635,"utf16Col":0},"end":{"lineNumber":2696,"utf16Col":0}}},{"name":"Use ssh-agent or use S.weasel-pageant","kind":"section_4","identStart":98047,"identEnd":98084,"extentStart":98042,"extentEnd":98561,"fullyQualifiedName":"Use ssh-agent or use S.weasel-pageant","identUtf16":{"start":{"lineNumber":2642,"utf16Col":5},"end":{"lineNumber":2642,"utf16Col":42}},"extentUtf16":{"start":{"lineNumber":2642,"utf16Col":0},"end":{"lineNumber":2648,"utf16Col":0}}},{"name":"Prerequisites","kind":"section_4","identStart":98566,"identEnd":98579,"extentStart":98561,"extentEnd":98662,"fullyQualifiedName":"Prerequisites","identUtf16":{"start":{"lineNumber":2648,"utf16Col":5},"end":{"lineNumber":2648,"utf16Col":18}},"extentUtf16":{"start":{"lineNumber":2648,"utf16Col":0},"end":{"lineNumber":2654,"utf16Col":0}}},{"name":"WSL configuration","kind":"section_4","identStart":98667,"identEnd":98684,"extentStart":98662,"extentEnd":99294,"fullyQualifiedName":"WSL configuration","identUtf16":{"start":{"lineNumber":2654,"utf16Col":5},"end":{"lineNumber":2654,"utf16Col":22}},"extentUtf16":{"start":{"lineNumber":2654,"utf16Col":0},"end":{"lineNumber":2670,"utf16Col":0}}},{"name":"Remote host configuration","kind":"section_4","identStart":99299,"identEnd":99324,"extentStart":99294,"extentEnd":100223,"fullyQualifiedName":"Remote host configuration","identUtf16":{"start":{"lineNumber":2670,"utf16Col":5},"end":{"lineNumber":2670,"utf16Col":30}},"extentUtf16":{"start":{"lineNumber":2670,"utf16Col":0},"end":{"lineNumber":2696,"utf16Col":0}}},{"name":"macOS","kind":"section_2","identStart":100226,"identEnd":100231,"extentStart":100223,"extentEnd":101888,"fullyQualifiedName":"macOS","identUtf16":{"start":{"lineNumber":2696,"utf16Col":3},"end":{"lineNumber":2696,"utf16Col":8}},"extentUtf16":{"start":{"lineNumber":2696,"utf16Col":0},"end":{"lineNumber":2754,"utf16Col":0}}},{"name":"Remote Machines (GPG Agent Forwarding)","kind":"section_1","identStart":101890,"identEnd":101928,"extentStart":101888,"extentEnd":106618,"fullyQualifiedName":"Remote Machines (GPG Agent Forwarding)","identUtf16":{"start":{"lineNumber":2754,"utf16Col":2},"end":{"lineNumber":2754,"utf16Col":40}},"extentUtf16":{"start":{"lineNumber":2754,"utf16Col":0},"end":{"lineNumber":2837,"utf16Col":0}}},{"name":"Steps for older distributions","kind":"section_2","identStart":104007,"identEnd":104036,"extentStart":104004,"extentEnd":105866,"fullyQualifiedName":"Steps for older distributions","identUtf16":{"start":{"lineNumber":2780,"utf16Col":3},"end":{"lineNumber":2780,"utf16Col":32}},"extentUtf16":{"start":{"lineNumber":2780,"utf16Col":0},"end":{"lineNumber":2821,"utf16Col":0}}},{"name":"Chained GPG Agent Forwarding","kind":"section_2","identStart":105869,"identEnd":105897,"extentStart":105866,"extentEnd":106618,"fullyQualifiedName":"Chained GPG Agent Forwarding","identUtf16":{"start":{"lineNumber":2821,"utf16Col":3},"end":{"lineNumber":2821,"utf16Col":31}},"extentUtf16":{"start":{"lineNumber":2821,"utf16Col":0},"end":{"lineNumber":2837,"utf16Col":0}}},{"name":"Using Multiple Keys","kind":"section_1","identStart":106620,"identEnd":106639,"extentStart":106618,"extentEnd":107604,"fullyQualifiedName":"Using Multiple Keys","identUtf16":{"start":{"lineNumber":2837,"utf16Col":2},"end":{"lineNumber":2837,"utf16Col":21}},"extentUtf16":{"start":{"lineNumber":2837,"utf16Col":0},"end":{"lineNumber":2867,"utf16Col":0}}},{"name":"Adding an identity","kind":"section_1","identStart":107606,"identEnd":107624,"extentStart":107604,"extentEnd":111308,"fullyQualifiedName":"Adding an identity","identUtf16":{"start":{"lineNumber":2867,"utf16Col":2},"end":{"lineNumber":2867,"utf16Col":20}},"extentUtf16":{"start":{"lineNumber":2867,"utf16Col":0},"end":{"lineNumber":2989,"utf16Col":0}}},{"name":"Add an identity to your master key","kind":"section_2","identStart":107888,"identEnd":107922,"extentStart":107885,"extentEnd":110681,"fullyQualifiedName":"Add an identity to your master key","identUtf16":{"start":{"lineNumber":2871,"utf16Col":3},"end":{"lineNumber":2871,"utf16Col":37}},"extentUtf16":{"start":{"lineNumber":2871,"utf16Col":0},"end":{"lineNumber":2979,"utf16Col":0}}},{"name":"Updating your YubiKey","kind":"section_2","identStart":110684,"identEnd":110705,"extentStart":110681,"extentEnd":111308,"fullyQualifiedName":"Updating your YubiKey","identUtf16":{"start":{"lineNumber":2979,"utf16Col":3},"end":{"lineNumber":2979,"utf16Col":24}},"extentUtf16":{"start":{"lineNumber":2979,"utf16Col":0},"end":{"lineNumber":2989,"utf16Col":0}}},{"name":"Require touch","kind":"section_1","identStart":111310,"identEnd":111323,"extentStart":111308,"extentEnd":113714,"fullyQualifiedName":"Require touch","identUtf16":{"start":{"lineNumber":2989,"utf16Col":2},"end":{"lineNumber":2989,"utf16Col":15}},"extentUtf16":{"start":{"lineNumber":2989,"utf16Col":0},"end":{"lineNumber":3052,"utf16Col":0}}},{"name":"Email","kind":"section_1","identStart":113716,"identEnd":113721,"extentStart":113714,"extentEnd":116039,"fullyQualifiedName":"Email","identUtf16":{"start":{"lineNumber":3052,"utf16Col":2},"end":{"lineNumber":3052,"utf16Col":7}},"extentUtf16":{"start":{"lineNumber":3052,"utf16Col":0},"end":{"lineNumber":3098,"utf16Col":0}}},{"name":"Mailvelope","kind":"section_2","identStart":114155,"identEnd":114165,"extentStart":114152,"extentEnd":115171,"fullyQualifiedName":"Mailvelope","identUtf16":{"start":{"lineNumber":3056,"utf16Col":3},"end":{"lineNumber":3056,"utf16Col":13}},"extentUtf16":{"start":{"lineNumber":3056,"utf16Col":0},"end":{"lineNumber":3090,"utf16Col":0}}},{"name":"Mutt","kind":"section_2","identStart":115174,"identEnd":115178,"extentStart":115171,"extentEnd":116039,"fullyQualifiedName":"Mutt","identUtf16":{"start":{"lineNumber":3090,"utf16Col":3},"end":{"lineNumber":3090,"utf16Col":7}},"extentUtf16":{"start":{"lineNumber":3090,"utf16Col":0},"end":{"lineNumber":3098,"utf16Col":0}}},{"name":"Reset","kind":"section_1","identStart":116041,"identEnd":116046,"extentStart":116039,"extentEnd":117674,"fullyQualifiedName":"Reset","identUtf16":{"start":{"lineNumber":3098,"utf16Col":2},"end":{"lineNumber":3098,"utf16Col":7}},"extentUtf16":{"start":{"lineNumber":3098,"utf16Col":0},"end":{"lineNumber":3138,"utf16Col":0}}},{"name":"Recovery after reset","kind":"section_2","identStart":117228,"identEnd":117248,"extentStart":117225,"extentEnd":117674,"fullyQualifiedName":"Recovery after reset","identUtf16":{"start":{"lineNumber":3132,"utf16Col":3},"end":{"lineNumber":3132,"utf16Col":23}},"extentUtf16":{"start":{"lineNumber":3132,"utf16Col":0},"end":{"lineNumber":3138,"utf16Col":0}}},{"name":"Notes","kind":"section_1","identStart":117676,"identEnd":117681,"extentStart":117674,"extentEnd":119820,"fullyQualifiedName":"Notes","identUtf16":{"start":{"lineNumber":3138,"utf16Col":2},"end":{"lineNumber":3138,"utf16Col":7}},"extentUtf16":{"start":{"lineNumber":3138,"utf16Col":0},"end":{"lineNumber":3146,"utf16Col":0}}},{"name":"Troubleshooting","kind":"section_1","identStart":119822,"identEnd":119837,"extentStart":119820,"extentEnd":126018,"fullyQualifiedName":"Troubleshooting","identUtf16":{"start":{"lineNumber":3146,"utf16Col":2},"end":{"lineNumber":3146,"utf16Col":17}},"extentUtf16":{"start":{"lineNumber":3146,"utf16Col":0},"end":{"lineNumber":3219,"utf16Col":0}}},{"name":"Alternatives","kind":"section_1","identStart":126020,"identEnd":126032,"extentStart":126018,"extentEnd":128929,"fullyQualifiedName":"Alternatives","identUtf16":{"start":{"lineNumber":3219,"utf16Col":2},"end":{"lineNumber":3219,"utf16Col":14}},"extentUtf16":{"start":{"lineNumber":3219,"utf16Col":0},"end":{"lineNumber":3283,"utf16Col":0}}},{"name":"Create keys with batch","kind":"section_2","identStart":126326,"identEnd":126348,"extentStart":126323,"extentEnd":128929,"fullyQualifiedName":"Create keys with batch","identUtf16":{"start":{"lineNumber":3224,"utf16Col":3},"end":{"lineNumber":3224,"utf16Col":25}},"extentUtf16":{"start":{"lineNumber":3224,"utf16Col":0},"end":{"lineNumber":3283,"utf16Col":0}}},{"name":"Links","kind":"section_1","identStart":128931,"identEnd":128936,"extentStart":128929,"extentEnd":130538,"fullyQualifiedName":"Links","identUtf16":{"start":{"lineNumber":3283,"utf16Col":2},"end":{"lineNumber":3283,"utf16Col":7}},"extentUtf16":{"start":{"lineNumber":3283,"utf16Col":0},"end":{"lineNumber":3309,"utf16Col":0}}}]}},"copilotInfo":{"documentationUrl":"https://docs.github.com/copilot/overview-of-github-copilot/about-github-copilot-for-individuals","notices":{"codeViewPopover":{"dismissed":false,"dismissPath":"/settings/dismiss-notice/code_view_copilot_popover"}},"userAccess":{"accessAllowed":false,"hasSubscriptionEnded":false,"orgHasCFBAccess":false,"userHasCFIAccess":false,"userHasOrgs":false,"userIsOrgAdmin":false,"userIsOrgMember":false,"business":null,"featureRequestInfo":null}},"copilotAccessAllowed":false,"csrf_tokens":{"/drduh/YubiKey-Guide/branches":{"post":"xGvn4YjXOVcwtflm37LPC-u0eGAjutuwbA0URUuuQoGXiv3HVai8mc6Oj_2nbuDB94PybQHJztL6Y_ok3EvWHA"},"/repos/preferences":{"post":"KbndszlPFxdXeYmmh3qC0XN69FgBLCu8uLgJKkAJuNFkWASZyOWl5ZikL8_j-c7nx5XfnrbDnqDDwHVpUgDphA"}}},"title":"YubiKey-Guide/README.md at master Â· drduh/YubiKey-Guide"}